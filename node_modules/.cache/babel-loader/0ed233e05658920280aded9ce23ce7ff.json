{"ast":null,"code":"(function (global, factory) {\n  /* istanbul ignore next */\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\n    module.exports = factory;\n  } else if (typeof define === 'function' && define.amd) {\n    define('JZZ.gui.Player', ['JZZ', 'JZZ.midi.SMF'], factory);\n  } else {\n    factory(JZZ);\n  }\n})(this, function (JZZ) {\n  if (!JZZ.gui) JZZ.gui = {};\n  if (JZZ.gui.Player) return;\n  /* istanbul ignore next */\n\n  function nop() {}\n\n  var _noBtn = {\n    on: nop,\n    off: nop,\n    disable: nop,\n    title: nop,\n    div: {}\n  };\n\n  function Btn(html) {\n    this.div = document.createElement('div');\n    this.div.style.display = 'inline-block';\n    this.div.style.position = 'absolute';\n    this.div.style.boxSizing = 'content-box';\n    this.div.style.top = '8px';\n    this.div.style.margin = '0';\n    this.div.style.padding = '2px';\n    this.div.style.borderStyle = 'solid';\n    this.div.style.borderWidth = '1px';\n    this.div.style.borderColor = '#aaa';\n    this.div.style.backgroundColor = '#888';\n    this.div.style.lineHeight = '0';\n    this.div.style.lineSpasing = '0';\n    this.div.style.width = '18px';\n    this.div.style.height = '18px';\n    this.div.innerHTML = html;\n  }\n\n  Btn.prototype.on = function () {\n    this.div.style.backgroundColor = '#ddd';\n    this.div.style.borderColor = '#ccc';\n    this.div.firstChild.style.fill = '#000';\n  };\n\n  Btn.prototype.off = function () {\n    this.div.style.backgroundColor = '#aaa';\n    this.div.style.borderColor = '#ccc';\n    this.div.firstChild.style.fill = '#000';\n  };\n\n  Btn.prototype.disable = function () {\n    this.div.style.backgroundColor = '#888';\n    this.div.style.borderColor = '#aaa';\n    this.div.firstChild.style.fill = '#555';\n  };\n\n  Btn.prototype.title = function (s) {\n    this.div.title = s;\n  };\n\n  var svg_play = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8 5v14l11-7z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/></svg>';\n  var svg_pause = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/></svg>';\n  var svg_stop = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M6 6h12v12H6z\"/></svg>';\n  var svg_loop = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z\"/></svg>';\n  var svg_more = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z\"/></svg>';\n  var svg_open = '<svg fill=\"#555\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M10 4H2v16h20V6H12l-2-2z\"/></svg>';\n  var svg_link = '<svg fill=\"#555\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path d=\"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z\"/><path fill=\"none\" d=\"M0 0h24v24H0z\"/></svg>';\n  var svg_close = '<svg stroke=\"#ff8\" xmlns=\"http://www.w3.org/2000/svg\" width=\"7\" height=\"7\" viewBox=\"0 0 7 7\"><line x1=\"1\" y1=\"1\" x2=\"6\" y2=\"6\"/><line x1=\"1\" y1=\"6\" x2=\"6\" y2=\"1\"/></svg>';\n\n  function _stopProp(e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function _createGUI(self, arg) {\n    self.gui = document.createElement('div');\n    self.gui.style.display = 'inline-block';\n    self.gui.style.position = 'relative';\n    self.gui.style.boxSizing = 'content-box';\n    self.gui.style.margin = '0px';\n    self.gui.style.padding = '0px';\n    self.gui.style.borderStyle = 'none';\n    self.gui.style.backgroundColor = '#888';\n    self.gui.style.width = '270px';\n    self.gui.style.height = '40px';\n    var left = 8;\n    var right = 238;\n    var step = 28;\n\n    if (arg.play) {\n      self.playBtn = new Btn(svg_play);\n      self.playBtn.div.style.left = left + 'px';\n      left += step;\n      self.playBtn.div.title = 'play';\n      self.playBtn.div.addEventListener('click', function () {\n        self.play();\n      });\n      self.gui.appendChild(self.playBtn.div);\n    } else self.playBtn = _noBtn;\n\n    if (arg.pause) {\n      self.pauseBtn = new Btn(svg_pause);\n      self.pauseBtn.div.style.left = left + 'px';\n      left += step;\n      self.pauseBtn.div.title = 'pause';\n      self.pauseBtn.div.addEventListener('click', function () {\n        self.pause();\n      });\n      self.gui.appendChild(self.pauseBtn.div);\n    } else self.pauseBtn = _noBtn;\n\n    if (arg.stop) {\n      self.stopBtn = new Btn(svg_stop);\n      self.stopBtn.div.style.left = left + 'px';\n      left += step;\n      self.stopBtn.div.title = 'stop';\n      self.stopBtn.div.addEventListener('click', function () {\n        self.stop();\n      });\n      self.gui.appendChild(self.stopBtn.div);\n    } else self.stopBtn = _noBtn;\n\n    if (arg.loop) {\n      self.loopBtn = new Btn(svg_loop);\n      self.loopBtn.div.style.left = left + 'px';\n      left += step;\n      self.loopBtn.div.title = 'loop';\n      self.loopBtn.div.addEventListener('click', function () {\n        self.loop();\n      });\n      self.gui.appendChild(self.loopBtn.div);\n    } else self.loopBtn = _noBtn;\n\n    if (arg.midi) {\n      self.midiBtn = new Btn(svg_more);\n      self.midiBtn.div.style.left = right + 'px';\n      right -= step;\n      self.midiBtn.div.title = 'midi';\n      self.midiBtn.div.addEventListener('click', function () {\n        self.settings();\n      });\n      self.gui.appendChild(self.midiBtn.div);\n      self.sel = document.createElement('select');\n      self.sel.style.position = 'absolute';\n      self.sel.style.top = '30px';\n      self.sel.style.left = '40px';\n      self.sel.style.width = '230px';\n      self.sel.style.display = 'none';\n      self.sel.style.zIndex = 1;\n      self.sel.addEventListener('click', function () {\n        self._selected();\n      });\n      self.sel.addEventListener('keydown', function (e) {\n        self._keydown(e);\n      });\n      self.sel.addEventListener('focusout', function () {\n        self._closeselect();\n      });\n      self.gui.appendChild(self.sel);\n    } else self.midiBtn = _noBtn;\n\n    if (arg.link) {\n      self.linkBtn = new Btn(svg_link);\n      self.linkBtn.div.style.left = right + 'px';\n      right -= step;\n      self.linkBtn.div.title = 'link';\n      self.gui.appendChild(self.linkBtn.div);\n    }\n\n    if (arg.file) {\n      self.fileBtn = new Btn(svg_open);\n      self.fileBtn.div.style.left = right + 'px';\n      right -= step;\n      self.fileBtn.div.title = 'file';\n      self.gui.appendChild(self.fileBtn.div);\n      self.fileInput = document.createElement('input');\n      self.fileInput.type = 'file';\n      self.fileInput.style.position = 'fixed';\n      self.fileInput.style.top = '-1000px';\n      self.fileInput.accept = '.mid, .midi, .kar, .rmi, .syx';\n      self.gui.appendChild(self.fileInput);\n\n      if (window.FileReader) {\n        self.fileBtn.off();\n        self.fileBtn.div.addEventListener('click', function () {\n          self.fileInput.click();\n        });\n        self.fileInput.addEventListener('change', function (e) {\n          _stopProp(e);\n\n          if (e.target.files[0]) self.readFile(e.target.files[0]);\n        });\n        self.gui.addEventListener('drop', function (e) {\n          _stopProp(e);\n\n          self.fileBtn.off();\n          self.readFile(e.dataTransfer.files[0]);\n        });\n        self.gui.addEventListener('dragover', function (e) {\n          _stopProp(e);\n\n          self.fileBtn.on();\n          e.dataTransfer.dropEffect = 'copy';\n        });\n        self.gui.addEventListener('dragexit', function (e) {\n          _stopProp(e);\n\n          self.fileBtn.off();\n        });\n      }\n    } else self.fileBtn = _noBtn;\n\n    if (arg.close) {\n      self.closeBtn = document.createElement('div');\n      self.closeBtn.style.display = 'inline-block';\n      self.closeBtn.style.position = 'absolute';\n      self.closeBtn.style.boxSizing = 'content-box';\n      self.closeBtn.style.top = '1px';\n      self.closeBtn.style.left = '262px';\n      self.closeBtn.style.margin = '0';\n      self.closeBtn.style.padding = '0';\n      self.closeBtn.style.backgroundColor = '#f44';\n      self.closeBtn.style.width = '7px';\n      self.closeBtn.style.height = '7px';\n      self.closeBtn.style.lineHeight = '0';\n      self.closeBtn.style.lineSpasing = '0';\n      self.closeBtn.innerHTML = svg_close;\n      self.closeBtn.title = 'close';\n      self.closeBtn.addEventListener('click', function () {\n        self.destroy();\n      });\n      self.gui.appendChild(self.closeBtn);\n    }\n\n    self.rlen = right - left + 10;\n    self.lbl = document.createElement('div');\n    self.lbl.style.display = 'inline-block';\n    self.lbl.style.position = 'absolute';\n    self.lbl.style.top = '26px';\n    self.lbl.style.left = left + 'px';\n    self.lbl.style.width = self.rlen + 10 + 'px';\n    self.lbl.style.height = '12px';\n    self.lbl.style.padding = '0';\n    self.lbl.style.textAlign = 'center';\n    self.lbl.style.color = '#aaa';\n    self.lbl.style.fontSize = '12px';\n    self.lbl.style.fontFamily = 'Arial, Helvetica, sans-serif';\n    self.gui.appendChild(self.lbl);\n    self.rail = document.createElement('div');\n    self.rail.style.display = 'inline-block';\n    self.rail.style.position = 'absolute';\n    self.rail.style.boxSizing = 'content-box';\n    self.rail.style.top = '19px';\n    self.rail.style.left = left + 5 + 'px';\n    self.rail.style.width = self.rlen + 'px';\n    self.rail.style.height = '0';\n    self.rail.style.padding = '1px';\n    self.rail.style.borderStyle = 'solid';\n    self.rail.style.borderWidth = '1px';\n    self.rail.style.borderRadius = '2px';\n    self.rail.style.borderColor = '#aaa';\n    self.rail.style.backgroundColor = '#888';\n    self.gui.appendChild(self.rail);\n    self.caret = document.createElement('div');\n    self.caret.style.display = 'inline-block';\n    self.caret.style.position = 'absolute';\n    self.caret.style.boxSizing = 'content-box';\n    self.caret.style.width = '2px';\n    self.caret.style.height = '2px';\n    self.caret.style.top = '-5px';\n    self.caret.style.left = '-5px';\n    self.caret.style.padding = '4px';\n    self.caret.style.borderStyle = 'solid';\n    self.caret.style.borderWidth = '1px';\n    self.caret.style.borderRadius = '6px';\n    self.caret.style.borderColor = '#aaa';\n    self.caret.style.backgroundColor = '#888';\n    self.caret.addEventListener('mousedown', function (e) {\n      self._mousedown(e);\n    });\n    self.rail.appendChild(self.caret);\n    window.addEventListener('mousemove', function (e) {\n      self._mousemove(e);\n    });\n    window.addEventListener('mouseup', function (e) {\n      self._mouseup(e);\n    });\n  }\n\n  var _floating = 0;\n\n  function Player(x, y) {\n    if (!(this instanceof Player)) return new Player(x, y);\n    var arg = {\n      at: undefined,\n      x: undefined,\n      y: undefined,\n      play: true,\n      record: false,\n      pause: true,\n      stop: true,\n      loop: true,\n      file: false,\n      link: false,\n      midi: true,\n      close: false,\n      sndoff: true,\n      ports: [undefined, /MIDI Through/i],\n      connect: true\n    };\n    if (typeof x == 'object') for (var k in arg) if (arg.hasOwnProperty(k) && typeof x[k] != 'undefined') arg[k] = x[k];\n    if (typeof arg.at == 'undefined') arg.at = x;\n    if (typeof arg.x == 'undefined') arg.x = x;\n    if (typeof arg.y == 'undefined') arg.y = y;\n\n    _createGUI(this, arg);\n\n    if (!(arg.ports instanceof Array)) arg.ports = [arg.ports];\n    arg.ports.push(undefined);\n    this._ports = arg.ports;\n    this._conn = arg.connect;\n    this._sndoff = arg.sndoff;\n    this.disable();\n\n    if (typeof arg.at == 'string') {\n      try {\n        document.getElementById(arg.at).appendChild(this.gui);\n        return this;\n      } catch (e) {}\n    }\n\n    try {\n      arg.at.appendChild(this.gui);\n      return this;\n    } catch (e) {}\n\n    if (arg.x != parseInt(arg.x) || arg.y != parseInt(arg.y)) {\n      arg.x = _floating * 15 + 5;\n      arg.y = _floating * 45 + 5;\n      _floating++;\n    }\n\n    this.gui.style.position = 'fixed';\n    this.gui.style.top = arg.y + 'px';\n    this.gui.style.left = arg.x + 'px';\n    this.gui.style.opacity = 0.9;\n    var self = this;\n    this.gui.addEventListener('mousedown', function (e) {\n      self._startmove(e);\n    });\n    document.body.appendChild(this.gui);\n  }\n\n  Player.prototype = new JZZ.Widget();\n  Player.prototype.constructor = Player;\n\n  Player.prototype.label = function (html) {\n    this.lbl.innerHTML = html;\n  };\n\n  Player.prototype.disable = function () {\n    this.playBtn.disable();\n    this.pauseBtn.disable();\n    this.stopBtn.disable();\n    this.loopBtn.disable();\n    this.midiBtn.disable();\n    if (this._conn) this.midiBtn.off();\n    this.fileBtn.off();\n    this.rail.style.borderColor = '#aaa';\n    this.rail.style.backgroundColor = '#888';\n    this.caret.style.borderColor = '#aaa';\n    this.caret.style.backgroundColor = '#888';\n  };\n\n  Player.prototype.enable = function () {\n    this.playBtn.off();\n    this.pauseBtn.off();\n    this.stopBtn.off();\n    this.loopBtn.off();\n    if (this._conn) this.midiBtn.off();\n    this.rail.style.borderColor = '#ccc';\n    this.caret.style.backgroundColor = '#aaa';\n    this.caret.style.borderColor = '#ccc';\n  };\n\n  Player.prototype.load = function (smf) {\n    var self = this;\n    this._player = smf.player();\n\n    this._player.trim();\n\n    this._player.connect(this);\n\n    this._player.onEnd = function () {\n      self._onEnd();\n    };\n\n    this._player.filter(this._setfilter);\n\n    if (!this._sndoff) this._player.sndOff = nop;\n    this.enable();\n    this.onLoad(smf);\n  };\n\n  Player.prototype.filter = function (f) {\n    this._setfilter = f instanceof Function ? f : undefined;\n    if (this._player) this._player.filter(this._setfilter);\n  };\n\n  Player.prototype.onSelect = nop;\n  Player.prototype.onEnd = nop;\n  Player.prototype.onLoad = nop;\n\n  Player.prototype._onEnd = function () {\n    this.onEnd();\n    if (this._loop && this._loop != -1) this._loop--;\n\n    if (!this._loop) {\n      if (this._moving) clearInterval(this._moving);\n\n      this._move();\n\n      this._playing = false;\n      this.playBtn.off();\n    } else {\n      if (this._loop == 1) {\n        this._loop = 0;\n        this.loopBtn.off();\n        this.loopBtn.title('loop');\n      } else this.loopBtn.title('loop: ' + (this._loop == -1 ? '\\u221e' : this._loop));\n    }\n  };\n\n  Player.prototype._move = function () {\n    var off = Math.round(this._player.positionMS() * this.rlen / this._player.durationMS()) - 5;\n    this.caret.style.left = off + 'px';\n  };\n\n  Player.prototype.onPlay = nop;\n  Player.prototype.onResume = nop;\n\n  Player.prototype._resume = function () {\n    var self = this;\n\n    this._player.resume();\n\n    this._moving = setInterval(function () {\n      self._move();\n    }, 100);\n  };\n\n  Player.prototype.play = function () {\n    if (this._player) {\n      var self = this;\n      this.playBtn.on();\n      this.pauseBtn.off();\n      if (this._playing) return;\n      if (this._paused) this.onResume();else this.onPlay();\n      this._playing = true;\n      this._paused = false;\n\n      if (this._out || !this._conn) {\n        this._resume();\n      } else if (!this._waiting) {\n        this._waiting = true;\n        JZZ().openMidiOut(self._ports).and(function () {\n          self._out = this;\n          self._outname = this.name();\n          self.midiBtn.title(self._outname);\n\n          self._connect(this);\n\n          self._waiting = false;\n          self.onSelect(self._outname);\n\n          if (self._playing) {\n            self._resume();\n          }\n        }).or(function () {\n          self._waiting = false;\n\n          self._resume();\n        });\n      }\n    }\n  };\n\n  Player.prototype.onStop = nop;\n\n  Player.prototype.stop = function () {\n    if (this._player) {\n      var self = this;\n\n      this._player.stop();\n\n      JZZ.lib.schedule(function () {\n        self.onStop();\n      });\n      if (this._moving) clearInterval(this._moving);\n      this._playing = false;\n      this._paused = false;\n      this.playBtn.off();\n      this.pauseBtn.off();\n\n      this._move();\n    }\n  };\n\n  Player.prototype.onPause = nop;\n\n  Player.prototype.pause = function (p) {\n    if (this._player) {\n      var self = this;\n\n      if (this._paused) {\n        if (typeof p == 'undefined' || p) {\n          if (this._out) {\n            this._resume();\n\n            this.onResume();\n            this._playing = true;\n            this._paused = false;\n            this.playBtn.on();\n            this.pauseBtn.off();\n          } else this.play();\n        }\n      } else if (this._playing) {\n        if (typeof p == 'undefined' || !p) {\n          this._player.pause();\n\n          JZZ.lib.schedule(function () {\n            self.onPause();\n          });\n          if (this._moving) clearInterval(this._moving);\n          this._playing = false;\n          this._paused = true;\n          this.playBtn.off();\n          this.pauseBtn.on();\n        }\n      }\n    }\n  };\n\n  Player.prototype.loop = function (n) {\n    if (this._player) {\n      if (typeof n == 'undefined') n = !this._loop;\n      if (n == parseInt(n) && n > 0) this._loop = n;else this._loop = n ? -1 : 0;\n      if (this._loop == 1) this._loop = 0;\n\n      this._player.loop(this._loop);\n\n      if (this._loop) {\n        this.loopBtn.on();\n        this.loopBtn.title('loop: ' + (this._loop == -1 ? '\\u221e' : this._loop));\n      } else {\n        this.loopBtn.off();\n        this.loopBtn.title('loop');\n      }\n    }\n  };\n\n  Player.prototype.onClose = nop;\n\n  Player.prototype.destroy = function () {\n    this.stop();\n\n    if (this._out) {\n      var out = this._out;\n      JZZ.lib.schedule(function () {\n        out.close();\n      });\n    }\n\n    this.gui.parentNode.removeChild(this.gui);\n    this.onClose();\n  };\n\n  Player.prototype.setUrl = function (url, name) {\n    if (this.linkBtn) {\n      if (this._url) {\n        this.linkBtn.div.appendChild(this._url.firstChild);\n        this.linkBtn.div.removeChild(this._url);\n        this._url = undefined;\n      }\n\n      if (typeof url == 'undefined') this.linkBtn.disable();else {\n        this.linkBtn.off();\n        this._url = document.createElement('a');\n        this._url.target = '_blank';\n\n        this._url.appendChild(this.linkBtn.div.firstChild);\n\n        this.linkBtn.div.appendChild(this._url);\n        this._url.href = url;\n        if (!this._url.dataset) this._url.dataset = {};\n        this._url.dataset.jzzGuiPlayer = true;\n        if (typeof name != 'undefined') this._url.download = name;\n      }\n    }\n  };\n\n  Player.prototype.readFile = function (f) {\n    var self = this;\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      var data = '';\n      var bytes = new Uint8Array(e.target.result);\n\n      for (var i = 0; i < bytes.length; i++) data += String.fromCharCode(bytes[i]);\n\n      var smf;\n\n      try {\n        smf = new JZZ.MIDI.SYX(data);\n      } catch (err) {}\n\n      try {\n        if (!smf) smf = new JZZ.MIDI.SMF(data);\n        self.stop();\n        JZZ.lib.schedule(function () {\n          self.load(smf);\n        });\n        if (self.linkBtn) self.setUrl('data:audio/midi;base64,' + JZZ.lib.toBase64(data), f.name);\n      } catch (err) {\n        console.log(err.message);\n      }\n    };\n\n    reader.readAsArrayBuffer(f);\n  }; // selecting MIDI\n\n\n  Player.prototype.onSelect = nop;\n\n  Player.prototype._closeselect = function () {\n    this.midiBtn.off();\n    this.sel.style.display = 'none';\n    this._more = false;\n  };\n\n  Player.prototype.settings = function () {\n    if (this._more || !this._conn) return;\n    var self = this;\n    this._more = true;\n    this.midiBtn.on();\n    this.sel.style.display = 'inline-block';\n    JZZ().refresh().and(function () {\n      var outs = this.info().outputs;\n      var i;\n\n      for (i = 0; i < self.sel.options.length; i++) self.sel.remove(i);\n\n      for (i = 0; i < outs.length; i++) self.sel[i] = new Option(outs[i].name, outs[i].name, outs[i].name == self._outname, outs[i].name == self._outname);\n\n      self.sel.size = outs.length < 2 ? 2 : outs.length;\n      self.sel.focus();\n    });\n  };\n\n  Player.prototype._selectMidi = function () {\n    var self = this;\n    JZZ().openMidiOut(this._newname).or(function () {\n      self._newname = undefined;\n\n      self._closeselect();\n    }).and(function () {\n      self._newname = undefined;\n\n      if (self._outname != this.name()) {\n        self._outname = this.name();\n\n        self._closeselect();\n\n        if (self._out) {\n          if (self._playing) for (var c = 0; c < 16; c++) self._out._receive(JZZ.MIDI.allSoundOff(c));\n\n          self._disconnect(self._out);\n\n          self._out.close();\n        }\n\n        self._out = this;\n\n        self._connect(this);\n\n        self.midiBtn.title(self._outname);\n        self.onSelect(self._outname);\n        setTimeout(function () {\n          self.onSelect(self._outname);\n        }, 0);\n      }\n    });\n  };\n\n  Player.prototype.select = function (name) {\n    var self = this;\n    this._newname = name || 0;\n\n    if (this._newname == this._outname) {\n      this._newname = undefined;\n\n      this._closeselect();\n    } else {\n      setTimeout(function () {\n        self._selectMidi();\n      }, 0);\n    }\n  };\n\n  Player.prototype._selected = function () {\n    var selected = this.sel.options[this.sel.selectedIndex];\n    if (selected) this.select(selected.value);\n  };\n\n  Player.prototype._keydown = function (e) {\n    if (e.keyCode == 13 || e.keyCode == 32) this._selected();\n  };\n\n  Player.prototype.type = function () {\n    return this._player ? this._player.type() : 0;\n  };\n\n  Player.prototype.tracks = function () {\n    return this._player ? this._player.tracks() : 0;\n  };\n\n  Player.prototype.duration = function () {\n    return this._player ? this._player.duration() : 0;\n  };\n\n  Player.prototype.durationMS = function () {\n    return this._player ? this._player.durationMS() : 0;\n  };\n\n  Player.prototype.position = function () {\n    return this._player ? this._player.position() : 0;\n  };\n\n  Player.prototype.positionMS = function () {\n    return this._player ? this._player.positionMS() : 0;\n  };\n\n  Player.prototype.tick2ms = function () {\n    return this._player ? this._player.tick2ms() : 0;\n  };\n\n  Player.prototype.ms2tick = function () {\n    return this._player ? this._player.ms2tick() : 0;\n  };\n\n  Player.prototype.onJump = nop;\n\n  Player.prototype.jump = function (pos) {\n    if (this._player) {\n      this._player.jump(pos);\n\n      this._move();\n\n      if (!this._playing) {\n        if (pos) {\n          this._paused = true;\n          this.playBtn.off();\n          this.pauseBtn.on();\n        } else {\n          this._paused = false;\n          this.playBtn.off();\n          this.pauseBtn.off();\n        }\n      }\n\n      this.onJump(this._player.position());\n    }\n  };\n\n  Player.prototype.jumpMS = function (pos) {\n    if (this._player) {\n      this._player.jumpMS(pos);\n\n      this._move();\n\n      if (!this._playing) {\n        if (pos) {\n          this._paused = true;\n          this.playBtn.off();\n          this.pauseBtn.on();\n        } else {\n          this._paused = false;\n          this.playBtn.off();\n          this.pauseBtn.off();\n        }\n      }\n\n      this.onJump(this._player.position());\n    }\n  };\n\n  Player.prototype.speed = function (x) {\n    return this._player ? this._player.speed(x) : 1;\n  }; // mouse dragging\n\n\n  function _lftBtnDn(e) {\n    return typeof e.buttons == 'undefined' ? !e.button : e.buttons & 1;\n  }\n\n  Player.prototype._mousedown = function (e) {\n    if (_lftBtnDn(e) && this._player) {\n      if (!this._more) e.preventDefault();\n      this.caret.style.backgroundColor = '#ddd';\n      this._wasPlaying = this._playing;\n\n      this._player.pause();\n\n      this._caretX = e.clientX;\n      this._caretPos = parseInt(this.caret.style.left) + 5;\n    }\n  };\n\n  Player.prototype._startmove = function (e) {\n    if (_lftBtnDn(e)) {\n      if (!this._more) e.preventDefault();\n      this._startX = parseInt(this.gui.style.left);\n      this._startY = parseInt(this.gui.style.top);\n      this._clickX = e.clientX;\n      this._clickY = e.clientY;\n    }\n  };\n\n  Player.prototype._mouseup = function () {\n    if (this._player) {\n      if (typeof this._caretX != 'undefined') {\n        if (this._wasPlaying) {\n          this._wasPlaying = undefined;\n\n          this._player.resume();\n        }\n\n        this.caret.style.backgroundColor = '#aaa';\n        this._caretX = undefined;\n      }\n    }\n\n    if (typeof this._startX != 'undefined') {\n      this._startX = undefined;\n      this._startY = undefined;\n      this._clickX = undefined;\n      this._clickY = undefined;\n    }\n  };\n\n  Player.prototype._mousemove = function (e) {\n    if (this._more) {\n      this._startX = undefined;\n      this._startY = undefined;\n      this._clickX = undefined;\n      this._clickY = undefined;\n    }\n\n    if (this._player && typeof this._caretX != 'undefined') {\n      e.preventDefault();\n      var to = this._caretPos + e.clientX - this._caretX;\n      if (to < 0) to = 0;\n      if (to > this.rlen) to = this.rlen;\n      this.jumpMS(this.durationMS() * to * 1.0 / this.rlen);\n    } else if (typeof this._startX != 'undefined') {\n      e.preventDefault();\n      this.gui.style.left = this._startX - this._clickX + e.clientX + 'px';\n      this.gui.style.top = this._startY - this._clickY + e.clientY + 'px';\n    }\n  };\n\n  Player.prototype._connect = Player.prototype.connect;\n  Player.prototype._disconnect = Player.prototype.disconnect;\n\n  Player.prototype.connect = function (port) {\n    if (port == this) {\n      this._conn = true;\n      this.midiBtn.off();\n    } else {\n      this._connect(port);\n    }\n  };\n\n  Player.prototype.disconnect = function (port) {\n    if (port == this) {\n      this._conn = false;\n      if (this._out) this._disconnect(this._out);\n      this._outname = undefined;\n      this.midiBtn.disable();\n    } else {\n      this._disconnect(port);\n    }\n  };\n\n  Player.prototype.connected = function () {\n    return this._outname;\n  };\n\n  JZZ.gui.Player = Player;\n});","map":{"version":3,"sources":["C:/Users/31505/Desktop/MemomusicFront1111-main/node_modules/jzz-gui-player/javascript/JZZ.gui.Player.js"],"names":["global","factory","exports","module","define","amd","JZZ","gui","Player","nop","_noBtn","on","off","disable","title","div","Btn","html","document","createElement","style","display","position","boxSizing","top","margin","padding","borderStyle","borderWidth","borderColor","backgroundColor","lineHeight","lineSpasing","width","height","innerHTML","prototype","firstChild","fill","s","svg_play","svg_pause","svg_stop","svg_loop","svg_more","svg_open","svg_link","svg_close","_stopProp","e","stopPropagation","preventDefault","_createGUI","self","arg","left","right","step","play","playBtn","addEventListener","appendChild","pause","pauseBtn","stop","stopBtn","loop","loopBtn","midi","midiBtn","settings","sel","zIndex","_selected","_keydown","_closeselect","link","linkBtn","file","fileBtn","fileInput","type","accept","window","FileReader","click","target","files","readFile","dataTransfer","dropEffect","close","closeBtn","destroy","rlen","lbl","textAlign","color","fontSize","fontFamily","rail","borderRadius","caret","_mousedown","_mousemove","_mouseup","_floating","x","y","at","undefined","record","sndoff","ports","connect","k","hasOwnProperty","Array","push","_ports","_conn","_sndoff","getElementById","parseInt","opacity","_startmove","body","Widget","constructor","label","enable","load","smf","_player","player","trim","onEnd","_onEnd","filter","_setfilter","sndOff","onLoad","f","Function","onSelect","_loop","_moving","clearInterval","_move","_playing","Math","round","positionMS","durationMS","onPlay","onResume","_resume","resume","setInterval","_paused","_out","_waiting","openMidiOut","and","_outname","name","_connect","or","onStop","lib","schedule","onPause","p","n","onClose","out","parentNode","removeChild","setUrl","url","_url","href","dataset","jzzGuiPlayer","download","reader","onload","data","bytes","Uint8Array","result","i","length","String","fromCharCode","MIDI","SYX","err","SMF","toBase64","console","log","message","readAsArrayBuffer","_more","refresh","outs","info","outputs","options","remove","Option","size","focus","_selectMidi","_newname","c","_receive","allSoundOff","_disconnect","setTimeout","select","selected","selectedIndex","value","keyCode","tracks","duration","tick2ms","ms2tick","onJump","jump","pos","jumpMS","speed","_lftBtnDn","buttons","button","_wasPlaying","_caretX","clientX","_caretPos","_startX","_startY","_clickX","_clickY","clientY","to","disconnect","port","connected"],"mappings":"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","sourcesContent":["(function(global, factory) {\r\n  /* istanbul ignore next */\r\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\r\n    module.exports = factory;\r\n  }\r\n  else if (typeof define === 'function' && define.amd) {\r\n    define('JZZ.gui.Player', ['JZZ', 'JZZ.midi.SMF'], factory);\r\n  }\r\n  else {\r\n    factory(JZZ);\r\n  }\r\n})(this, function(JZZ) {\r\n\r\n  if (!JZZ.gui) JZZ.gui = {};\r\n  if (JZZ.gui.Player) return;\r\n\r\n  /* istanbul ignore next */\r\n  function nop() {}\r\n  var _noBtn = { on: nop, off: nop, disable: nop, title: nop, div: {} };\r\n\r\n  function Btn(html) {\r\n    this.div = document.createElement('div');\r\n    this.div.style.display = 'inline-block';\r\n    this.div.style.position = 'absolute';\r\n    this.div.style.boxSizing = 'content-box';\r\n    this.div.style.top = '8px';\r\n    this.div.style.margin = '0';\r\n    this.div.style.padding = '2px';\r\n    this.div.style.borderStyle = 'solid';\r\n    this.div.style.borderWidth = '1px';\r\n    this.div.style.borderColor = '#aaa';\r\n    this.div.style.backgroundColor = '#888';\r\n    this.div.style.lineHeight = '0';\r\n    this.div.style.lineSpasing = '0';\r\n    this.div.style.width = '18px';\r\n    this.div.style.height = '18px';\r\n    this.div.innerHTML = html;\r\n  }\r\n  Btn.prototype.on = function() {\r\n    this.div.style.backgroundColor = '#ddd';\r\n    this.div.style.borderColor = '#ccc';\r\n    this.div.firstChild.style.fill = '#000';\r\n  };\r\n  Btn.prototype.off = function() {\r\n    this.div.style.backgroundColor = '#aaa';\r\n    this.div.style.borderColor = '#ccc';\r\n    this.div.firstChild.style.fill = '#000';\r\n  };\r\n  Btn.prototype.disable = function() {\r\n    this.div.style.backgroundColor = '#888';\r\n    this.div.style.borderColor = '#aaa';\r\n    this.div.firstChild.style.fill = '#555';\r\n  };\r\n  Btn.prototype.title = function(s) { this.div.title = s; };\r\n  var svg_play = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8 5v14l11-7z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/></svg>';\r\n  var svg_pause = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"/><path d=\"M0 0h24v24H0z\" fill=\"none\"/></svg>';\r\n  var svg_stop = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M6 6h12v12H6z\"/></svg>';\r\n  var svg_loop = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z\"/></svg>';\r\n  var svg_more = '<svg fill=\"#555\" height=\"18\" viewBox=\"0 0 24 24\" width=\"18\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z\"/></svg>';\r\n  var svg_open = '<svg fill=\"#555\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path fill=\"none\" d=\"M0 0h24v24H0V0z\"/><path d=\"M10 4H2v16h20V6H12l-2-2z\"/></svg>';\r\n  var svg_link = '<svg fill=\"#555\" xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\"><path d=\"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z\"/><path fill=\"none\" d=\"M0 0h24v24H0z\"/></svg>';\r\n  var svg_close = '<svg stroke=\"#ff8\" xmlns=\"http://www.w3.org/2000/svg\" width=\"7\" height=\"7\" viewBox=\"0 0 7 7\"><line x1=\"1\" y1=\"1\" x2=\"6\" y2=\"6\"/><line x1=\"1\" y1=\"6\" x2=\"6\" y2=\"1\"/></svg>';\r\n\r\n  function _stopProp(e) { e.stopPropagation(); e.preventDefault(); }\r\n\r\n  function _createGUI(self, arg) {\r\n    self.gui = document.createElement('div');\r\n    self.gui.style.display = 'inline-block';\r\n    self.gui.style.position = 'relative';\r\n    self.gui.style.boxSizing = 'content-box';\r\n    self.gui.style.margin = '0px';\r\n    self.gui.style.padding = '0px';\r\n    self.gui.style.borderStyle = 'none';\r\n    self.gui.style.backgroundColor = '#888';\r\n    self.gui.style.width = '270px';\r\n    self.gui.style.height = '40px';\r\n\r\n    var left = 8;\r\n    var right = 238;\r\n    var step = 28;\r\n\r\n    if (arg.play) {\r\n      self.playBtn = new Btn(svg_play);\r\n      self.playBtn.div.style.left = left + 'px';\r\n      left += step;\r\n      self.playBtn.div.title = 'play';\r\n      self.playBtn.div.addEventListener('click', function() { self.play(); });\r\n      self.gui.appendChild(self.playBtn.div);\r\n    }\r\n    else self.playBtn = _noBtn;\r\n\r\n    if (arg.pause) {\r\n      self.pauseBtn = new Btn(svg_pause);\r\n      self.pauseBtn.div.style.left = left + 'px';\r\n      left += step;\r\n      self.pauseBtn.div.title = 'pause';\r\n      self.pauseBtn.div.addEventListener('click', function() { self.pause(); });\r\n      self.gui.appendChild(self.pauseBtn.div);\r\n    }\r\n    else self.pauseBtn = _noBtn;\r\n\r\n    if (arg.stop) {\r\n      self.stopBtn = new Btn(svg_stop);\r\n      self.stopBtn.div.style.left = left + 'px';\r\n      left += step;\r\n      self.stopBtn.div.title = 'stop';\r\n      self.stopBtn.div.addEventListener('click', function() { self.stop(); });\r\n      self.gui.appendChild(self.stopBtn.div);\r\n    }\r\n    else self.stopBtn = _noBtn;\r\n\r\n    if (arg.loop) {\r\n      self.loopBtn = new Btn(svg_loop);\r\n      self.loopBtn.div.style.left = left + 'px';\r\n      left += step;\r\n      self.loopBtn.div.title = 'loop';\r\n      self.loopBtn.div.addEventListener('click', function() { self.loop(); });\r\n      self.gui.appendChild(self.loopBtn.div);\r\n    }\r\n    else self.loopBtn = _noBtn;\r\n\r\n    if (arg.midi) {\r\n      self.midiBtn = new Btn(svg_more);\r\n      self.midiBtn.div.style.left = right + 'px';\r\n      right -= step;\r\n      self.midiBtn.div.title = 'midi';\r\n      self.midiBtn.div.addEventListener('click', function() { self.settings(); });\r\n      self.gui.appendChild(self.midiBtn.div);\r\n\r\n      self.sel = document.createElement('select');\r\n      self.sel.style.position = 'absolute';\r\n      self.sel.style.top = '30px';\r\n      self.sel.style.left = '40px';\r\n      self.sel.style.width = '230px';\r\n      self.sel.style.display = 'none';\r\n      self.sel.style.zIndex = 1;\r\n      self.sel.addEventListener('click', function() { self._selected(); });\r\n      self.sel.addEventListener('keydown', function(e) { self._keydown(e); });\r\n      self.sel.addEventListener('focusout', function() { self._closeselect(); });\r\n\r\n      self.gui.appendChild(self.sel);\r\n    }\r\n    else self.midiBtn = _noBtn;\r\n\r\n    if (arg.link) {\r\n      self.linkBtn = new Btn(svg_link);\r\n      self.linkBtn.div.style.left = right + 'px';\r\n      right -= step;\r\n      self.linkBtn.div.title = 'link';\r\n      self.gui.appendChild(self.linkBtn.div);\r\n    }\r\n\r\n    if (arg.file) {\r\n      self.fileBtn = new Btn(svg_open);\r\n      self.fileBtn.div.style.left = right + 'px';\r\n      right -= step;\r\n      self.fileBtn.div.title = 'file';\r\n      self.gui.appendChild(self.fileBtn.div);\r\n\r\n      self.fileInput = document.createElement('input');\r\n      self.fileInput.type = 'file';\r\n      self.fileInput.style.position = 'fixed';\r\n      self.fileInput.style.top = '-1000px';\r\n      self.fileInput.accept = '.mid, .midi, .kar, .rmi, .syx';\r\n      self.gui.appendChild(self.fileInput);\r\n\r\n      if (window.FileReader) {\r\n        self.fileBtn.off();\r\n        self.fileBtn.div.addEventListener('click', function() { self.fileInput.click(); });\r\n        self.fileInput.addEventListener('change', function(e) { _stopProp(e); if (e.target.files[0]) self.readFile(e.target.files[0]); });\r\n        self.gui.addEventListener('drop', function(e) { _stopProp(e); self.fileBtn.off(); self.readFile(e.dataTransfer.files[0]); });\r\n        self.gui.addEventListener('dragover', function(e) { _stopProp(e); self.fileBtn.on(); e.dataTransfer.dropEffect = 'copy'; });\r\n        self.gui.addEventListener('dragexit', function(e) { _stopProp(e); self.fileBtn.off(); });\r\n      }\r\n    }\r\n    else self.fileBtn = _noBtn;\r\n\r\n    if (arg.close) {\r\n      self.closeBtn = document.createElement('div');\r\n      self.closeBtn.style.display = 'inline-block';\r\n      self.closeBtn.style.position = 'absolute';\r\n      self.closeBtn.style.boxSizing = 'content-box';\r\n      self.closeBtn.style.top = '1px';\r\n      self.closeBtn.style.left = '262px';\r\n      self.closeBtn.style.margin = '0';\r\n      self.closeBtn.style.padding = '0';\r\n      self.closeBtn.style.backgroundColor = '#f44';\r\n      self.closeBtn.style.width = '7px';\r\n      self.closeBtn.style.height = '7px';\r\n      self.closeBtn.style.lineHeight = '0';\r\n      self.closeBtn.style.lineSpasing = '0';\r\n      self.closeBtn.innerHTML = svg_close;\r\n      self.closeBtn.title = 'close';\r\n      self.closeBtn.addEventListener('click', function() { self.destroy(); });\r\n      self.gui.appendChild(self.closeBtn);\r\n    }\r\n\r\n    self.rlen = right - left + 10;\r\n\r\n    self.lbl = document.createElement('div');\r\n    self.lbl.style.display = 'inline-block';\r\n    self.lbl.style.position = 'absolute';\r\n    self.lbl.style.top = '26px';\r\n    self.lbl.style.left = left + 'px';\r\n    self.lbl.style.width = (self.rlen + 10) + 'px';\r\n    self.lbl.style.height = '12px';\r\n    self.lbl.style.padding = '0';\r\n    self.lbl.style.textAlign = 'center';\r\n    self.lbl.style.color = '#aaa';\r\n    self.lbl.style.fontSize = '12px';\r\n    self.lbl.style.fontFamily = 'Arial, Helvetica, sans-serif';\r\n    self.gui.appendChild(self.lbl);\r\n\r\n    self.rail = document.createElement('div');\r\n    self.rail.style.display = 'inline-block';\r\n    self.rail.style.position = 'absolute';\r\n    self.rail.style.boxSizing = 'content-box';\r\n    self.rail.style.top = '19px';\r\n    self.rail.style.left = (left + 5) + 'px';\r\n    self.rail.style.width = self.rlen + 'px';\r\n    self.rail.style.height = '0';\r\n    self.rail.style.padding = '1px';\r\n    self.rail.style.borderStyle = 'solid';\r\n    self.rail.style.borderWidth = '1px';\r\n    self.rail.style.borderRadius = '2px';\r\n    self.rail.style.borderColor = '#aaa';\r\n    self.rail.style.backgroundColor = '#888';\r\n    self.gui.appendChild(self.rail);\r\n\r\n    self.caret = document.createElement('div');\r\n    self.caret.style.display = 'inline-block';\r\n    self.caret.style.position = 'absolute';\r\n    self.caret.style.boxSizing = 'content-box';\r\n    self.caret.style.width = '2px';\r\n    self.caret.style.height = '2px';\r\n    self.caret.style.top = '-5px';\r\n    self.caret.style.left = '-5px';\r\n    self.caret.style.padding = '4px';\r\n    self.caret.style.borderStyle = 'solid';\r\n    self.caret.style.borderWidth = '1px';\r\n    self.caret.style.borderRadius = '6px';\r\n    self.caret.style.borderColor = '#aaa';\r\n    self.caret.style.backgroundColor = '#888';\r\n    self.caret.addEventListener('mousedown', function(e) { self._mousedown(e); });\r\n    self.rail.appendChild(self.caret);\r\n\r\n    window.addEventListener('mousemove', function(e) { self._mousemove(e); });\r\n    window.addEventListener('mouseup', function(e) { self._mouseup(e); });\r\n  }\r\n\r\n  var _floating = 0;\r\n  function Player(x, y) {\r\n    if (!(this instanceof Player)) return new Player(x, y);\r\n    var arg = {\r\n      at: undefined,\r\n      x: undefined,\r\n      y: undefined,\r\n      play: true,\r\n      record: false,\r\n      pause: true,\r\n      stop: true,\r\n      loop: true,\r\n      file: false,\r\n      link: false,\r\n      midi: true,\r\n      close: false,\r\n      sndoff: true,\r\n      ports: [undefined, /MIDI Through/i],\r\n      connect: true\r\n    };\r\n    if (typeof x == 'object') for (var k in arg) if (arg.hasOwnProperty(k) && typeof x[k] != 'undefined') arg[k] = x[k];\r\n    if (typeof arg.at == 'undefined') arg.at = x;\r\n    if (typeof arg.x == 'undefined') arg.x = x;\r\n    if (typeof arg.y == 'undefined') arg.y = y;\r\n    _createGUI(this, arg);\r\n    if (!(arg.ports instanceof Array)) arg.ports = [arg.ports];\r\n    arg.ports.push(undefined);\r\n    this._ports = arg.ports;\r\n    this._conn = arg.connect;\r\n    this._sndoff = arg.sndoff;\r\n    this.disable();\r\n\r\n    if (typeof arg.at == 'string') {\r\n      try {\r\n        document.getElementById(arg.at).appendChild(this.gui);\r\n        return this;\r\n      }\r\n      catch(e) {}\r\n    }\r\n    try {\r\n      arg.at.appendChild(this.gui);\r\n      return this;\r\n    }\r\n    catch(e) {}\r\n\r\n    if (arg.x != parseInt(arg.x) || arg.y != parseInt(arg.y)) {\r\n      arg.x = _floating * 15 + 5;\r\n      arg.y = _floating * 45 + 5;\r\n      _floating++;\r\n    }\r\n    this.gui.style.position = 'fixed';\r\n    this.gui.style.top = arg.y + 'px';\r\n    this.gui.style.left = arg.x + 'px';\r\n    this.gui.style.opacity = 0.9;\r\n    var self = this;\r\n    this.gui.addEventListener('mousedown', function(e) { self._startmove(e); });\r\n    document.body.appendChild(this.gui);\r\n  }\r\n  Player.prototype = new JZZ.Widget();\r\n  Player.prototype.constructor = Player;\r\n\r\n  Player.prototype.label = function(html) {\r\n    this.lbl.innerHTML = html;\r\n  };\r\n  Player.prototype.disable = function() {\r\n    this.playBtn.disable();\r\n    this.pauseBtn.disable();\r\n    this.stopBtn.disable();\r\n    this.loopBtn.disable();\r\n    this.midiBtn.disable();\r\n    if (this._conn) this.midiBtn.off();\r\n    this.fileBtn.off();\r\n    this.rail.style.borderColor = '#aaa';\r\n    this.rail.style.backgroundColor = '#888';\r\n    this.caret.style.borderColor = '#aaa';\r\n    this.caret.style.backgroundColor = '#888';\r\n  };\r\n  Player.prototype.enable = function() {\r\n    this.playBtn.off();\r\n    this.pauseBtn.off();\r\n    this.stopBtn.off();\r\n    this.loopBtn.off();\r\n    if (this._conn) this.midiBtn.off();\r\n    this.rail.style.borderColor = '#ccc';\r\n    this.caret.style.backgroundColor = '#aaa';\r\n    this.caret.style.borderColor = '#ccc';\r\n  };\r\n  Player.prototype.load = function(smf) {\r\n    var self = this;\r\n    this._player = smf.player();\r\n    this._player.trim();\r\n    this._player.connect(this);\r\n    this._player.onEnd = function() { self._onEnd(); };\r\n    this._player.filter(this._setfilter);\r\n    if (!this._sndoff) this._player.sndOff = nop;\r\n    this.enable();\r\n    this.onLoad(smf);\r\n  };\r\n  Player.prototype.filter = function(f) {\r\n    this._setfilter = f instanceof Function ? f : undefined;\r\n    if (this._player) this._player.filter(this._setfilter);\r\n  };\r\n  Player.prototype.onSelect = nop;\r\n  Player.prototype.onEnd = nop;\r\n  Player.prototype.onLoad = nop;\r\n  Player.prototype._onEnd = function() {\r\n    this.onEnd();\r\n    if (this._loop && this._loop != -1) this._loop--;\r\n    if (!this._loop) {\r\n      if (this._moving) clearInterval(this._moving);\r\n      this._move();\r\n      this._playing = false;\r\n      this.playBtn.off();\r\n    }\r\n    else {\r\n      if (this._loop == 1) {\r\n        this._loop = 0;\r\n        this.loopBtn.off();\r\n        this.loopBtn.title('loop');\r\n      }\r\n      else this.loopBtn.title('loop: ' + (this._loop == -1 ? '\\u221e' : this._loop));\r\n    }\r\n  };\r\n  Player.prototype._move = function() {\r\n    var off = Math.round(this._player.positionMS() * this.rlen / this._player.durationMS()) - 5;\r\n    this.caret.style.left = off + 'px';\r\n  };\r\n  Player.prototype.onPlay = nop;\r\n  Player.prototype.onResume = nop;\r\n  Player.prototype._resume = function() {\r\n    var self = this;\r\n    this._player.resume();\r\n    this._moving = setInterval(function() { self._move(); }, 100);\r\n  };\r\n  Player.prototype.play = function() {\r\n    if (this._player) {\r\n      var self = this;\r\n      this.playBtn.on();\r\n      this.pauseBtn.off();\r\n      if (this._playing) return;\r\n      if (this._paused) this.onResume();\r\n      else this.onPlay();\r\n      this._playing = true;\r\n      this._paused = false;\r\n      if (this._out || !this._conn) {\r\n        this._resume();\r\n      }\r\n      else if (!this._waiting) {\r\n        this._waiting = true;\r\n        JZZ().openMidiOut(self._ports).and(function() {\r\n          self._out = this;\r\n          self._outname = this.name();\r\n          self.midiBtn.title(self._outname);\r\n          self._connect(this);\r\n          self._waiting = false;\r\n          self.onSelect(self._outname);\r\n          if (self._playing) {\r\n            self._resume();\r\n          }\r\n        }).or(function() {\r\n          self._waiting = false;\r\n          self._resume();\r\n        });\r\n      }\r\n    }\r\n  };\r\n  Player.prototype.onStop = nop;\r\n  Player.prototype.stop = function() {\r\n    if (this._player) {\r\n      var self = this;\r\n      this._player.stop();\r\n      JZZ.lib.schedule(function() { self.onStop(); });\r\n      if (this._moving) clearInterval(this._moving);\r\n      this._playing = false;\r\n      this._paused = false;\r\n      this.playBtn.off();\r\n      this.pauseBtn.off();\r\n      this._move();\r\n    }\r\n  };\r\n  Player.prototype.onPause = nop;\r\n  Player.prototype.pause = function(p) {\r\n    if (this._player) {\r\n      var self = this;\r\n      if (this._paused) {\r\n        if (typeof p == 'undefined' || p) {\r\n          if (this._out) {\r\n            this._resume();\r\n            this.onResume();\r\n            this._playing = true;\r\n            this._paused = false;\r\n            this.playBtn.on();\r\n            this.pauseBtn.off();\r\n          }\r\n          else this.play();\r\n        }\r\n      }\r\n      else if (this._playing) {\r\n        if (typeof p == 'undefined' || !p) {\r\n          this._player.pause();\r\n          JZZ.lib.schedule(function() { self.onPause(); });\r\n          if (this._moving) clearInterval(this._moving);\r\n          this._playing = false;\r\n          this._paused = true;\r\n          this.playBtn.off();\r\n          this.pauseBtn.on();\r\n        }\r\n      }\r\n    }\r\n  };\r\n  Player.prototype.loop = function(n) {\r\n    if (this._player) {\r\n      if (typeof n == 'undefined') n = !this._loop;\r\n      if (n == parseInt(n) && n > 0) this._loop = n;\r\n      else this._loop = n ? -1 : 0;\r\n      if (this._loop == 1) this._loop = 0;\r\n      this._player.loop(this._loop);\r\n      if (this._loop) {\r\n        this.loopBtn.on();\r\n        this.loopBtn.title('loop: ' + (this._loop == -1 ? '\\u221e' : this._loop));\r\n      }\r\n      else {\r\n        this.loopBtn.off();\r\n        this.loopBtn.title('loop');\r\n      }\r\n    }\r\n  };\r\n  Player.prototype.onClose = nop;\r\n  Player.prototype.destroy = function() {\r\n    this.stop();\r\n    if (this._out) {\r\n      var out = this._out;\r\n      JZZ.lib.schedule(function() { out.close(); });\r\n    }\r\n    this.gui.parentNode.removeChild(this.gui);\r\n    this.onClose();\r\n  };\r\n\r\n  Player.prototype.setUrl = function(url, name) {\r\n    if (this.linkBtn) {\r\n      if (this._url) {\r\n        this.linkBtn.div.appendChild(this._url.firstChild);\r\n        this.linkBtn.div.removeChild(this._url);\r\n        this._url = undefined;\r\n      }\r\n      if (typeof url == 'undefined') this.linkBtn.disable();\r\n      else {\r\n        this.linkBtn.off();\r\n        this._url = document.createElement('a');\r\n        this._url.target = '_blank';\r\n        this._url.appendChild(this.linkBtn.div.firstChild);\r\n        this.linkBtn.div.appendChild(this._url);\r\n        this._url.href = url;\r\n        if (!this._url.dataset) this._url.dataset = {};\r\n        this._url.dataset.jzzGuiPlayer = true;\r\n        if (typeof name != 'undefined') this._url.download = name;\r\n      }\r\n    }\r\n  };\r\n\r\n  Player.prototype.readFile = function(f) {\r\n    var self = this;\r\n    var reader = new FileReader();\r\n    reader.onload = function(e) {\r\n      var data = '';\r\n      var bytes = new Uint8Array(e.target.result);\r\n      for (var i = 0; i < bytes.length; i++) data += String.fromCharCode(bytes[i]);\r\n      var smf;\r\n      try {\r\n        smf = new JZZ.MIDI.SYX(data);\r\n      }\r\n      catch (err) {}\r\n      try {\r\n        if (!smf) smf = new JZZ.MIDI.SMF(data);\r\n        self.stop();\r\n        JZZ.lib.schedule(function() { self.load(smf); });\r\n        if (self.linkBtn) self.setUrl('data:audio/midi;base64,' + JZZ.lib.toBase64(data), f.name);\r\n      }\r\n      catch (err) { console.log(err.message); }\r\n    };\r\n    reader.readAsArrayBuffer(f);\r\n  };\r\n\r\n  // selecting MIDI\r\n\r\n  Player.prototype.onSelect = nop;\r\n  Player.prototype._closeselect = function() {\r\n    this.midiBtn.off();\r\n    this.sel.style.display = 'none';\r\n    this._more = false;\r\n  };\r\n  Player.prototype.settings = function() {\r\n    if (this._more || !this._conn) return;\r\n    var self = this;\r\n    this._more = true;\r\n    this.midiBtn.on();\r\n    this.sel.style.display = 'inline-block';\r\n    JZZ().refresh().and(function() {\r\n      var outs = this.info().outputs;\r\n      var i;\r\n      for (i = 0; i < self.sel.options.length; i++) self.sel.remove(i);\r\n      for (i = 0; i < outs.length; i++) self.sel[i] = new Option(outs[i].name, outs[i].name, outs[i].name == self._outname, outs[i].name == self._outname);\r\n      self.sel.size = outs.length < 2 ? 2 : outs.length;\r\n      self.sel.focus();\r\n    });\r\n  };\r\n  Player.prototype._selectMidi = function() {\r\n    var self = this;\r\n    JZZ().openMidiOut(this._newname).or(function() {\r\n      self._newname = undefined;\r\n      self._closeselect();\r\n    }).and(function() {\r\n      self._newname = undefined;\r\n      if (self._outname != this.name()) {\r\n        self._outname = this.name();\r\n        self._closeselect();\r\n        if (self._out) {\r\n          if (self._playing) for (var c = 0; c < 16; c++) self._out._receive(JZZ.MIDI.allSoundOff(c));\r\n          self._disconnect(self._out);\r\n          self._out.close();\r\n        }\r\n        self._out = this;\r\n        self._connect(this);\r\n        self.midiBtn.title(self._outname);\r\n        self.onSelect(self._outname);\r\n        setTimeout(function() { self.onSelect(self._outname); }, 0);\r\n      }\r\n    });\r\n  };\r\n  Player.prototype.select = function(name) {\r\n    var self = this;\r\n    this._newname = name || 0;\r\n    if (this._newname == this._outname) {\r\n      this._newname = undefined;\r\n      this._closeselect();\r\n    }\r\n    else {\r\n      setTimeout(function() { self._selectMidi(); }, 0);\r\n    }\r\n  };\r\n  Player.prototype._selected = function() {\r\n    var selected = this.sel.options[this.sel.selectedIndex];\r\n    if (selected) this.select(selected.value);\r\n  };\r\n  Player.prototype._keydown = function(e) {\r\n    if (e.keyCode == 13 || e.keyCode == 32) this._selected();\r\n  };\r\n\r\n  Player.prototype.type = function() { return this._player ? this._player.type() : 0; };\r\n  Player.prototype.tracks = function() { return this._player ? this._player.tracks() : 0; };\r\n  Player.prototype.duration = function() { return this._player ? this._player.duration() : 0; };\r\n  Player.prototype.durationMS = function() { return this._player ? this._player.durationMS() : 0; };\r\n  Player.prototype.position = function() { return this._player ? this._player.position() : 0; };\r\n  Player.prototype.positionMS = function() { return this._player ? this._player.positionMS() : 0; };\r\n  Player.prototype.tick2ms = function() { return this._player ? this._player.tick2ms() : 0; };\r\n  Player.prototype.ms2tick = function() { return this._player ? this._player.ms2tick() : 0; };\r\n  Player.prototype.onJump = nop;\r\n  Player.prototype.jump = function(pos) {\r\n    if (this._player) {\r\n      this._player.jump(pos);\r\n      this._move();\r\n      if (!this._playing) {\r\n        if (pos) {\r\n          this._paused = true;\r\n          this.playBtn.off();\r\n          this.pauseBtn.on();\r\n        }\r\n        else {\r\n          this._paused = false;\r\n          this.playBtn.off();\r\n          this.pauseBtn.off();\r\n        }\r\n      }\r\n      this.onJump(this._player.position());\r\n    }\r\n  };\r\n  Player.prototype.jumpMS = function(pos) {\r\n    if (this._player) {\r\n      this._player.jumpMS(pos);\r\n      this._move();\r\n      if (!this._playing) {\r\n        if (pos) {\r\n          this._paused = true;\r\n          this.playBtn.off();\r\n          this.pauseBtn.on();\r\n        }\r\n        else {\r\n          this._paused = false;\r\n          this.playBtn.off();\r\n          this.pauseBtn.off();\r\n        }\r\n      }\r\n      this.onJump(this._player.position());\r\n    }\r\n  };\r\n\r\n  Player.prototype.speed = function(x) { return this._player ? this._player.speed(x) : 1; };\r\n\r\n  // mouse dragging\r\n  function _lftBtnDn(e) { return typeof e.buttons == 'undefined' ? !e.button : e.buttons & 1; }\r\n\r\n  Player.prototype._mousedown = function(e) {\r\n    if (_lftBtnDn(e) && this._player) {\r\n      if (!this._more) e.preventDefault();\r\n      this.caret.style.backgroundColor = '#ddd';\r\n      this._wasPlaying = this._playing;\r\n      this._player.pause();\r\n      this._caretX = e.clientX;\r\n      this._caretPos = parseInt(this.caret.style.left) + 5;\r\n    }\r\n  };\r\n  Player.prototype._startmove = function(e) {\r\n    if (_lftBtnDn(e)) {\r\n      if (!this._more) e.preventDefault();\r\n      this._startX = parseInt(this.gui.style.left);\r\n      this._startY = parseInt(this.gui.style.top);\r\n      this._clickX = e.clientX;\r\n      this._clickY = e.clientY;\r\n    }\r\n  };\r\n  Player.prototype._mouseup = function() {\r\n    if (this._player) {\r\n      if (typeof this._caretX != 'undefined') {\r\n        if (this._wasPlaying) {\r\n          this._wasPlaying = undefined;\r\n          this._player.resume();\r\n        }\r\n        this.caret.style.backgroundColor = '#aaa';\r\n        this._caretX = undefined;\r\n      }\r\n    }\r\n    if (typeof this._startX != 'undefined') {\r\n      this._startX = undefined;\r\n      this._startY = undefined;\r\n      this._clickX = undefined;\r\n      this._clickY = undefined;\r\n    }\r\n  };\r\n  Player.prototype._mousemove = function(e) {\r\n    if (this._more) {\r\n      this._startX = undefined;\r\n      this._startY = undefined;\r\n      this._clickX = undefined;\r\n      this._clickY = undefined;\r\n    }\r\n    if (this._player && typeof this._caretX != 'undefined') {\r\n      e.preventDefault();\r\n      var to = this._caretPos + e.clientX - this._caretX;\r\n      if (to < 0) to = 0;\r\n      if (to > this.rlen) to = this.rlen;\r\n      this.jumpMS(this.durationMS() * to * 1.0 / this.rlen);\r\n    }\r\n    else if (typeof this._startX != 'undefined') {\r\n      e.preventDefault();\r\n      this.gui.style.left = this._startX - this._clickX + e.clientX + 'px';\r\n      this.gui.style.top = this._startY - this._clickY + e.clientY + 'px';\r\n    }\r\n  };\r\n\r\n  Player.prototype._connect = Player.prototype.connect;\r\n  Player.prototype._disconnect = Player.prototype.disconnect;\r\n\r\n  Player.prototype.connect = function(port) {\r\n    if (port == this) {\r\n      this._conn = true;\r\n      this.midiBtn.off();\r\n    }\r\n    else {\r\n      this._connect(port);\r\n    }\r\n  };\r\n  Player.prototype.disconnect = function(port) {\r\n    if (port == this) {\r\n      this._conn = false;\r\n      if (this._out) this._disconnect(this._out);\r\n      this._outname = undefined;\r\n      this.midiBtn.disable();\r\n    }\r\n    else {\r\n      this._disconnect(port);\r\n    }\r\n  };\r\n  Player.prototype.connected = function() { return this._outname; };\r\n\r\n  JZZ.gui.Player = Player;\r\n});\r\n"]},"metadata":{},"sourceType":"script"}