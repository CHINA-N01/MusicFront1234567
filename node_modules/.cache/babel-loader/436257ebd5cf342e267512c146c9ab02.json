{"ast":null,"code":"(function (global, factory) {\n  /* istanbul ignore next */\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\n    module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {\n    define('JZZ', [], factory);\n  } else {\n    if (!global) global = window;\n    if (global.JZZ && global.JZZ.MIDI) return;\n    global.JZZ = factory();\n  }\n})(this, function () {\n  var _scope = typeof window === 'undefined' ? global : window;\n\n  var _version = '1.4.9';\n  var i, j, k, m, n;\n  /* istanbul ignore next */\n\n  var _time = Date.now || function () {\n    return new Date().getTime();\n  };\n\n  var _startTime = _time();\n  /* istanbul ignore next */\n\n\n  var _now = typeof performance != 'undefined' && performance.now ? function () {\n    return performance.now();\n  } : function () {\n    return _time() - _startTime;\n  };\n\n  var _schedule = function (f) {\n    setTimeout(f, 0);\n  };\n\n  function _nop() {}\n\n  function _func(f) {\n    return typeof f == 'function';\n  } // _R: common root for all async objects\n\n\n  function _R() {\n    this._orig = this;\n    this._ready = false;\n    this._queue = [];\n    this._log = [];\n  }\n\n  _R.prototype._exec = function () {\n    while (this._ready && this._queue.length) {\n      var x = this._queue.shift();\n\n      x[0].apply(this, x[1]);\n    }\n  };\n\n  _R.prototype._push = function (func, arg) {\n    this._queue.push([func, arg]);\n\n    _R.prototype._exec.apply(this);\n  };\n\n  _R.prototype._slip = function (func, arg) {\n    this._queue.unshift([func, arg]);\n  };\n\n  _R.prototype._pause = function () {\n    this._ready = false;\n  };\n\n  _R.prototype._resume = function () {\n    this._ready = true;\n\n    _R.prototype._exec.apply(this);\n  };\n\n  _R.prototype._break = function (err) {\n    this._orig._bad = true;\n\n    this._orig._log.push(err || 'Unknown JZZ error');\n  };\n\n  _R.prototype._repair = function () {\n    this._orig._bad = false;\n  };\n\n  _R.prototype._crash = function (err) {\n    this._break(err);\n\n    this._resume();\n  };\n\n  _R.prototype._err = function () {\n    return this._log[this._log.length - 1];\n  };\n\n  _R.prototype.log = function () {\n    return _clone(this._log);\n  };\n\n  _R.prototype._dup = function () {\n    var F = function () {};\n\n    F.prototype = this._orig;\n    var ret = new F();\n    ret._ready = false;\n    ret._queue = [];\n    return ret;\n  };\n\n  _R.prototype._image = function () {\n    return this._dup();\n  };\n\n  _R.prototype._thenable = function () {\n    if (this.then) return this;\n    var self = this;\n\n    var F = function () {};\n\n    F.prototype = self;\n    var ret = new F();\n\n    ret.then = function (good, bad) {\n      self._push(_then, [good, bad]);\n\n      return this;\n    };\n\n    return ret;\n  };\n\n  function _then(good, bad) {\n    if (this._bad) {\n      if (_func(bad)) bad.apply(this, [new Error(this._err())]);\n    } else {\n      if (_func(good)) good.apply(this, [this]);\n    }\n  }\n\n  function _wait(obj, delay) {\n    if (this._bad) obj._crash(this._err());else setTimeout(function () {\n      obj._resume();\n    }, delay);\n  }\n\n  _R.prototype.wait = function (delay) {\n    if (!delay) return this;\n\n    var ret = this._image();\n\n    this._push(_wait, [ret, delay]);\n\n    return ret._thenable();\n  };\n\n  function _kick(obj) {\n    if (this._bad) obj._break(this._err());\n\n    obj._resume();\n  }\n\n  function _rechain(self, obj, name) {\n    self[name] = function () {\n      var arg = arguments;\n\n      var ret = obj._image();\n\n      this._push(_kick, [ret]);\n\n      return ret[name].apply(ret, arg);\n    };\n  }\n\n  function _and(q) {\n    if (!this._bad) {\n      if (_func(q)) q.apply(this);else console.log(q);\n    }\n  }\n\n  _R.prototype.and = function (func) {\n    this._push(_and, [func]);\n\n    return this._thenable();\n  };\n\n  function _or(q) {\n    if (this._bad) {\n      if (_func(q)) q.apply(this);else console.log(q);\n    }\n  }\n\n  _R.prototype.or = function (func) {\n    this._push(_or, [func]);\n\n    return this._thenable();\n  };\n\n  _R.prototype._info = {};\n\n  _R.prototype.info = function () {\n    var info = _clone(this._orig._info);\n\n    if (typeof info.engine == 'undefined') info.engine = 'none';\n    if (typeof info.sysex == 'undefined') info.sysex = true;\n    return info;\n  };\n\n  _R.prototype.name = function () {\n    return this.info().name;\n  };\n\n  function _close(obj) {\n    if (this._bad) obj._crash(this._err());else {\n      this._break('Closed');\n\n      obj._resume();\n    }\n  }\n\n  _R.prototype.close = function () {\n    var ret = new _R();\n    if (this._close) this._push(this._close, []);\n\n    this._push(_close, [ret]);\n\n    return ret._thenable();\n  };\n\n  function _tryAny(arr) {\n    if (!arr.length) {\n      this._break();\n\n      return;\n    }\n\n    var func = arr.shift();\n\n    if (arr.length) {\n      var self = this;\n\n      this._slip(_or, [function () {\n        _tryAny.apply(self, [arr]);\n      }]);\n    }\n\n    try {\n      this._repair();\n\n      func.apply(this);\n    } catch (err) {\n      this._break(err.toString());\n    }\n  }\n\n  function _push(arr, obj) {\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) return;\n\n    arr.push(obj);\n  }\n\n  function _pop(arr, obj) {\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) {\n      arr.splice(i, 1);\n      return;\n    }\n  } // _J: JZZ object\n\n\n  function _J() {\n    _R.apply(this);\n  }\n\n  _J.prototype = new _R();\n\n  function _for(x, f) {\n    for (var k in x) if (x.hasOwnProperty(k)) f.call(this, k);\n  }\n\n  function _clone(obj, key, val) {\n    if (typeof key == 'undefined') return _clone(obj, [], []);\n\n    if (obj instanceof Object) {\n      for (var i = 0; i < key.length; i++) if (key[i] === obj) return val[i];\n\n      var ret;\n      if (obj instanceof Array) ret = [];else ret = {};\n      key.push(obj);\n      val.push(ret);\n\n      _for(obj, function (k) {\n        ret[k] = _clone(obj[k], key, val);\n      });\n\n      return ret;\n    }\n\n    return obj;\n  }\n\n  _J.prototype._info = {\n    name: 'JZZ.js',\n    ver: _version,\n    version: _version,\n    inputs: [],\n    outputs: []\n  };\n  var _outs = [];\n  var _ins = [];\n  var _outsW = [];\n  var _insW = [];\n\n  function _postRefresh() {\n    _jzz._info.engine = _engine._type;\n    _jzz._info.version = _engine._version;\n    _jzz._info.sysex = _engine._sysex;\n    _jzz._info.inputs = [];\n    _jzz._info.outputs = [];\n    _outs = [];\n    _ins = [];\n    _engine._allOuts = {};\n    _engine._allIns = {};\n    var i, x;\n\n    for (i = 0; i < _engine._outs.length; i++) {\n      x = _engine._outs[i];\n      x.engine = _engine;\n      _engine._allOuts[x.name] = x;\n\n      _jzz._info.outputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: _engine._type\n      });\n\n      _outs.push(x);\n    }\n\n    for (i = 0; i < _virtual._outs.length; i++) {\n      x = _virtual._outs[i];\n\n      _jzz._info.outputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: x.type\n      });\n\n      _outs.push(x);\n    }\n\n    for (i = 0; i < _engine._ins.length; i++) {\n      x = _engine._ins[i];\n      x.engine = _engine;\n      _engine._allIns[x.name] = x;\n\n      _jzz._info.inputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: _engine._type\n      });\n\n      _ins.push(x);\n    }\n\n    for (i = 0; i < _virtual._ins.length; i++) {\n      x = _virtual._ins[i];\n\n      _jzz._info.inputs.push({\n        id: x.name,\n        name: x.name,\n        manufacturer: x.manufacturer,\n        version: x.version,\n        engine: x.type\n      });\n\n      _ins.push(x);\n    }\n\n    if (_jzz._watcher && _jzz._watcher._handles.length) {\n      var diff = _diff(_insW, _outsW, _jzz._info.inputs, _jzz._info.outputs);\n\n      if (diff) {\n        for (j = 0; j < diff.inputs.removed.length; j++) {\n          x = _engine._inMap[diff.inputs.removed[j].name];\n          if (x) x._closeAll();\n        }\n\n        for (j = 0; j < diff.outputs.removed.length; j++) {\n          x = _engine._outMap[diff.outputs.removed[j].name];\n          if (x) x._closeAll();\n        }\n\n        _fireW(diff);\n      }\n    }\n\n    _insW = _jzz._info.inputs;\n    _outsW = _jzz._info.outputs;\n  }\n\n  function _refresh() {\n    if (!this._bad) _engine._refresh(this);\n  }\n\n  _J.prototype.refresh = function () {\n    this._push(_refresh, []);\n\n    return this._thenable();\n  };\n\n  function _filterList(q, arr) {\n    var i, n;\n    if (_func(q)) q = q(arr);\n    if (!(q instanceof Array)) q = [q];\n    var before = [];\n    var after = [];\n    var etc = arr.slice();\n    var a = before;\n\n    for (i = 0; i < q.length; i++) {\n      if (typeof q[i] == 'undefined') a = after;else if (q[i] instanceof RegExp) for (n = 0; n < etc.length; n++) {\n        if (q[i].test(etc[n].name)) {\n          a.push(etc[n]);\n          etc.splice(n, 1);\n          n--;\n        }\n      } else {\n        for (n = 0; n < etc.length; n++) if (q[i] + '' === n + '' || q[i] === etc[n].name || q[i] instanceof Object && q[i].name === etc[n].name) {\n          a.push(etc[n]);\n          etc.splice(n, 1);\n          n--;\n        }\n      }\n    }\n\n    return a == before ? before : before.concat(etc).concat(after);\n  }\n\n  function _notFound(port, q) {\n    var msg;\n    if (q instanceof RegExp) msg = 'Port matching ' + q + ' not found';else if (q instanceof Object || typeof q == 'undefined') msg = 'Port not found';else msg = 'Port \"' + q + '\" not found';\n\n    port._crash(msg);\n  }\n\n  function _openMidiOut(port, arg) {\n    if (this._bad) port._crash(this._err());else {\n      var arr = _filterList(arg, _outs);\n\n      if (!arr.length) {\n        _notFound(port, arg);\n\n        return;\n      }\n\n      var pack = function (x) {\n        return function () {\n          x.engine._openOut(this, x.name);\n        };\n      };\n\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n\n      port._slip(_tryAny, [arr]);\n\n      port._resume();\n    }\n  }\n\n  _J.prototype.openMidiOut = function (arg) {\n    var port = new _M();\n\n    this._push(_refresh, []);\n\n    this._push(_openMidiOut, [port, arg]);\n\n    return port._thenable();\n  };\n\n  _J.prototype._openMidiOutNR = function (arg) {\n    var port = new _M();\n\n    this._push(_openMidiOut, [port, arg]);\n\n    return port._thenable();\n  };\n\n  function _openMidiIn(port, arg) {\n    if (this._bad) port._crash(this._err());else {\n      var arr = _filterList(arg, _ins);\n\n      if (!arr.length) {\n        _notFound(port, arg);\n\n        return;\n      }\n\n      var pack = function (x) {\n        return function () {\n          x.engine._openIn(this, x.name);\n        };\n      };\n\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\n\n      port._slip(_tryAny, [arr]);\n\n      port._resume();\n    }\n  }\n\n  _J.prototype.openMidiIn = function (arg) {\n    var port = new _M();\n\n    this._push(_refresh, []);\n\n    this._push(_openMidiIn, [port, arg]);\n\n    return port._thenable();\n  };\n\n  _J.prototype._openMidiInNR = function (arg) {\n    var port = new _M();\n\n    this._push(_openMidiIn, [port, arg]);\n\n    return port._thenable();\n  };\n\n  function _onChange(watcher, arg) {\n    if (this._bad) watcher._crash();else {\n      watcher._slip(_connectW, [arg]);\n\n      watcher._resume();\n    }\n  }\n\n  _J.prototype.onChange = function (arg) {\n    if (!this._orig._watcher) this._orig._watcher = new _W();\n\n    var watcher = this._orig._watcher._image();\n\n    this._push(_onChange, [watcher, arg]);\n\n    return watcher._thenable();\n  };\n\n  _J.prototype._close = function () {\n    _engine._close();\n  }; // _M: MIDI-In/Out object\n\n\n  function _M() {\n    _R.apply(this);\n\n    this._handles = [];\n    this._outs = [];\n  }\n\n  _M.prototype = new _R();\n\n  _M.prototype._filter = function (msg) {\n    if (this._orig._mpe) {\n      var out;\n      var outs = 0;\n\n      if (this._handles && this._handles.length) {\n        outs = this._handles.length;\n        out = this._handles[0];\n      }\n\n      if (this._outs && this._outs.length) {\n        outs = this._outs.length;\n        out = this._outs[0];\n      }\n\n      if (outs == 1 && !out._mpe) {\n        msg = this._orig._mpe.filter(msg);\n      }\n    }\n\n    return msg;\n  };\n\n  _M.prototype._receive = function (msg) {\n    this._emit(this._filter(msg));\n  };\n\n  function _receive(msg) {\n    if (!this._bad) this._receive(msg);\n  }\n\n  _M.prototype.send = function () {\n    this._push(_receive, [MIDI.apply(null, arguments)]);\n\n    return this._thenable();\n  };\n\n  _M.prototype.note = function (c, n, v, t) {\n    this.noteOn(c, n, v);\n\n    if (typeof this._ch == 'undefined' && typeof this._master == 'undefined') {\n      if (t > 0) this.wait(t).noteOff(c, n);\n    } else {\n      if (v > 0) this.wait(v).noteOff(c);\n    }\n\n    return this._thenable();\n  };\n\n  _M.prototype._emit = function (msg) {\n    var i;\n\n    for (i = 0; i < this._handles.length; i++) this._handles[i].apply(this, [MIDI(msg)._stamp(this)]);\n\n    for (i = 0; i < this._outs.length; i++) {\n      var m = MIDI(msg);\n      if (!m._stamped(this._outs[i])) this._outs[i].send(m._stamp(this));\n    }\n  };\n\n  function _emit(msg) {\n    this._emit(msg);\n  }\n\n  _M.prototype.emit = function (msg) {\n    this._push(_emit, [msg]);\n\n    return this._thenable();\n  };\n\n  function _connect(arg) {\n    if (_func(arg)) _push(this._orig._handles, arg);else _push(this._orig._outs, arg);\n  }\n\n  function _disconnect(arg) {\n    if (typeof arg == 'undefined') {\n      this._orig._handles = [];\n      this._orig._outs = [];\n    } else if (_func(arg)) _pop(this._orig._handles, arg);else _pop(this._orig._outs, arg);\n  }\n\n  _M.prototype.connect = function (arg) {\n    this._push(_connect, [arg]);\n\n    return this._thenable();\n  };\n\n  _M.prototype.disconnect = function (arg) {\n    this._push(_disconnect, [arg]);\n\n    return this._thenable();\n  };\n\n  _M.prototype.connected = function () {\n    return this._orig._handles.length + this._orig._outs.length;\n  };\n\n  _M.prototype._image = function () {\n    var dup = this._dup();\n\n    dup._ch = this._ch;\n    dup._sxid = this._sxid;\n    dup._master = this._master;\n    dup._band = this._band;\n    return dup;\n  };\n\n  _M.prototype._ch = undefined;\n  _M.prototype._sxid = 0x7f;\n  _M.prototype._master = undefined;\n  _M.prototype._band = undefined;\n\n  _M.prototype.sxId = function (id) {\n    if (typeof id == 'undefined') id = _M.prototype._sxid;\n    if (id == this._sxid) return this._thenable();\n    id = _7b(id);\n\n    var img = this._image();\n\n    img._sxid = id;\n\n    this._push(_kick, [img]);\n\n    return img._thenable();\n  };\n\n  _M.prototype.ch = function (c) {\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this._thenable();\n\n    var img = this._image();\n\n    if (typeof c != 'undefined') c = _ch(c);\n    img._ch = c;\n    img._master = undefined;\n    img._band = undefined;\n\n    this._push(_kick, [img]);\n\n    return img._thenable();\n  };\n\n  function _mpe(m, n) {\n    if (!this._orig._mpe) this._orig._mpe = new MPE();\n\n    this._orig._mpe.setup(m, n);\n  }\n\n  _M.prototype.mpe = function (m, n) {\n    if (m == this._master && n == this._band || typeof m == 'undefined' && typeof this._master == 'undefined') return this._thenable();\n    if (typeof m != 'undefined') MPE.validate(m, n);\n    if (!n) return this.ch(m);\n\n    var img = this._image();\n\n    img._ch = undefined;\n    img._master = m;\n    img._band = n;\n\n    this._push(_mpe, [m, n]);\n\n    this._push(_kick, [img]);\n\n    return img._thenable();\n  };\n\n  function _validateChannel(c) {\n    if (c != parseInt(c) || c < 0 || c > 15) throw RangeError('Bad channel value (must not be less than 0 or more than 15): ' + c);\n  } // _W: Watcher object ~ MIDIAccess.onstatechange\n\n\n  function _W() {\n    _R.apply(this);\n\n    this._handles = [];\n\n    _rechain(this, _jzz, 'refresh');\n\n    _rechain(this, _jzz, 'openMidiOut');\n\n    _rechain(this, _jzz, 'openMidiIn');\n\n    _rechain(this, _jzz, 'onChange');\n\n    _rechain(this, _jzz, 'close');\n  }\n\n  _W.prototype = new _R();\n\n  function _connectW(arg) {\n    if (_func(arg)) {\n      if (!this._orig._handles.length) _engine._watch();\n\n      _push(this._orig._handles, arg);\n    }\n  }\n\n  function _disconnectW(arg) {\n    if (typeof arg == 'undefined') this._orig._handles = [];else _pop(this._orig._handles, arg);\n    if (!this._orig._handles.length) _engine._unwatch();\n  }\n\n  _W.prototype.connect = function (arg) {\n    this._push(_connectW, [arg]);\n\n    return this._thenable();\n  };\n\n  _W.prototype.disconnect = function (arg) {\n    this._push(_disconnectW, [arg]);\n\n    return this._thenable();\n  };\n\n  function _changed(x0, y0, x1, y1) {\n    var i;\n    if (x0.length != x1.length || y0.length != y1.length) return true;\n\n    for (i = 0; i < x0.length; i++) if (x0[i].name != x1[i].name) return true;\n\n    for (i = 0; i < y0.length; i++) if (y0[i].name != y1[i].name) return true;\n\n    return false;\n  }\n\n  function _diff(x0, y0, x1, y1) {\n    if (!_changed(x0, y0, x1, y1)) return;\n    var ax = []; // added\n\n    var ay = [];\n    var rx = []; // removed\n\n    var ry = [];\n    var i;\n    var h = {};\n\n    for (i = 0; i < x0.length; i++) h[x0[i].name] = true;\n\n    for (i = 0; i < x1.length; i++) if (!h[x1[i].name]) ax.push(x1[i]);\n\n    h = {};\n\n    for (i = 0; i < x1.length; i++) h[x1[i].name] = true;\n\n    for (i = 0; i < x0.length; i++) if (!h[x0[i].name]) rx.push(x0[i]);\n\n    h = {};\n\n    for (i = 0; i < y0.length; i++) h[y0[i].name] = true;\n\n    for (i = 0; i < y1.length; i++) if (!h[y1[i].name]) ay.push(y1[i]);\n\n    h = {};\n\n    for (i = 0; i < y1.length; i++) h[y1[i].name] = true;\n\n    for (i = 0; i < y0.length; i++) if (!h[y0[i].name]) ry.push(y0[i]);\n\n    return {\n      inputs: {\n        added: ax,\n        removed: rx\n      },\n      outputs: {\n        added: ay,\n        removed: ry\n      }\n    };\n  }\n\n  function _fireW(arg) {\n    for (i = 0; i < _jzz._watcher._handles.length; i++) _jzz._watcher._handles[i].apply(_jzz, [arg]);\n  }\n\n  var _jzz;\n\n  var _engine = {\n    _outs: [],\n    _ins: []\n  };\n  var _virtual = {\n    _outs: [],\n    _ins: []\n  }; // Node.js\n\n  function _tryNODE() {\n    if (typeof module != 'undefined' && module.exports) {\n      _initNode(require('jazz-midi'));\n\n      return;\n    }\n\n    this._break();\n  } // Jazz-Plugin\n\n\n  function _tryJazzPlugin() {\n    var div = document.createElement('div');\n    div.style.visibility = 'hidden';\n    document.body.appendChild(div);\n    var obj = document.createElement('object');\n    obj.style.visibility = 'hidden';\n    obj.style.width = '0px';\n    obj.style.height = '0px';\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n    obj.type = 'audio/x-jazz';\n    document.body.appendChild(obj);\n    /* istanbul ignore next */\n\n    if (obj.isJazz) {\n      _initJazzPlugin(obj);\n\n      return;\n    }\n\n    this._break();\n  } // Web MIDI API\n\n\n  var _navigator;\n\n  var _requestMIDIAccess;\n\n  function _findMidiAccess() {\n    if (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\n      _navigator = navigator;\n      _requestMIDIAccess = navigator.requestMIDIAccess;\n\n      try {\n        if (_requestMIDIAccess.toString().indexOf('JZZ(') != -1) _requestMIDIAccess = undefined;\n      } catch (err) {}\n    }\n  }\n\n  function _tryWebMIDI() {\n    _findMidiAccess();\n\n    if (_requestMIDIAccess) {\n      var self = this;\n\n      var onGood = function (midi) {\n        _initWebMIDI(midi);\n\n        self._resume();\n      };\n\n      var onBad = function (msg) {\n        self._crash(msg);\n      };\n\n      var opt = {};\n\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\n\n      this._pause();\n\n      return;\n    }\n\n    this._break();\n  }\n\n  function _tryWebMIDIsysex() {\n    _findMidiAccess();\n\n    if (_requestMIDIAccess) {\n      var self = this;\n\n      var onGood = function (midi) {\n        _initWebMIDI(midi, true);\n\n        self._resume();\n      };\n\n      var onBad = function (msg) {\n        self._crash(msg);\n      };\n\n      var opt = {\n        sysex: true\n      };\n\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\n\n      this._pause();\n\n      return;\n    }\n\n    this._break();\n  } // Web-extension\n\n\n  function _tryCRX() {\n    var self = this;\n    var inst;\n    var msg;\n\n    function eventHandle() {\n      inst = true;\n      if (!msg) msg = document.getElementById('jazz-midi-msg');\n      if (!msg) return;\n      var a = [];\n\n      try {\n        a = JSON.parse(msg.innerText);\n      } catch (err) {}\n\n      msg.innerText = '';\n      document.removeEventListener('jazz-midi-msg', eventHandle);\n\n      if (a[0] === 'version') {\n        _initCRX(msg, a[2]);\n\n        self._resume();\n      } else {\n        self._crash();\n      }\n    }\n\n    this._pause();\n\n    document.addEventListener('jazz-midi-msg', eventHandle);\n\n    try {\n      document.dispatchEvent(new Event('jazz-midi'));\n    } catch (err) {}\n\n    _schedule(function () {\n      if (!inst) self._crash();\n    });\n  }\n  /* istanbul ignore next */\n\n\n  function _zeroBreak() {\n    this._pause();\n\n    var self = this;\n\n    _schedule(function () {\n      self._crash();\n    });\n  }\n\n  function _filterEngines(opt) {\n    var ret = [];\n\n    var arr = _filterEngineNames(opt);\n\n    for (var i = 0; i < arr.length; i++) {\n      if (arr[i] == 'webmidi') {\n        if (opt && opt.sysex === true) ret.push(_tryWebMIDIsysex);\n        if (!opt || opt.sysex !== true || opt.degrade === true) ret.push(_tryWebMIDI);\n      } else if (arr[i] == 'node') {\n        ret.push(_tryNODE);\n        ret.push(_zeroBreak);\n      } else if (arr[i] == 'extension') ret.push(_tryCRX);else if (arr[i] == 'plugin') ret.push(_tryJazzPlugin);\n    }\n\n    ret.push(_initNONE);\n    return ret;\n  }\n\n  function _filterEngineNames(opt) {\n    var web = ['node', 'extension', 'plugin', 'webmidi'];\n    if (!opt || !opt.engine) return web;\n    var arr = opt.engine instanceof Array ? opt.engine : [opt.engine];\n    var dup = {};\n    var none;\n    var etc;\n    var head = [];\n    var tail = [];\n    var i;\n\n    for (i = 0; i < arr.length; i++) {\n      var name = arr[i].toString().toLowerCase();\n      if (dup[name]) continue;\n      dup[name] = true;\n      if (name === 'none') none = true;\n      if (name === 'etc' || typeof name == 'undefined') etc = true;\n      if (etc) tail.push(name);else head.push(name);\n\n      _pop(web, name);\n    }\n\n    if (etc || head.length || tail.length) none = false;\n    return none ? [] : head.concat(etc ? web : tail);\n  }\n\n  function _initJZZ(opt) {\n    _jzz = new _J();\n    _jzz._options = opt;\n\n    _jzz._push(_tryAny, [_filterEngines(opt)]);\n\n    _jzz.refresh();\n\n    _jzz._resume();\n  }\n\n  function _initNONE() {\n    _engine._type = 'none';\n    _engine._version = _version;\n    _engine._sysex = true;\n    _engine._outs = [];\n    _engine._ins = [];\n\n    _engine._refresh = function () {\n      _postRefresh();\n    };\n\n    _engine._watch = _nop;\n    _engine._unwatch = _nop;\n    _engine._close = _nop;\n  } // common initialization for Jazz-Plugin and jazz-midi\n\n\n  function _initEngineJP() {\n    _engine._inArr = [];\n    _engine._outArr = [];\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    _engine._version = _engine._main.version;\n    _engine._sysex = true;\n    var watcher;\n\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n\n    _engine._refresh = function () {\n      _engine._outs = [];\n      _engine._ins = [];\n      var i, x;\n\n      for (i = 0; (x = _engine._main.MidiOutInfo(i)).length; i++) {\n        _engine._outs.push({\n          type: _engine._type,\n          name: x[0],\n          manufacturer: x[1],\n          version: x[2]\n        });\n      }\n\n      for (i = 0; (x = _engine._main.MidiInInfo(i)).length; i++) {\n        _engine._ins.push({\n          type: _engine._type,\n          name: x[0],\n          manufacturer: x[1],\n          version: x[2]\n        });\n      }\n\n      _postRefresh();\n    };\n\n    _engine._openOut = function (port, name) {\n      var impl = _engine._outMap[name];\n\n      if (!impl) {\n        if (_engine._pool.length <= _engine._outArr.length) _engine._pool.push(_engine._newPlugin());\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function (port) {\n            _engine._closeOut(port);\n          },\n          _closeAll: _closeAll,\n          _receive: function (a) {\n            if (a.length) this.plugin.MidiOutRaw(a.slice());\n          }\n        };\n        var plugin = _engine._pool[_engine._outArr.length];\n        impl.plugin = plugin;\n\n        _engine._outArr.push(impl);\n\n        _engine._outMap[name] = impl;\n      }\n\n      if (!impl.open) {\n        var s = impl.plugin.MidiOutOpen(name);\n\n        if (s !== name) {\n          if (s) impl.plugin.MidiOutClose();\n\n          port._break();\n\n          return;\n        }\n\n        impl.open = true;\n      }\n\n      port._orig._impl = impl;\n\n      _push(impl.clients, port._orig);\n\n      port._info = impl.info;\n\n      port._receive = function (arg) {\n        impl._receive(arg);\n      };\n\n      port._close = function () {\n        impl._close(this);\n      };\n    };\n\n    _engine._openIn = function (port, name) {\n      var impl = _engine._inMap[name];\n\n      if (!impl) {\n        if (_engine._pool.length <= _engine._inArr.length) _engine._pool.push(_engine._newPlugin());\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function (port) {\n            _engine._closeIn(port);\n          },\n          _closeAll: _closeAll,\n          handle: function (t, a) {\n            for (var i = 0; i < this.clients.length; i++) {\n              var msg = MIDI(a);\n\n              this.clients[i]._emit(msg);\n            }\n          }\n        };\n\n        var makeHandle = function (x) {\n          return function (t, a) {\n            x.handle(t, a);\n          };\n        };\n\n        impl.onmidi = makeHandle(impl);\n        var plugin = _engine._pool[_engine._inArr.length];\n        impl.plugin = plugin;\n\n        _engine._inArr.push(impl);\n\n        _engine._inMap[name] = impl;\n      }\n\n      if (!impl.open) {\n        var s = impl.plugin.MidiInOpen(name, impl.onmidi);\n\n        if (s !== name) {\n          if (s) impl.plugin.MidiInClose();\n\n          port._break();\n\n          return;\n        }\n\n        impl.open = true;\n      }\n\n      port._orig._impl = impl;\n\n      _push(impl.clients, port._orig);\n\n      port._info = impl.info;\n\n      port._close = function () {\n        impl._close(this);\n      };\n    };\n\n    _engine._closeOut = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        impl.plugin.MidiOutClose();\n      }\n    };\n\n    _engine._closeIn = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        impl.plugin.MidiInClose();\n      }\n    };\n\n    _engine._close = function () {\n      for (var i = 0; i < _engine._inArr.length; i++) if (_engine._inArr[i].open) _engine._inArr[i].plugin.MidiInClose();\n\n      _engine._unwatch();\n    };\n\n    _engine._watch = function () {\n      if (!watcher) watcher = setInterval(function () {\n        _engine._refresh();\n      }, 250);\n    };\n\n    _engine._unwatch = function () {\n      if (watcher) clearInterval(watcher);\n      watcher = undefined;\n    };\n  }\n\n  function _initNode(obj) {\n    _engine._type = 'node';\n    _engine._main = obj;\n    _engine._pool = [];\n\n    _engine._newPlugin = function () {\n      return new obj.MIDI();\n    };\n\n    _initEngineJP();\n  }\n  /* istanbul ignore next */\n\n\n  function _initJazzPlugin(obj) {\n    _engine._type = 'plugin';\n    _engine._main = obj;\n    _engine._pool = [obj];\n\n    _engine._newPlugin = function () {\n      var plg = document.createElement('object');\n      plg.style.visibility = 'hidden';\n      plg.style.width = '0px';\n      obj.style.height = '0px';\n      plg.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\n      plg.type = 'audio/x-jazz';\n      document.body.appendChild(plg);\n      return plg.isJazz ? plg : undefined;\n    };\n\n    _initEngineJP();\n  }\n\n  function _initWebMIDI(access, sysex) {\n    _engine._type = 'webmidi';\n    _engine._version = 43;\n    _engine._sysex = !!sysex;\n    _engine._access = access;\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    var watcher;\n\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n\n    _engine._refresh = function () {\n      _engine._outs = [];\n      _engine._ins = [];\n\n      _engine._access.outputs.forEach(function (port) {\n        _engine._outs.push({\n          type: _engine._type,\n          name: port.name,\n          manufacturer: port.manufacturer,\n          version: port.version\n        });\n      });\n\n      _engine._access.inputs.forEach(function (port) {\n        _engine._ins.push({\n          type: _engine._type,\n          name: port.name,\n          manufacturer: port.manufacturer,\n          version: port.version\n        });\n      });\n\n      _postRefresh();\n    };\n\n    _engine._openOut = function (port, name) {\n      var impl = _engine._outMap[name];\n\n      if (!impl) {\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function (port) {\n            _engine._closeOut(port);\n          },\n          _closeAll: _closeAll,\n          _receive: function (a) {\n            if (impl.dev && a.length) this.dev.send(a.slice());\n          }\n        };\n      }\n\n      var found;\n\n      _engine._access.outputs.forEach(function (dev) {\n        if (dev.name === name) found = dev;\n      });\n\n      if (found) {\n        impl.dev = found;\n        _engine._outMap[name] = impl;\n        port._orig._impl = impl;\n\n        _push(impl.clients, port._orig);\n\n        port._info = impl.info;\n\n        port._receive = function (arg) {\n          impl._receive(arg);\n        };\n\n        port._close = function () {\n          impl._close(this);\n        };\n\n        if (impl.dev.open) {\n          port._pause();\n\n          impl.dev.open().then(function () {\n            port._resume();\n          }, function () {\n            port._crash();\n          });\n        }\n      } else port._break();\n    };\n\n    _engine._openIn = function (port, name) {\n      var impl = _engine._inMap[name];\n\n      if (!impl) {\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _close: function (port) {\n            _engine._closeIn(port);\n          },\n          _closeAll: _closeAll,\n          handle: function (evt) {\n            for (var i = 0; i < this.clients.length; i++) {\n              var msg = MIDI([].slice.call(evt.data));\n\n              this.clients[i]._emit(msg);\n            }\n          }\n        };\n      }\n\n      var found;\n\n      _engine._access.inputs.forEach(function (dev) {\n        if (dev.name === name) found = dev;\n      });\n\n      if (found) {\n        impl.dev = found;\n\n        var makeHandle = function (x) {\n          return function (evt) {\n            x.handle(evt);\n          };\n        };\n\n        impl.dev.onmidimessage = makeHandle(impl);\n        _engine._inMap[name] = impl;\n        port._orig._impl = impl;\n\n        _push(impl.clients, port._orig);\n\n        port._info = impl.info;\n\n        port._close = function () {\n          impl._close(this);\n        };\n\n        if (impl.dev.open) {\n          port._pause();\n\n          impl.dev.open().then(function () {\n            port._resume();\n          }, function () {\n            port._crash();\n          });\n        }\n      } else port._break();\n    };\n\n    _engine._closeOut = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length) {\n        if (impl.dev && impl.dev.close) impl.dev.close();\n        impl.dev = undefined;\n      }\n    };\n\n    _engine._closeIn = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length) {\n        if (impl.dev) {\n          impl.dev.onmidimessage = null;\n          if (impl.dev.close) impl.dev.close();\n        }\n\n        impl.dev = undefined;\n      }\n    };\n\n    _engine._close = function () {\n      _engine._unwatch();\n    };\n\n    _engine._watch = function () {\n      _engine._access.onstatechange = function () {\n        watcher = true;\n\n        _schedule(function () {\n          if (watcher) {\n            _engine._refresh();\n\n            watcher = false;\n          }\n        });\n      };\n    };\n\n    _engine._unwatch = function () {\n      _engine._access.onstatechange = undefined;\n    };\n  }\n\n  function _initCRX(msg, ver) {\n    _engine._type = 'extension';\n    _engine._version = ver;\n    _engine._sysex = true;\n    _engine._pool = [];\n    _engine._outs = [];\n    _engine._ins = [];\n    _engine._inArr = [];\n    _engine._outArr = [];\n    _engine._inMap = {};\n    _engine._outMap = {};\n    _engine._outsW = [];\n    _engine._insW = [];\n    _engine.refreshClients = [];\n    _engine._msg = msg;\n\n    _engine._newPlugin = function () {\n      var plugin = {\n        id: _engine._pool.length\n      };\n\n      _engine._pool.push(plugin);\n\n      if (!plugin.id) plugin.ready = true;else document.dispatchEvent(new CustomEvent('jazz-midi', {\n        detail: ['new']\n      }));\n    };\n\n    _engine._newPlugin();\n\n    _engine._refresh = function (client) {\n      _engine.refreshClients.push(client);\n\n      client._pause();\n\n      _schedule(function () {\n        document.dispatchEvent(new CustomEvent('jazz-midi', {\n          detail: ['refresh']\n        }));\n      });\n    };\n\n    function _closeAll() {\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\n    }\n\n    _engine._openOut = function (port, name) {\n      var impl = _engine._outMap[name];\n\n      if (!impl) {\n        if (_engine._pool.length <= _engine._outArr.length) _engine._newPlugin();\n        var plugin = _engine._pool[_engine._outArr.length];\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allOuts[name].manufacturer,\n            version: _engine._allOuts[name].version,\n            type: 'MIDI-out',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _start: function () {\n            document.dispatchEvent(new CustomEvent('jazz-midi', {\n              detail: ['openout', plugin.id, name]\n            }));\n          },\n          _close: function (port) {\n            _engine._closeOut(port);\n          },\n          _closeAll: _closeAll,\n          _receive: function (a) {\n            if (a.length) {\n              var v = a.slice();\n              v.splice(0, 0, 'play', plugin.id);\n              document.dispatchEvent(new CustomEvent('jazz-midi', {\n                detail: v\n              }));\n            }\n          }\n        };\n        impl.plugin = plugin;\n        plugin.output = impl;\n\n        _engine._outArr.push(impl);\n\n        _engine._outMap[name] = impl;\n      }\n\n      port._orig._impl = impl;\n\n      _push(impl.clients, port._orig);\n\n      port._info = impl.info;\n\n      port._receive = function (arg) {\n        impl._receive(arg);\n      };\n\n      port._close = function () {\n        impl._close(this);\n      };\n\n      if (!impl.open) {\n        port._pause();\n\n        if (impl.plugin.ready) impl._start();\n      }\n    };\n\n    _engine._openIn = function (port, name) {\n      var impl = _engine._inMap[name];\n\n      if (!impl) {\n        if (_engine._pool.length <= _engine._inArr.length) _engine._newPlugin();\n        var plugin = _engine._pool[_engine._inArr.length];\n        impl = {\n          name: name,\n          clients: [],\n          info: {\n            name: name,\n            manufacturer: _engine._allIns[name].manufacturer,\n            version: _engine._allIns[name].version,\n            type: 'MIDI-in',\n            sysex: _engine._sysex,\n            engine: _engine._type\n          },\n          _start: function () {\n            document.dispatchEvent(new CustomEvent('jazz-midi', {\n              detail: ['openin', plugin.id, name]\n            }));\n          },\n          _close: function (port) {\n            _engine._closeIn(port);\n          },\n          _closeAll: _closeAll\n        };\n        impl.plugin = plugin;\n        plugin.input = impl;\n\n        _engine._inArr.push(impl);\n\n        _engine._inMap[name] = impl;\n      }\n\n      port._orig._impl = impl;\n\n      _push(impl.clients, port._orig);\n\n      port._info = impl.info;\n\n      port._close = function () {\n        impl._close(this);\n      };\n\n      if (!impl.open) {\n        port._pause();\n\n        if (impl.plugin.ready) impl._start();\n      }\n    };\n\n    _engine._closeOut = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        document.dispatchEvent(new CustomEvent('jazz-midi', {\n          detail: ['closeout', impl.plugin.id]\n        }));\n      }\n    };\n\n    _engine._closeIn = function (port) {\n      var impl = port._impl;\n\n      _pop(impl.clients, port._orig);\n\n      if (!impl.clients.length && impl.open) {\n        impl.open = false;\n        document.dispatchEvent(new CustomEvent('jazz-midi', {\n          detail: ['closein', impl.plugin.id]\n        }));\n      }\n    };\n\n    _engine._close = function () {\n      _engine._unwatch();\n    };\n\n    var watcher;\n\n    _engine._watch = function () {\n      _engine._insW = _engine._ins;\n      _engine._outsW = _engine._outs;\n      watcher = setInterval(function () {\n        document.dispatchEvent(new CustomEvent('jazz-midi', {\n          detail: ['refresh']\n        }));\n      }, 250);\n    };\n\n    _engine._unwatch = function () {\n      clearInterval(watcher);\n      watcher = undefined;\n    };\n\n    document.addEventListener('jazz-midi-msg', function () {\n      var v = _engine._msg.innerText.split('\\n');\n\n      var impl, i, j;\n      _engine._msg.innerText = '';\n\n      for (i = 0; i < v.length; i++) {\n        var a = [];\n\n        try {\n          a = JSON.parse(v[i]);\n        } catch (err) {}\n\n        if (!a.length) continue;\n\n        if (a[0] === 'refresh') {\n          if (a[1].ins) {\n            for (j = 0; j < a[1].ins.length; j++) a[1].ins[j].type = _engine._type;\n\n            _engine._ins = a[1].ins;\n          }\n\n          if (a[1].outs) {\n            for (j = 0; j < a[1].outs.length; j++) a[1].outs[j].type = _engine._type;\n\n            _engine._outs = a[1].outs;\n          }\n\n          _postRefresh();\n\n          for (j = 0; j < _engine.refreshClients.length; j++) _engine.refreshClients[j]._resume();\n\n          _engine.refreshClients = [];\n        } else if (a[0] === 'version') {\n          var plugin = _engine._pool[a[1]];\n\n          if (plugin) {\n            plugin.ready = true;\n            if (plugin.input) plugin.input._start();\n            if (plugin.output) plugin.output._start();\n          }\n        } else if (a[0] === 'openout') {\n          impl = _engine._pool[a[1]].output;\n\n          if (impl) {\n            if (a[2] == impl.name) {\n              impl.open = true;\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\n            } else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\n          }\n        } else if (a[0] === 'openin') {\n          impl = _engine._pool[a[1]].input;\n\n          if (impl) {\n            if (a[2] == impl.name) {\n              impl.open = true;\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\n            } else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\n          }\n        } else if (a[0] === 'midi') {\n          impl = _engine._pool[a[1]].input;\n\n          if (impl && impl.clients) {\n            for (j = 0; j < impl.clients.length; j++) {\n              var msg = MIDI(a.slice(3));\n\n              impl.clients[j]._emit(msg);\n            }\n          }\n        }\n      }\n    });\n  }\n\n  var JZZ = function (opt) {\n    if (!_jzz) _initJZZ(opt);\n    return _jzz._thenable();\n  };\n\n  JZZ.JZZ = JZZ;\n  JZZ.version = _version;\n\n  JZZ.info = function () {\n    return _J.prototype.info();\n  };\n\n  function Widget(arg) {\n    var self = new _M();\n    if (arg instanceof Object) _for(arg, function (k) {\n      self[k] = arg[k];\n    });\n\n    self._resume();\n\n    return self;\n  }\n\n  JZZ.Widget = Widget;\n  _J.prototype.Widget = JZZ.Widget;\n\n  JZZ.addMidiIn = function (name, widget) {\n    var info = _clone(widget._info || {});\n\n    info.name = name;\n    info.type = info.type || 'javascript';\n    info.manufacturer = info.manufacturer || 'virtual';\n    info.version = info.version || '0.0';\n    var engine = {\n      _info: function () {\n        return info;\n      },\n      _openIn: function (port) {\n        port._pause();\n\n        port._info = _clone(info);\n\n        port._close = function () {\n          widget.disconnect(port);\n        };\n\n        widget.connect(port);\n\n        port._resume();\n      }\n    };\n    return JZZ.lib.registerMidiIn(name, engine);\n  };\n\n  JZZ.addMidiOut = function (name, widget) {\n    var info = _clone(widget._info || {});\n\n    info.name = name;\n    info.type = info.type || 'javascript';\n    info.manufacturer = info.manufacturer || 'virtual';\n    info.version = info.version || '0.0';\n    var engine = {\n      _info: function () {\n        return info;\n      },\n      _openOut: function (port) {\n        port._pause();\n\n        port._info = _clone(info);\n\n        port._close = function () {\n          port.disconnect();\n        };\n\n        _connect.apply(port, [widget]);\n\n        port._resume();\n      }\n    };\n    return JZZ.lib.registerMidiOut(name, engine);\n  }; // JZZ.SMPTE\n\n\n  function SMPTE() {\n    var self = this instanceof SMPTE ? this : self = new SMPTE();\n    SMPTE.prototype.reset.apply(self, arguments);\n    return self;\n  }\n\n  SMPTE.prototype.reset = function (arg) {\n    if (arg instanceof SMPTE) {\n      this.setType(arg.getType());\n      this.setHour(arg.getHour());\n      this.setMinute(arg.getMinute());\n      this.setSecond(arg.getSecond());\n      this.setFrame(arg.getFrame());\n      this.setQuarter(arg.getQuarter());\n      return this;\n    }\n\n    var arr = arg instanceof Array ? arg : arguments;\n    this.setType(arr[0]);\n    this.setHour(arr[1]);\n    this.setMinute(arr[2]);\n    this.setSecond(arr[3]);\n    this.setFrame(arr[4]);\n    this.setQuarter(arr[5]);\n    return this;\n  };\n\n  function _fixDropFrame() {\n    if (this.type == 29.97 && !this.second && this.frame < 2 && this.minute % 10) this.frame = 2;\n  }\n\n  SMPTE.prototype.isFullFrame = function () {\n    return this.quarter == 0 || this.quarter == 4;\n  };\n\n  SMPTE.prototype.getType = function () {\n    return this.type;\n  };\n\n  SMPTE.prototype.getHour = function () {\n    return this.hour;\n  };\n\n  SMPTE.prototype.getMinute = function () {\n    return this.minute;\n  };\n\n  SMPTE.prototype.getSecond = function () {\n    return this.second;\n  };\n\n  SMPTE.prototype.getFrame = function () {\n    return this.frame;\n  };\n\n  SMPTE.prototype.getQuarter = function () {\n    return this.quarter;\n  };\n\n  SMPTE.prototype.setType = function (x) {\n    if (typeof x == 'undefined' || x == 24) this.type = 24;else if (x == 25) this.type = 25;else if (x == 29.97) {\n      this.type = 29.97;\n\n      _fixDropFrame.apply(this);\n    } else if (x == 30) this.type = 30;else throw RangeError('Bad SMPTE frame rate: ' + x);\n    if (this.frame >= this.type) this.frame = this.type - 1; // could not be more than 29\n\n    return this;\n  };\n\n  SMPTE.prototype.setHour = function (x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 24) throw RangeError('Bad SMPTE hours value: ' + x);\n    this.hour = x;\n    return this;\n  };\n\n  SMPTE.prototype.setMinute = function (x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE minutes value: ' + x);\n    this.minute = x;\n\n    _fixDropFrame.apply(this);\n\n    return this;\n  };\n\n  SMPTE.prototype.setSecond = function (x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE seconds value: ' + x);\n    this.second = x;\n\n    _fixDropFrame.apply(this);\n\n    return this;\n  };\n\n  SMPTE.prototype.setFrame = function (x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= this.type) throw RangeError('Bad SMPTE frame number: ' + x);\n    this.frame = x;\n\n    _fixDropFrame.apply(this);\n\n    return this;\n  };\n\n  SMPTE.prototype.setQuarter = function (x) {\n    if (typeof x == 'undefined') x = 0;\n    if (x != parseInt(x) || x < 0 || x >= 8) throw RangeError('Bad SMPTE quarter frame: ' + x);\n    this.quarter = x;\n    return this;\n  };\n\n  SMPTE.prototype.incrFrame = function () {\n    this.frame++;\n\n    if (this.frame >= this.type) {\n      this.frame = 0;\n      this.second++;\n\n      if (this.second >= 60) {\n        this.second = 0;\n        this.minute++;\n\n        if (this.minute >= 60) {\n          this.minute = 0;\n          this.hour = this.hour >= 23 ? 0 : this.hour + 1;\n        }\n      }\n    }\n\n    _fixDropFrame.apply(this);\n\n    return this;\n  };\n\n  SMPTE.prototype.decrFrame = function () {\n    if (!this.second && this.frame == 2 && this.type == 29.97 && this.minute % 10) this.frame = 0; // drop-frame\n\n    this.frame--;\n\n    if (this.frame < 0) {\n      this.frame = this.type == 29.97 ? 29 : this.type - 1;\n      this.second--;\n\n      if (this.second < 0) {\n        this.second = 59;\n        this.minute--;\n\n        if (this.minute < 0) {\n          this.minute = 59;\n          this.hour = this.hour ? this.hour - 1 : 23;\n        }\n      }\n    }\n\n    return this;\n  };\n\n  SMPTE.prototype.incrQF = function () {\n    this.backwards = false;\n    this.quarter = this.quarter + 1 & 7;\n    if (this.quarter == 0 || this.quarter == 4) this.incrFrame();\n    return this;\n  };\n\n  SMPTE.prototype.decrQF = function () {\n    this.backwards = true;\n    this.quarter = this.quarter + 7 & 7;\n    if (this.quarter == 3 || this.quarter == 7) this.decrFrame();\n    return this;\n  };\n\n  function _825(a) {\n    return [[24, 25, 29.97, 30][a[7] >> 1 & 3], (a[7] & 1) << 4 | a[6], a[5] << 4 | a[4], a[3] << 4 | a[2], a[1] << 4 | a[0]];\n  }\n\n  SMPTE.prototype.read = function (m) {\n    if (!(m instanceof MIDI)) m = MIDI.apply(null, arguments);\n\n    if (m[0] == 0xf0 && m[1] == 0x7f && m[3] == 1 && m[4] == 1 && m[9] == 0xf7) {\n      this.type = [24, 25, 29.97, 30][m[5] >> 5 & 3];\n      this.hour = m[5] & 31;\n      this.minute = m[6];\n      this.second = m[7];\n      this.frame = m[8];\n      this.quarter = 0;\n      this._ = undefined;\n      this._b = undefined;\n      this._f = undefined;\n      return true;\n    }\n\n    if (m[0] == 0xf1 && typeof m[1] != 'undefined') {\n      var q = m[1] >> 4;\n      var n = m[1] & 15;\n\n      if (q == 0) {\n        if (this._ == 7) {\n          if (this._f == 7) {\n            this.reset(_825(this._a));\n            this.incrFrame();\n          }\n\n          this.incrFrame();\n        }\n      } else if (q == 3) {\n        if (this._ == 4) {\n          this.decrFrame();\n        }\n      } else if (q == 4) {\n        if (this._ == 3) {\n          this.incrFrame();\n        }\n      } else if (q == 7) {\n        if (this._ === 0) {\n          if (this._b === 0) {\n            this.reset(_825(this._a));\n            this.decrFrame();\n          }\n\n          this.decrFrame();\n        }\n      }\n\n      if (!this._a) this._a = [];\n      this._a[q] = n;\n      this._f = this._f === q - 1 || q == 0 ? q : undefined;\n      this._b = this._b === q + 1 || q == 7 ? q : undefined;\n      this._ = q;\n      this.quarter = q;\n      return true;\n    }\n\n    return false;\n  };\n\n  function _mtc(t) {\n    if (!t.backwards && t.quarter >= 4) t.decrFrame(); // continue encoding previous frame\n    else if (t.backwards && t.quarter < 4) t.incrFrame();\n    var ret;\n\n    switch (t.quarter >> 1) {\n      case 0:\n        ret = t.frame;\n        break;\n\n      case 1:\n        ret = t.second;\n        break;\n\n      case 2:\n        ret = t.minute;\n        break;\n\n      default:\n        ret = t.hour;\n    }\n\n    if (t.quarter & 1) ret >>= 4;else ret &= 15;\n\n    if (t.quarter == 7) {\n      if (t.type == 25) ret |= 2;else if (t.type == 29.97) ret |= 4;else if (t.type == 30) ret |= 6;\n    } // restore original t\n\n\n    if (!t.backwards && t.quarter >= 4) t.incrFrame();else if (t.backwards && t.quarter < 4) t.decrFrame();\n    return ret | t.quarter << 4;\n  }\n\n  function _hrtype(t) {\n    if (t.type == 25) return t.hour | 0x20;\n    if (t.type == 29.97) return t.hour | 0x40;\n    if (t.type == 30) return t.hour | 0x60;\n    return t.hour;\n  }\n\n  function _dec(x) {\n    return x < 10 ? '0' + x : x;\n  }\n\n  function _smptetxt(x) {\n    var arr = [];\n\n    for (var i = 0; i < x.length; i++) arr[i] = _dec(i ? x[i] : x[i] & 0x1f);\n\n    return arr.join(':');\n  }\n\n  SMPTE.prototype.toString = function () {\n    return _smptetxt([this.hour, this.minute, this.second, this.frame]);\n  };\n\n  JZZ.SMPTE = SMPTE;\n  _J.prototype.SMPTE = SMPTE; // JZZ.MIDI\n\n  function MIDI(arg) {\n    var self = this instanceof MIDI ? this : self = new MIDI();\n    var i;\n\n    if (arg instanceof MIDI) {\n      self._from = arg._from.slice();\n\n      _for(arg, function (i) {\n        if (i != '_from') self[i] = arg[i];\n      });\n\n      return self;\n    } else self._from = [];\n\n    if (typeof arg == 'undefined') return self;\n    var arr = arg instanceof Array ? arg : arguments;\n\n    for (i = 0; i < arr.length; i++) {\n      n = arr[i];\n\n      if (i == 1) {\n        if (self[0] >= 0x80 && self[0] <= 0xAF) n = MIDI.noteValue(n);\n        if (self[0] >= 0xC0 && self[0] <= 0xCF) n = MIDI.programValue(n);\n      }\n\n      if (n != parseInt(n) || n < 0 || n > 255) _throw(arr[i]);\n      self.push(n);\n    }\n\n    return self;\n  }\n\n  MIDI.prototype = [];\n  MIDI.prototype.constructor = MIDI;\n  var _noteNum = {};\n\n  MIDI.noteValue = function (x) {\n    return typeof x == 'undefined' ? undefined : _noteNum[x.toString().toLowerCase()];\n  };\n\n  MIDI.programValue = function (x) {\n    return x;\n  };\n\n  MIDI.octaveValue = function (x) {\n    var n = _noteNum[x.toString().toLowerCase()];\n\n    if (typeof n == 'undefined') n = _noteNum[x.toString().toLowerCase() + '1'];\n    return typeof n == 'undefined' ? undefined : n % 12;\n  };\n\n  MIDI.freq = function (n, a) {\n    if (typeof a == 'undefined') a = 440.0;\n\n    _float(a);\n\n    if (n != parseFloat(n)) n = _7bn(n);\n    return a * Math.pow(2, (n - 69.0) / 12.0);\n  };\n\n  function _float(x) {\n    if (x != parseFloat(x)) throw TypeError('Not a number: ' + x);\n  }\n\n  MIDI.shift = function (f, f0) {\n    if (typeof f0 == 'undefined') f0 = 440;\n\n    _float(f);\n\n    _float(f0);\n\n    return Math.log2(f / f0) * 12;\n  };\n\n  MIDI.midi = function (f, f0) {\n    if (f != parseFloat(f)) return _7bn(f);\n    return MIDI.shift(f, f0) + 69;\n  };\n\n  MIDI.to7b = function (x) {\n    _float(x);\n\n    return x <= 0 ? 0 : x >= 1 ? 0x7f : Math.floor(x * 0x80);\n  };\n\n  MIDI.to14b = function (x) {\n    _float(x);\n\n    return x <= 0 ? 0 : x >= 1 ? 0x3fff : Math.floor(x * 0x4000);\n  };\n\n  MIDI.to21b = function (x) {\n    if (typeof x == 'undefined') return 0x1fffff;\n\n    _float(x);\n\n    if (x <= 0) return 0;\n    x = (Math.floor(x) << 14) + MIDI.to14b(x - Math.floor(x));\n    return x < 0x1fffff ? x : 0x1ffffe;\n  };\n\n  function _MIDI() {}\n\n  _MIDI.prototype = MIDI;\n  MIDI._sxid = 0x7f;\n\n  MIDI.sxId = function (id) {\n    if (typeof id == 'undefined') id = MIDI._sxid;\n    if (id == this._sxid) return this;\n    id = _7b(id);\n    var ret = new _MIDI();\n    ret._ch = this._ch;\n    ret._sxid = id;\n    return ret;\n  };\n\n  MIDI.ch = function (c) {\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this;\n    var ret = new _MIDI();\n    if (typeof c != 'undefined') c = _ch(c);\n    ret._ch = c;\n    ret._sxid = this._sxid;\n    return ret;\n  };\n\n  var _noteMap = {\n    c: 0,\n    d: 2,\n    e: 4,\n    f: 5,\n    g: 7,\n    a: 9,\n    b: 11,\n    h: 11\n  };\n\n  _for(_noteMap, function (k) {\n    for (n = 0; n < 12; n++) {\n      m = _noteMap[k] + n * 12;\n      if (m > 127) break;\n      _noteNum[k + n] = m;\n      _noteNum[k + '' + n] = m;\n\n      if (m > 0) {\n        _noteNum[k + 'b' + n] = m - 1;\n        _noteNum[k + '' + n] = m - 1;\n        _noteNum[k + 'bb' + n] = m - 2;\n        _noteNum[k + '' + n] = m - 2;\n        _noteNum[k + '' + n] = m - 2;\n      }\n\n      if (m < 127) {\n        _noteNum[k + '#' + n] = m + 1;\n        _noteNum[k + '' + n] = m + 1;\n        _noteNum[k + '##' + n] = m + 2;\n        _noteNum[k + '' + n] = m + 2;\n        _noteNum[k + '' + n] = m + 2;\n      }\n    }\n  });\n\n  for (n = 0; n < 128; n++) _noteNum[n] = n;\n\n  function _throw(x) {\n    throw RangeError('Bad MIDI value: ' + x);\n  }\n\n  function _bad(x) {\n    throw TypeError('Invalid value: ' + x);\n  }\n\n  function _oor(x) {\n    throw RangeError('Out of range: ' + x);\n  }\n\n  function _ch(c) {\n    _validateChannel(c);\n\n    return parseInt(c);\n  }\n\n  function _7b(n, m) {\n    if (n != parseInt(n) || n < 0 || n > 0x7f) _throw(typeof m == 'undefined' ? n : m);\n    return parseInt(n);\n  }\n\n  function _8b(n) {\n    if (n != parseInt(n) || n < 0 || n > 0xff) _throw(n);\n    return parseInt(n);\n  }\n\n  function _14b(n) {\n    if (n != parseInt(n) || n < 0 || n > 0x3fff) _throw(n);\n    return parseInt(n);\n  }\n\n  function _16b(n) {\n    if (n != parseInt(n) || n < 0 || n > 0xffff) throw RangeError('Expected a 16-bit value: ' + n);\n    return parseInt(n);\n  }\n\n  function _21b(n) {\n    if (n != parseInt(n) || n < 0 || n > 0x1fffff) _throw(n);\n    return parseInt(n);\n  }\n\n  function _7bn(n) {\n    return _7b(MIDI.noteValue(n), n);\n  }\n\n  function _lsb(n) {\n    return _14b(n) & 0x7f;\n  }\n\n  function _msb(n) {\n    return _14b(n) >> 7;\n  }\n\n  function _8bs(s) {\n    s = '' + s;\n\n    for (var i = 0; i < s.length; i++) if (s.charCodeAt(i) > 255) _throw(s[i]);\n\n    return s;\n  }\n\n  function _to777(n) {\n    return [n >> 14, n >> 7 & 0x7f, n & 0x7f];\n  }\n\n  function _01(x, y) {\n    if (x != parseFloat(x)) _bad(typeof y == 'undefined' ? x : y);\n    if (x < 0 || x > 1) _oor(typeof y == 'undefined' ? x : y);\n    return parseFloat(x);\n  }\n\n  function _rt(b) {\n    return typeof b != 'undefined' && !b ? 0x7E : 0x7F;\n  }\n\n  function _ntu(x) {\n    var k, m;\n    var kkk = [];\n    var vvv = {};\n\n    _for(x, function (k) {\n      m = _21b(x[k]);\n      k = _7bn(k);\n      if (k in vvv) throw RangeError('Duplicate MIDI value: ' + k);\n      kkk.push(k);\n      vvv[k] = m;\n    });\n\n    kkk.sort();\n    var out = [kkk.length];\n\n    for (k = 0; k < kkk.length; k++) out = out.concat([kkk[k]], _to777(vvv[kkk[k]]));\n\n    return out;\n  }\n\n  function _f2ntu(x) {\n    var out = {};\n\n    _for(x, function (k) {\n      out[k] = MIDI.to21b(x[k] == parseFloat(x[k]) ? x[k] : _7bn(x[k]));\n    });\n\n    return out;\n  }\n\n  function _hz2ntu(x) {\n    var out = {};\n\n    _for(x, function (k) {\n      out[k] = MIDI.to21b(MIDI.midi(x[k]));\n    });\n\n    return out;\n  }\n\n  function _12x7(a) {\n    var out = [];\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\n\n    for (var i = 0; i < 12; i++) out.push(_7b(a[i]));\n\n    return out;\n  }\n\n  function _12x14(a) {\n    var out = [];\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\n\n    for (var i = 0; i < 12; i++) {\n      out.push(_msb(a[i]));\n      out.push(_lsb(a[i]));\n    }\n\n    return out;\n  }\n\n  var _helperMPE = {\n    noteOff: function (c, n, v) {\n      if (typeof v == 'undefined') v = 64;\n      return [0x80 + _ch(c), _7bn(n), _7b(v)];\n    },\n    noteOn: function (c, n, v) {\n      if (typeof v == 'undefined') v = 127;\n      return [0x90 + _ch(c), _7bn(n), _7b(v)];\n    },\n    aftertouch: function (c, n, v) {\n      return [0xA0 + _ch(c), _7bn(n), _7b(v)];\n    }\n  };\n  var _helperCH = {\n    control: function (c, n, v) {\n      return [0xB0 + _ch(c), _7b(n), _7b(v)];\n    },\n    program: function (c, n) {\n      return [0xC0 + _ch(c), _7b(MIDI.programValue(n), n)];\n    },\n    pressure: function (c, n) {\n      return [0xD0 + _ch(c), _7b(n)];\n    },\n    pitchBend: function (c, n, l) {\n      return typeof l == 'undefined' ? [0xE0 + _ch(c), _lsb(n), _msb(n)] : [0xE0 + _ch(c), _7b(l), _7b(n)];\n    },\n    pitchBendF: function (c, x) {\n      return _helperCH.pitchBend(c, MIDI.to14b((x + 1) / 2));\n    },\n    bankMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x00, _7b(n)];\n    },\n    bankLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x20, _7b(n)];\n    },\n    modMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x01, _7b(n)];\n    },\n    modLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x21, _7b(n)];\n    },\n    breathMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x02, _7b(n)];\n    },\n    breathLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x22, _7b(n)];\n    },\n    footMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x04, _7b(n)];\n    },\n    footLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x24, _7b(n)];\n    },\n    portamentoMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x05, _7b(n)];\n    },\n    portamentoLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x25, _7b(n)];\n    },\n    dataMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x06, _7b(n)];\n    },\n    dataLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x26, _7b(n)];\n    },\n    volumeMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x07, _7b(n)];\n    },\n    volumeLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x27, _7b(n)];\n    },\n    balanceMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x08, _7b(n)];\n    },\n    balanceLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x28, _7b(n)];\n    },\n    panMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x0A, _7b(n)];\n    },\n    panLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x2A, _7b(n)];\n    },\n    expressionMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x0B, _7b(n)];\n    },\n    expressionLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x2B, _7b(n)];\n    },\n    damper: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x40, b ? 127 : 0];\n    },\n    portamento: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x41, b ? 127 : 0];\n    },\n    sostenuto: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x42, b ? 127 : 0];\n    },\n    soft: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x43, b ? 127 : 0];\n    },\n    legato: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x44, b ? 127 : 0];\n    },\n    hold2: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x45, b ? 127 : 0];\n    },\n    soundVariation: function (c, n) {\n      return [0xB0 + _ch(c), 0x46, _7bn(n)];\n    },\n    filterResonance: function (c, n) {\n      return [0xB0 + _ch(c), 0x47, _7bn(n)];\n    },\n    releaseTime: function (c, n) {\n      return [0xB0 + _ch(c), 0x48, _7bn(n)];\n    },\n    attackTime: function (c, n) {\n      return [0xB0 + _ch(c), 0x49, _7bn(n)];\n    },\n    brightness: function (c, n) {\n      return [0xB0 + _ch(c), 0x4A, _7bn(n)];\n    },\n    decayTime: function (c, n) {\n      return [0xB0 + _ch(c), 0x4B, _7bn(n)];\n    },\n    vibratoRate: function (c, n) {\n      return [0xB0 + _ch(c), 0x4C, _7bn(n)];\n    },\n    vibratoDepth: function (c, n) {\n      return [0xB0 + _ch(c), 0x4D, _7bn(n)];\n    },\n    vibratoDelay: function (c, n) {\n      return [0xB0 + _ch(c), 0x4E, _7bn(n)];\n    },\n    ptc: function (c, n) {\n      return [0xB0 + _ch(c), 0x54, _7bn(n)];\n    },\n    dataIncr: function (c) {\n      return [0xB0 + _ch(c), 0x60, 0];\n    },\n    dataDecr: function (c) {\n      return [0xB0 + _ch(c), 0x61, 0];\n    },\n    nrpnLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x62, _7b(n)];\n    },\n    nrpnMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x63, _7b(n)];\n    },\n    rpnLSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x64, _7b(n)];\n    },\n    rpnMSB: function (c, n) {\n      return [0xB0 + _ch(c), 0x65, _7b(n)];\n    },\n    allSoundOff: function (c) {\n      return [0xB0 + _ch(c), 0x78, 0];\n    },\n    resetAllControllers: function (c) {\n      return [0xB0 + _ch(c), 0x79, 0];\n    },\n    localControl: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), 0x7a, b ? 127 : 0];\n    },\n    allNotesOff: function (c) {\n      return [0xB0 + _ch(c), 0x7b, 0];\n    },\n    omni: function (c, b) {\n      if (typeof b == 'undefined') b = true;\n      return [0xB0 + _ch(c), b ? 0x7d : 0x7c, 0];\n    },\n    mono: function (c, n) {\n      if (typeof n == 'undefined') n = 1;\n      return [0xB0 + _ch(c), 0x7e, _7b(n)];\n    },\n    poly: function (c) {\n      return [0xB0 + _ch(c), 0x7f, 0];\n    }\n  };\n\n  function _splitMasterTuning(a, b, c, d) {\n    if (typeof b != 'undefined') return [_7b(a), _7b(b), _7b(c), _7b(d)];\n    if (a != parseInt(a) || a < 0 || n > 0xffff) _bad(a);\n    a = parseInt(a);\n    return [a >> 12 & 0xf, a >> 8 & 0xf, a >> 4 & 0xf, a & 0xf];\n  }\n\n  function _gsxg12b(x) {\n    // -1 <= x <= 1\n    _float(x);\n\n    return Math.round(x * 1000 + 0x400);\n  }\n\n  var _helperNC = {\n    // no channel\n    mtc: function (t) {\n      return [0xF1, _mtc(t)];\n    },\n    songPosition: function (n, l) {\n      return typeof l == 'undefined' ? [0xF2, _lsb(n), _msb(n)] : [0xF2, _7b(l), _7b(n)];\n    },\n    songSelect: function (n) {\n      return [0xF3, _7b(n)];\n    },\n    tune: function () {\n      return [0xF6];\n    },\n    clock: function () {\n      return [0xF8];\n    },\n    start: function () {\n      return [0xFA];\n    },\n    continue: function () {\n      return [0xFB];\n    },\n    stop: function () {\n      return [0xFC];\n    },\n    active: function () {\n      return [0xFE];\n    },\n    sxIdRequest: function () {\n      return [0xF0, 0x7E, this._sxid, 0x06, 0x01, 0xF7];\n    },\n    sxTuningDumpRequest: function (n, k) {\n      return typeof k == 'undefined' ? [0xF0, 0x7E, this._sxid, 0x08, 0x00, _7b(n), 0xF7] : [0xF0, 0x7E, this._sxid, 0x08, 0x03, _7b(n), _7b(k), 0xF7];\n    },\n    sxFullFrame: function (t) {\n      return [0xF0, 0x7F, this._sxid, 0x01, 0x01, _hrtype(t), t.getMinute(), t.getSecond(), t.getFrame(), 0xF7];\n    },\n    sxMasterVolume: function (n, l) {\n      return typeof l == 'undefined' ? [0xF0, 0x7F, this._sxid, 0x04, 0x01, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x01, _7b(l), _7b(n), 0xF7];\n    },\n    sxMasterVolumeF: function (x) {\n      return _helperNC.sxMasterVolume.call(this, MIDI.to14b(_01(x)));\n    },\n    sxMasterFineTuning: function (n, l) {\n      return typeof l == 'undefined' ? [0xF0, 0x7F, this._sxid, 0x04, 0x03, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x03, _7b(l), _7b(n), 0xF7];\n    },\n    sxMasterFineTuningF: function (x) {\n      return _helperNC.sxMasterFineTuning.call(this, MIDI.to14b(_01((x % 1 + 1) / 2, x)));\n    },\n    sxMasterCoarseTuning: function (n) {\n      return [0xF0, 0x7F, this._sxid, 0x04, 0x04, 0x00, _7b(n), 0xF7];\n    },\n    sxMasterCoarseTuningF: function (x) {\n      return _helperNC.sxMasterCoarseTuning.call(this, 0x40 + (x - x % 1));\n    },\n    sxNoteTuning: function (a, b, c, d) {\n      return b == parseInt(b) ? [0xF0, _rt(d), this._sxid, 0x08, 0x07, _7b(a), _7b(b)].concat(_ntu(c), [0xF7]) : [0xF0, 0x7F, this._sxid, 0x08, 0x02, _7b(a)].concat(_ntu(b), [0xF7]);\n    },\n    sxNoteTuningF: function (a, b, c, d) {\n      return b == parseInt(b) ? _helperNC.sxNoteTuning.call(this, a, b, _f2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _f2ntu(b));\n    },\n    sxNoteTuningHZ: function (a, b, c, d) {\n      return b == parseInt(b) ? _helperNC.sxNoteTuning.call(this, a, b, _hz2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _hz2ntu(b));\n    },\n    sxScaleTuning1: function (a, b, c) {\n      return a == parseInt(a) ? [0xF0, _rt(c), this._sxid, 0x08, 0x08].concat(_to777(_16b(a)), _12x7(b), [0xF7]) : _helperNC.sxScaleTuning1.call(this, 0xffff, a, b);\n    },\n    sxScaleTuning1F: function (a, b, c) {\n      if (a != parseInt(a)) return _helperNC.sxScaleTuning1F.call(this, 0xffff, a, b);\n      var v = [];\n\n      for (var i = 0; i < b.length; i++) {\n        if (b[i] < -0.64 || b[i] > 0.63) throw RangeError('Out of range: ' + b[i]);\n        v.push(Math.floor(b[i] * 100 + 64));\n      }\n\n      return _helperNC.sxScaleTuning1.call(this, a, v, c);\n    },\n    sxScaleTuning2: function (a, b, c) {\n      return a == parseInt(a) ? [0xF0, _rt(c), this._sxid, 0x08, 0x09].concat(_to777(_16b(a)), _12x14(b), [0xF7]) : _helperNC.sxScaleTuning2.call(this, 0xffff, a, b);\n    },\n    sxScaleTuning2F: function (a, b, c) {\n      if (a != parseInt(a)) return _helperNC.sxScaleTuning2F.call(this, 0xffff, a, b);\n      var v = [];\n\n      for (var i = 0; i < b.length; i++) {\n        var x = (b[i] + 1) / 2;\n        if (x < -1 || x > 1) throw RangeError('Out of range: ' + b[i]);\n        v.push(MIDI.to14b((b[i] + 1) / 2));\n      }\n\n      return _helperNC.sxScaleTuning2.call(this, a, v, c);\n    },\n    sxGM: function (gm) {\n      if (typeof gm == 'undefined') gm = 1;\n      return [0xF0, 0x7E, this._sxid, 0x09, gm ? gm == 2 ? 3 : 1 : 2, 0xf7];\n    },\n    sxGS: function (arg) {\n      var arr = typeof arg == 'undefined' ? [0x40, 0, 0x7F, 0] : arg instanceof Array ? arg : arguments;\n      var c = 0;\n      var a = [0xF0, 0x41, this._sxid, 0x42, 0x12];\n\n      for (var i = 0; i < arr.length; i++) {\n        var x = _7b(arr[i]);\n\n        a.push(x);\n        c += x;\n      }\n\n      c %= 128;\n      a.push(c ? 128 - c : 0);\n      a.push(0xf7);\n      return a;\n    },\n    sxXG: function (arg) {\n      var arr = typeof arg == 'undefined' ? [0, 0, 0x7E, 0] : arg instanceof Array ? arg : arguments;\n      var sxid = this._sxid == 0x7f ? 0 : this._sxid;\n      if (sxid > 15) _throw('Bad Yamaha device number: ' + sxid);\n      var a = [0xf0, 0x43, 16 + sxid, 0x4c];\n\n      for (var i = 0; i < arr.length; i++) a.push(_7b(arr[i]));\n\n      a.push(0xf7);\n      return a;\n    },\n    sxMidiSoft: function (n, s) {\n      var a = [0xf0, 0x00, 0x20, 0x24, 0x00, _7b(n || 0)];\n      s = typeof s == 'undefined' ? '' : '' + s;\n\n      for (var i = 0; i < s.length; i++) a.push(_7b(s.charCodeAt(i)));\n\n      a.push(0xf7);\n      return a;\n    },\n    gsMasterVolume: function (n) {\n      return _helperNC.sxGS.call(this, [0x40, 0, 4, _7b(n)]);\n    },\n    gsMasterVolumeF: function (x) {\n      return _helperNC.gsMasterVolume.call(this, MIDI.to7b(_01(x)));\n    },\n    gsMasterFineTuning: function (a, b, c, d) {\n      a = _splitMasterTuning(a, b, c, d);\n      return _helperNC.sxGS.call(this, [0x40, 0, 0, a[0], a[1], a[2], a[3]]);\n    },\n    gsMasterFineTuningF: function (x) {\n      return _helperNC.gsMasterFineTuning.call(this, _gsxg12b(x % 1));\n    },\n    gsMasterCoarseTuning: function (n) {\n      return _helperNC.sxGS.call(this, [0x40, 0, 5, _7b(n)]);\n    },\n    gsMasterCoarseTuningF: function (x) {\n      return _helperNC.gsMasterCoarseTuning.call(this, 0x40 + (x - x % 1));\n    },\n    gsOctaveTuning: function (c, n, x) {\n      return _helperNC.sxGS.call(this, [0x40, 0x10 + [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 11, 12, 13, 14, 15][_ch(c)], 0x40 + MIDI.octaveValue(n), _7b(x)]);\n    },\n    gsOctaveTuningF: function (c, n, x) {\n      if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\n      return _helperNC.gsOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64));\n    },\n    xgMasterVolume: function (n) {\n      return _helperNC.sxXG.call(this, [0, 0, 4, _7b(n)]);\n    },\n    xgMasterVolumeF: function (x) {\n      return _helperNC.xgMasterVolume.call(this, MIDI.to7b(_01(x)));\n    },\n    xgMasterFineTuning: function (a, b, c, d) {\n      a = _splitMasterTuning(a, b, c, d);\n      return _helperNC.sxXG.call(this, [0, 0, 0, a[0], a[1], a[2], a[3]]);\n    },\n    xgMasterFineTuningF: function (x) {\n      return _helperNC.xgMasterFineTuning.call(this, _gsxg12b(x % 1));\n    },\n    xgMasterCoarseTuning: function (n) {\n      return _helperNC.sxXG.call(this, [0, 0, 6, _7b(n)]);\n    },\n    xgMasterCoarseTuningF: function (x) {\n      return _helperNC.xgMasterCoarseTuning.call(this, 0x40 + (x - x % 1));\n    },\n    xgOctaveTuning: function (c, n, x) {\n      return _helperNC.sxXG.call(this, [8, _ch(c), 0x41 + MIDI.octaveValue(n), _7b(x)]);\n    },\n    xgOctaveTuningF: function (c, n, x) {\n      if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\n      return _helperNC.xgOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64));\n    },\n    reset: function () {\n      return [0xFF];\n    }\n  };\n  _helperNC.sxScaleTuning = _helperNC.sxScaleTuning2;\n  _helperNC.sxScaleTuningF = _helperNC.sxScaleTuning2F;\n  _helperNC.sxMasterTranspose = _helperNC.sxMasterCoarseTuning;\n  _helperNC.sxMasterTransposeF = _helperNC.sxMasterCoarseTuningF;\n  _helperNC.gsMasterTranspose = _helperNC.gsMasterCoarseTuning;\n  _helperNC.gsMasterTransposeF = _helperNC.gsMasterCoarseTuningF;\n  _helperNC.xgMasterTranspose = _helperNC.xgMasterCoarseTuning;\n  _helperNC.xgMasterTransposeF = _helperNC.xgMasterCoarseTuningF;\n  var _helperGCH = {\n    // compound messages\n    bank: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.bankMSB(c, _msb(m)), _helperCH.bankLSB(c, _lsb(m))] : [_helperCH.bankMSB(c, m), _helperCH.bankLSB(c, l)];\n    },\n    modF: function (c, x) {\n      return _helperGCH.mod(c, MIDI.to14b(x));\n    },\n    mod: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.modMSB(c, _msb(m)), _helperCH.modLSB(c, _lsb(m))] : [_helperCH.modMSB(c, m), _helperCH.modLSB(c, l)];\n    },\n    breathF: function (c, x) {\n      return _helperGCH.breath(c, MIDI.to14b(x));\n    },\n    breath: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.breathMSB(c, _msb(m)), _helperCH.breathLSB(c, _lsb(m))] : [_helperCH.breathMSB(c, m), _helperCH.breathLSB(c, l)];\n    },\n    footF: function (c, x) {\n      return _helperGCH.foot(c, MIDI.to14b(x));\n    },\n    foot: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.footMSB(c, _msb(m)), _helperCH.footLSB(c, _lsb(m))] : [_helperCH.footMSB(c, m), _helperCH.footLSB(c, l)];\n    },\n    portamentoTimeF: function (c, x) {\n      return _helperGCH.portamentoTime(c, MIDI.to14b(x));\n    },\n    portamentoTime: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.portamentoMSB(c, _msb(m)), _helperCH.portamentoLSB(c, _lsb(m))] : [_helperCH.portamentoMSB(c, m), _helperCH.portamentoLSB(c, l)];\n    },\n    dataF: function (c, x) {\n      return _helperGCH.data(c, MIDI.to14b(x));\n    },\n    data: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.dataMSB(c, _msb(m)), _helperCH.dataLSB(c, _lsb(m))] : [_helperCH.dataMSB(c, m), _helperCH.dataLSB(c, l)];\n    },\n    volumeF: function (c, x) {\n      return _helperGCH.volume(c, MIDI.to14b(x));\n    },\n    volume: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.volumeMSB(c, _msb(m)), _helperCH.volumeLSB(c, _lsb(m))] : [_helperCH.volumeMSB(c, m), _helperCH.volumeLSB(c, l)];\n    },\n    balanceF: function (c, x) {\n      return _helperGCH.balance(c, MIDI.to14b((x + 1) / 2));\n    },\n    balance: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.balanceMSB(c, _msb(m)), _helperCH.balanceLSB(c, _lsb(m))] : [_helperCH.balanceMSB(c, m), _helperCH.balanceLSB(c, l)];\n    },\n    panF: function (c, x) {\n      return _helperGCH.pan(c, MIDI.to14b((x + 1) / 2));\n    },\n    pan: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.panMSB(c, _msb(m)), _helperCH.panLSB(c, _lsb(m))] : [_helperCH.panMSB(c, m), _helperCH.panLSB(c, l)];\n    },\n    expressionF: function (c, x) {\n      return _helperGCH.expression(c, MIDI.to14b(x));\n    },\n    expression: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.expressionMSB(c, _msb(m)), _helperCH.expressionLSB(c, _lsb(m))] : [_helperCH.expressionMSB(c, m), _helperCH.expressionLSB(c, l)];\n    },\n    nrpn: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.nrpnMSB(c, _msb(m)), _helperCH.nrpnLSB(c, _lsb(m))] : [_helperCH.nrpnMSB(c, m), _helperCH.nrpnLSB(c, l)];\n    },\n    rpn: function (c, m, l) {\n      return typeof l == 'undefined' ? [_helperCH.rpnMSB(c, _msb(m)), _helperCH.rpnLSB(c, _lsb(m))] : [_helperCH.rpnMSB(c, m), _helperCH.rpnLSB(c, l)];\n    },\n    rpnPitchBendRange: function (c, m, l) {\n      return _helperGCH.rpn(c, 0, 0).concat(_helperGCH.data(c, m, l));\n    },\n    rpnPitchBendRangeF: function (c, x) {\n      return _helperGCH.rpnPitchBendRange(c, _7b(x - x % 1), Math.floor(x % 1 * 100));\n    },\n    rpnFineTuning: function (c, m, l) {\n      return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.data(c, m, l));\n    },\n    rpnFineTuningF: function (c, x) {\n      return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.dataF(c, (x % 1 + 1) / 2));\n    },\n    rpnCoarseTuning: function (c, m) {\n      return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, m)]);\n    },\n    rpnCoarseTuningF: function (c, x) {\n      return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, 0x40 + (x - x % 1))]);\n    },\n    rpnTuning: function (c, n, m, l) {\n      return _helperGCH.rpnCoarseTuning(c, n).concat(_helperGCH.rpnFineTuning(c, m, l));\n    },\n    rpnTuningF: function (c, x) {\n      return _helperGCH.rpnCoarseTuningF(c, x).concat(_helperGCH.rpnFineTuningF(c, x));\n    },\n    rpnTuningA: function (c, a) {\n      return _helperGCH.rpnTuningF(c, MIDI.shift(a));\n    },\n    rpnSelectTuningProgram: function (c, n) {\n      return _helperGCH.rpn(c, 0, 3).concat([_helperCH.dataMSB(c, n)]);\n    },\n    rpnSelectTuningBank: function (c, n) {\n      return _helperGCH.rpn(c, 0, 4).concat([_helperCH.dataMSB(c, n)]);\n    },\n    rpnSelectTuning: function (c, n, k) {\n      return typeof k == 'undefined' ? _helperGCH.rpnSelectTuningProgram(c, n) : _helperGCH.rpnSelectTuningBank(c, n).concat(_helperGCH.rpnSelectTuningProgram(c, k));\n    },\n    rpnModulationDepthRange: function (c, m, l) {\n      return _helperGCH.rpn(c, 0, 5).concat(_helperGCH.data(c, m, l));\n    },\n    rpnModulationDepthRangeF: function (c, x) {\n      return _helperGCH.rpnModulationDepthRange(c, _7b(x - x % 1), Math.floor(x % 1 * 128));\n    },\n    rpnNull: function (c) {\n      return _helperGCH.rpn(c, 0x7f, 0x7f);\n    },\n    mode1: function (c) {\n      return [_helperCH.omni(c, true), _helperCH.poly(c)];\n    },\n    mode2: function (c) {\n      return [_helperCH.omni(c, true), _helperCH.mono(c)];\n    },\n    mode3: function (c) {\n      return [_helperCH.omni(c, false), _helperCH.poly(c)];\n    },\n    mode4: function (c) {\n      return [_helperCH.omni(c, false), _helperCH.mono(c)];\n    }\n  };\n  var _helperGNC = {\n    // compound messages no channel\n    sxMasterTuning: function (n, m, l) {\n      return [_helperNC.sxMasterCoarseTuning.call(this, n), _helperNC.sxMasterFineTuning.call(this, m, l)];\n    },\n    sxMasterTuningF: function (x) {\n      return [_helperNC.sxMasterCoarseTuningF.call(this, x), _helperNC.sxMasterFineTuningF.call(this, x)];\n    },\n    gsMasterTuningF: function (x) {\n      return [_helperNC.gsMasterCoarseTuningF.call(this, x), _helperNC.gsMasterFineTuningF.call(this, x)];\n    },\n    xgMasterTuningF: function (x) {\n      return [_helperNC.xgMasterCoarseTuningF.call(this, x), _helperNC.xgMasterFineTuningF.call(this, x)];\n    },\n    sxMasterTuningA: function (a) {\n      return _helperGNC.sxMasterTuningF.call(this, MIDI.shift(a));\n    },\n    gsMasterTuningA: function (a) {\n      return _helperGNC.gsMasterTuningF.call(this, MIDI.shift(a));\n    },\n    xgMasterTuningA: function (a) {\n      return _helperGNC.xgMasterTuningF.call(this, MIDI.shift(a));\n    },\n    gsScaleTuning: function (c, a) {\n      var out = [];\n      if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuning.call(this, c, i, a[i]));\n\n      return out;\n    },\n    gsScaleTuningF: function (c, a) {\n      var out = [];\n      if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuningF.call(this, c, i, a[i]));\n\n      return out;\n    },\n    xgScaleTuning: function (c, a) {\n      var out = [];\n      if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuning.call(this, c, i, a[i]));\n\n      return out;\n    },\n    xgScaleTuningF: function (c, a) {\n      var out = [];\n      if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\n\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuningF.call(this, c, i, a[i]));\n\n      return out;\n    }\n  };\n\n  function _smf(ff, dd) {\n    var midi = new MIDI();\n    midi.ff = _8b(ff);\n    midi.dd = typeof dd == 'undefined' ? '' : _8bs(dd);\n    return midi;\n  }\n\n  var _helperSMF = {\n    // Standard MIDI File events\n    smf: function (arg) {\n      if (arg instanceof MIDI) return new MIDI(arg);\n      var arr = arg instanceof Array ? arg : arguments;\n\n      var ff = _8b(arr[0]);\n\n      var dd = '';\n      if (arr.length == 2) dd = _2s(arr[1]);else if (arr.length > 2) dd = _2s(Array.prototype.slice.call(arr, 1));\n      return _smf(ff, dd);\n    },\n    smfSeqNumber: function (dd) {\n      if (dd == parseInt(dd)) {\n        if (dd < 0 || dd > 0xffff) throw RangeError('Sequence number out of range: ' + dd);\n        dd = String.fromCharCode(dd >> 8) + String.fromCharCode(dd & 0xff);\n      } else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00\\x00';else if (dd.length == 1) dd = '\\x00' + dd;else if (dd.length > 2) throw RangeError('Sequence number out of range' + _smftxt(dd));\n      }\n\n      return _smf(0, dd);\n    },\n    smfText: function (dd) {\n      return _smf(1, JZZ.lib.toUTF8(dd));\n    },\n    smfCopyright: function (dd) {\n      return _smf(2, JZZ.lib.toUTF8(dd));\n    },\n    smfSeqName: function (dd) {\n      return _smf(3, JZZ.lib.toUTF8(dd));\n    },\n    smfInstrName: function (dd) {\n      return _smf(4, JZZ.lib.toUTF8(dd));\n    },\n    smfLyric: function (dd) {\n      return _smf(5, JZZ.lib.toUTF8(dd));\n    },\n    smfMarker: function (dd) {\n      return _smf(6, JZZ.lib.toUTF8(dd));\n    },\n    smfCuePoint: function (dd) {\n      return _smf(7, JZZ.lib.toUTF8(dd));\n    },\n    smfProgName: function (dd) {\n      return _smf(8, JZZ.lib.toUTF8(dd));\n    },\n    smfDevName: function (dd) {\n      return _smf(9, JZZ.lib.toUTF8(dd));\n    },\n    smfChannelPrefix: function (dd) {\n      if (dd == parseInt(dd)) {\n        _validateChannel(dd);\n\n        dd = String.fromCharCode(dd);\n      } else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00';else if (dd.length > 1 || dd.charCodeAt(0) > 15) throw RangeError('Channel number out of range' + _smftxt(dd));\n      }\n\n      return _smf(32, dd);\n    },\n    smfMidiPort: function (dd) {\n      if (dd == parseInt(dd)) {\n        if (dd < 0 || dd > 127) throw RangeError('Port number out of range: ' + dd);\n        dd = String.fromCharCode(dd);\n      } else {\n        dd = '' + dd;\n        if (dd.length == 0) dd = '\\x00';else if (dd.length > 1 || dd.charCodeAt(0) > 127) throw RangeError('Port number out of range' + _smftxt(dd));\n      }\n\n      return _smf(33, dd);\n    },\n    smfEndOfTrack: function (dd) {\n      if (_2s(dd) != '') throw RangeError('Unexpected data' + _smftxt(_2s(dd)));\n      return _smf(47);\n    },\n    smfTempo: function (dd) {\n      // microseconds per quarter note\n      if (('' + dd).length == 3) return _smf(81, dd);\n\n      if (dd == parseInt(dd) && dd > 0 && dd <= 0xffffff) {\n        return _smf(81, String.fromCharCode(dd >> 16) + String.fromCharCode(dd >> 8 & 0xff) + String.fromCharCode(dd & 0xff));\n      }\n\n      throw RangeError('Out of range' + _smftxt(_2s(dd)));\n    },\n    smfBPM: function (bpm) {\n      return _helperSMF.smfTempo(Math.round(60000000.0 / bpm));\n    },\n    smfSMPTE: function (dd) {\n      if (dd instanceof SMPTE) return _smf(84, String.fromCharCode(dd.hour) + String.fromCharCode(dd.minute) + String.fromCharCode(dd.second) + String.fromCharCode(dd.frame) + String.fromCharCode(dd.quarter % 4 * 25));\n      var s = '' + dd;\n\n      if (s.length == 5) {\n        return _smf(84, dd);\n      }\n\n      var arr = dd instanceof Array ? dd : Array.prototype.slice.call(arguments);\n      arr.splice(0, 0, 30);\n      return _helperSMF.smfSMPTE(new SMPTE(arr));\n    },\n    smfTimeSignature: function (a, b, c, d) {\n      var nn, dd, cc, bb;\n      var m = ('' + a).match(/^\\s*(\\d+)\\s*\\/\\s*(\\d+)\\s*$/);\n\n      if (m) {\n        nn = parseInt(m[1]);\n        dd = parseInt(m[2]);\n\n        if (nn > 0 && nn < 0x100 && dd > 0 && !(dd & dd - 1)) {\n          cc = dd;\n          dd = 0;\n\n          for (cc >>= 1; cc; cc >>= 1) dd++;\n\n          cc = b == parseInt(b) ? b : 24;\n          bb = c == parseInt(c) ? c : 8;\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\n        } else if (('' + a).length == 4) return _smf(88, a);\n      } else if (a == parseInt(a) && b == parseInt(b)) {\n        if (a > 0 && a < 0x100 && b > 0 && !(b & b - 1)) {\n          nn = a;\n          dd = 0;\n          cc = b;\n\n          for (cc >>= 1; cc; cc >>= 1) dd++;\n\n          cc = c == parseInt(c) ? c : 24;\n          bb = d == parseInt(d) ? d : 8;\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\n        } else if (('' + a).length == 4) return _smf(88, a);\n\n        a = a + '/' + b;\n      } else if (('' + a).length == 4) return _smf(88, a);\n\n      throw RangeError('Wrong time signature' + _smftxt(_2s('' + a)));\n    },\n    smfKeySignature: function (dd) {\n      dd = '' + dd;\n      var m = dd.match(/^\\s*([A-H][b#]?)\\s*(|maj|major|dur|m|min|minor|moll)\\s*$/i);\n\n      if (m) {\n        var sf = {\n          CB: 0,\n          GB: 1,\n          DB: 2,\n          AB: 3,\n          EB: 4,\n          BB: 5,\n          F: 6,\n          C: 7,\n          G: 8,\n          D: 9,\n          A: 10,\n          E: 11,\n          B: 12,\n          H: 12,\n          'F#': 13,\n          'C#': 14,\n          'G#': 15,\n          'D#': 16,\n          'A#': 17\n        }[m[1].toUpperCase()];\n        var mi = {\n          '': 0,\n          MAJ: 0,\n          MAJOR: 0,\n          DUR: 0,\n          M: 1,\n          MIN: 1,\n          MINOR: 1,\n          MOLL: 1\n        }[m[2].toUpperCase()];\n\n        if (typeof sf != 'undefined' && typeof mi != 'undefined') {\n          if (mi) sf -= 3;\n          sf -= 7;\n          if (sf >= -7 && sf < 0) dd = String.fromCharCode(256 + sf) + String.fromCharCode(mi);else if (sf >= 0 && sf <= 7) dd = String.fromCharCode(sf) + String.fromCharCode(mi);\n        }\n      }\n\n      if (dd.length == 2 && dd.charCodeAt(1) <= 1 && (dd.charCodeAt(0) <= 7 || dd.charCodeAt(0) <= 255 && dd.charCodeAt(0) >= 249)) return _smf(89, dd);\n      throw RangeError('Incorrect key signature' + _smftxt(dd));\n    },\n    smfSequencer: function (dd) {\n      return _smf(127, _2s(dd));\n    }\n  };\n  var _helpers = {};\n\n  function _copyHelperNC(name, func) {\n    MIDI[name] = function () {\n      return new MIDI(func.apply(this, arguments));\n    };\n\n    _helpers[name] = function () {\n      return this.send(func.apply(this, arguments));\n    };\n  }\n\n  function _copyHelperSMF(name, func) {\n    MIDI[name] = function () {\n      return func.apply(this, arguments);\n    };\n\n    _helpers[name] = function () {\n      return this.send(func.apply(this, arguments));\n    };\n  }\n\n  function _copyHelperGNC(name, func) {\n    MIDI[name] = function () {\n      var i;\n      var g = [];\n      var a = func.apply(this, arguments);\n\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\n\n      return g;\n    };\n\n    _helpers[name] = function () {\n      var a = func.apply(this, arguments);\n      var g = this;\n\n      for (var i = 0; i < a.length; i++) g = g.send(a[i]);\n\n      return g;\n    };\n  }\n\n  function _copyHelperMPE(name, func) {\n    MIDI[name] = function () {\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n\n    _helpers[name] = function () {\n      if (typeof this._master != 'undefined') {\n        var msg = new MIDI(func.apply(this, [this._master].concat(Array.prototype.slice.call(arguments))));\n        msg._mpe = msg[1];\n        return this.send(msg);\n      }\n\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n  }\n\n  function _copyHelperCH(name, func) {\n    MIDI[name] = function () {\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n\n    _helpers[name] = function () {\n      if (typeof this._master != 'undefined') {\n        var chan;\n        var args = Array.prototype.slice.call(arguments);\n        if (args.length < func.length) args = [this._master].concat(args);else {\n          chan = _7bn(args[0]);\n          args[0] = this._master;\n        }\n        var msg = new MIDI(func.apply(this, args));\n        msg._mpe = chan;\n        return this.send(msg);\n      }\n\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\n    };\n  }\n\n  function _copyHelperGCH(name, func) {\n    MIDI[name] = function () {\n      var i;\n      var g = [];\n      var a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\n\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\n\n      return g;\n    };\n\n    _helpers[name] = function () {\n      var i;\n      var a;\n      var g;\n\n      if (typeof this._master != 'undefined') {\n        var chan;\n        var args = Array.prototype.slice.call(arguments);\n        if (args.length < func.length) args = [this._master].concat(args);else {\n          chan = _7bn(args[0]);\n          args[0] = this._master;\n        }\n        a = func.apply(this, args);\n        g = this;\n\n        for (i = 0; i < a.length; i++) {\n          var msg = MIDI(a[i]);\n          msg._mpe = chan;\n          g = g.send(msg);\n        }\n\n        return g;\n      }\n\n      a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\n      g = this;\n\n      for (i = 0; i < a.length; i++) g = g.send(a[i]);\n\n      return g;\n    };\n  }\n\n  _for(_helperNC, function (n) {\n    _copyHelperNC(n, _helperNC[n]);\n  });\n\n  _for(_helperSMF, function (n) {\n    _copyHelperSMF(n, _helperSMF[n]);\n  });\n\n  _for(_helperGNC, function (n) {\n    _copyHelperGNC(n, _helperGNC[n]);\n  });\n\n  _for(_helperMPE, function (n) {\n    _copyHelperMPE(n, _helperMPE[n]);\n  });\n\n  _for(_helperCH, function (n) {\n    _copyHelperCH(n, _helperCH[n]);\n  });\n\n  _for(_helperGCH, function (n) {\n    _copyHelperGCH(n, _helperGCH[n]);\n  });\n\n  function _copyMidiHelpers(M) {\n    _for(_helpers, function (n) {\n      M.prototype[n] = _helpers[n];\n    });\n  }\n\n  _copyMidiHelpers(_M);\n\n  var _channelMap = {\n    a: 10,\n    b: 11,\n    c: 12,\n    d: 13,\n    e: 14,\n    f: 15,\n    A: 10,\n    B: 11,\n    C: 12,\n    D: 13,\n    E: 14,\n    F: 15\n  };\n\n  for (k = 0; k < 16; k++) _channelMap[k] = k;\n\n  MIDI.prototype.getChannel = function () {\n    if (this.ff == 0x20 && this.dd.length == 1 && this.dd.charCodeAt(0) < 16) return this.dd.charCodeAt(0);\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xef) return;\n    return c & 15;\n  };\n\n  MIDI.prototype.setChannel = function (x) {\n    x = _channelMap[x];\n    if (typeof x == 'undefined') return this;\n    if (this.ff == 0x20) this.dd = String.fromCharCode(x);else {\n      var c = this[0];\n      if (typeof c != 'undefined' && c >= 0x80 && c <= 0xef) this[0] = c & 0xf0 | x;\n    }\n    return this;\n  };\n\n  MIDI.prototype.getNote = function () {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return;\n    return this[1];\n  };\n\n  MIDI.prototype.setNote = function (x) {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return this;\n    x = MIDI.noteValue(x);\n    if (typeof x != 'undefined') this[1] = x;\n    return this;\n  };\n\n  MIDI.prototype.getVelocity = function () {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return;\n    return this[2];\n  };\n\n  MIDI.prototype.setVelocity = function (x) {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return this;\n    x = parseInt(x);\n    if (x >= 0 && x < 128) this[2] = x;\n    return this;\n  };\n\n  MIDI.prototype.getSysExId = function () {\n    if (this[0] == 0xf0) return this[2];\n  };\n\n  MIDI.prototype.setSysExId = function (x) {\n    if (this[0] == 0xf0 && this.length > 2) {\n      x = parseInt(x);\n      if (x >= 0 && x < 128) this[2] = x;\n    }\n\n    return this;\n  };\n\n  MIDI.prototype.getData = function () {\n    if (typeof this.dd != 'undefined') return this.dd.toString();\n  };\n\n  MIDI.prototype.setData = function (dd) {\n    this.dd = _2s(dd);\n    return this;\n  };\n\n  function _is_yamaha_smf(ff, dd) {\n    return ff == 0x7f && typeof dd != 'undefined' && dd.charCodeAt(0) == 0x43 && dd.charCodeAt(1) == 0x7b;\n  }\n\n  function _is_yamaha_chord(ff, dd) {\n    return _is_yamaha_smf(ff, dd) && dd.charCodeAt(2) == 1;\n  }\n\n  function _yamaha_chord(a, b) {\n    if (a >= 0 && a <= 0x7f && b >= 0 && b <= 0x7f) {\n      var c = a & 0xf;\n      var d = a >> 4;\n      if (c > 0 && c < 8 && d < 7) c = ['C', 'D', 'E', 'F', 'G', 'A', 'B'][c - 1] + ['bbb', 'bb', 'b', '', '#', '##', '###'][d];else return '-';\n      if (b > 34) return c + '?';else return c + ['', '6', 'Maj7', 'Maj7(#11)', '(9)', 'Maj7(9)', '6(9)', 'aug', 'm', 'm6', 'm7', 'm7b5', 'm(9)', 'm7(9)', 'm7(11)', 'm+7', 'm+7(9)', 'dim', 'dim7', '7', '7sus4', '7b5', '7(9)', '7(#11)', '7(13)', '7(b9)', '7(b13)', '7(#9)', 'Maj7aug', '7aug', '1+8', '1+5', 'sus4', '1+2+5', 'cc'][b];\n    }\n\n    return '-';\n  }\n\n  MIDI.prototype.getText = function () {\n    if (typeof this.dd != 'undefined') {\n      if (_is_yamaha_chord(this.ff, this.dd)) return _yamaha_chord(this.dd.charCodeAt(3), this.dd.charCodeAt(4));else return JZZ.lib.fromUTF8(this.dd);\n    }\n\n    if (this.isMidiSoft()) {\n      var s = [];\n\n      for (var i = 6; i < this.length - 1; i++) s.push(String.fromCharCode(this[i]));\n\n      return s.join('');\n    }\n  };\n\n  MIDI.prototype.setText = function (dd) {\n    this.dd = JZZ.lib.toUTF8(dd);\n    return this;\n  };\n\n  MIDI.prototype.getTempo = function () {\n    if (this.ff == 0x51 && typeof this.dd != 'undefined') {\n      return this.dd.charCodeAt(0) * 65536 + this.dd.charCodeAt(1) * 256 + this.dd.charCodeAt(2);\n    }\n  };\n\n  MIDI.prototype.getBPM = function () {\n    var ms = this.getTempo();\n    if (ms) return 60000000 / ms;\n  };\n\n  MIDI.prototype.getTimeSignature = function () {\n    if (this.ff == 0x58 && typeof this.dd != 'undefined') {\n      return [this.dd.charCodeAt(0), 1 << this.dd.charCodeAt(1)];\n    }\n  };\n\n  MIDI.prototype.getKeySignature = function () {\n    if (this.ff == 0x59 && typeof this.dd != 'undefined') {\n      var sf = this.dd.charCodeAt(0);\n      var mi = this.dd.charCodeAt(1);\n      if (sf & 0x80) sf = sf - 0x100;\n\n      if (sf >= -7 && sf <= 7 && mi >= 0 && mi <= 1) {\n        return [sf, ['Cb', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F', 'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#'][mi ? sf + 10 : sf + 7], !!mi];\n      }\n    }\n  };\n\n  MIDI.prototype.isNoteOn = function () {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x90 || c > 0x9f) return false;\n    return this[2] > 0 ? true : false;\n  };\n\n  MIDI.prototype.isNoteOff = function () {\n    var c = this[0];\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return false;\n    if (c < 0x90) return true;\n    return this[2] == 0 ? true : false;\n  };\n\n  MIDI.prototype.isSysEx = function () {\n    return this[0] == 0xf0;\n  };\n\n  MIDI.prototype.isFullSysEx = function () {\n    return this[0] == 0xf0 && this[this.length - 1] == 0xf7;\n  };\n\n  MIDI.prototype.isMidiSoft = function () {\n    return this.isFullSysEx() && this[1] == 0 && this[2] == 0x20 && this[3] == 0x24 && this[4] == 0;\n  };\n\n  MIDI.prototype.isSMF = function () {\n    return this.ff >= 0 && this.ff <= 0x7f;\n  };\n\n  MIDI.prototype.isEOT = function () {\n    return this.ff == 0x2f;\n  };\n\n  MIDI.prototype.isTempo = function () {\n    return this.ff == 0x51;\n  };\n\n  MIDI.prototype.isTimeSignature = function () {\n    return this.ff == 0x58;\n  };\n\n  MIDI.prototype.isKeySignature = function () {\n    return this.ff == 0x59;\n  };\n\n  MIDI.prototype.isGmReset = function () {\n    return this.match([0xf0, 0x7e, [0, 0], 0x09, [0, 0], 0xf7]);\n  };\n\n  MIDI.prototype.isGsReset = function () {\n    return this.match([0xf0, 0x41, [0, 0], 0x42, 0x12, 0x40, 0, 0x7f, 0, 0x41, 0xf7]);\n  };\n\n  MIDI.prototype.isXgReset = function () {\n    return this.match([0xf0, 0x43, [0x10, 0xf0], 0x4c, 0, 0, 0x7e, 0, 0xf7]);\n  };\n\n  MIDI.prototype.match = function (a) {\n    var i, m;\n\n    for (i = 0; i < a.length; i++) {\n      m = a[i][1];\n\n      if (typeof m == 'undefined') {\n        if (this[i] != a[i]) return false;\n      } else {\n        if ((this[i] & m) != (a[i][0] & m)) return false;\n      }\n    }\n\n    return true;\n  };\n\n  function _s2a(x) {\n    var a = [];\n\n    for (var i = 0; i < x.length; i++) {\n      a[i] = x.charCodeAt(i);\n    }\n\n    return a;\n  }\n\n  function _a2s(x) {\n    var a = '';\n\n    for (var i = 0; i < x.length; i++) {\n      a += String.fromCharCode(x[i]);\n    }\n\n    return a;\n  }\n\n  function _2s(x) {\n    return x instanceof Array ? _a2s(x) : typeof x == 'undefined' ? '' : '' + x;\n  }\n\n  function _s2n(x) {\n    var n = 0;\n\n    for (var i = 0; i < x.length; i++) n = (n << 8) + x.charCodeAt(i);\n\n    return n;\n  }\n\n  function __hex(x) {\n    return (x < 16 ? '0' : '') + x.toString(16);\n  }\n\n  function _hex(x) {\n    var a = [];\n\n    for (var i = 0; i < x.length; i++) {\n      a[i] = __hex(x[i]);\n    }\n\n    return a.join(' ');\n  }\n\n  function _toLine(s) {\n    var out = '';\n\n    for (var i = 0; i < s.length; i++) {\n      if (s[i] == '\\n') out += '\\\\n';else if (s[i] == '\\r') out += '\\\\r';else if (s[i] == '\\t') out += '\\\\t';else if (s.charCodeAt(i) < 32) out += '\\\\x' + __hex(s.charCodeAt(i));else out += s[i];\n    }\n\n    return out;\n  }\n\n  function _smfhex(dd) {\n    return dd.length ? ': ' + _hex(_s2a(dd)) : '';\n  }\n\n  function _smftxt(dd) {\n    return dd.length ? ': ' + _toLine(JZZ.lib.fromUTF8(dd)) : '';\n  }\n\n  MIDI.prototype.label = function (s) {\n    this.lbl = this.lbl ? this.lbl + ', ' + s : s;\n    return this;\n  };\n\n  MIDI.prototype.toString = function () {\n    return this.lbl ? this._str() + ' (' + this.lbl + ')' : this._str();\n  };\n\n  MIDI.prototype._str = function () {\n    var s;\n    var ss;\n\n    if (!this.length) {\n      if (typeof this.ff != 'undefined') {\n        s = 'ff' + __hex(this.ff) + ' -- ';\n        if (this.ff == 0) s += 'Sequence Number: ' + _s2n(this.dd);else if (this.ff > 0 && this.ff < 10) s += ['', 'Text', 'Copyright', 'Sequence Name', 'Instrument Name', 'Lyric', 'Marker', 'Cue Point', 'Program Name', 'Device Name'][this.ff] + _smftxt(this.dd);else if (this.ff == 32) s += 'Channel Prefix' + _smfhex(this.dd);else if (this.ff == 33) s += 'MIDI Port' + _smfhex(this.dd);else if (this.ff == 47) s += 'End of Track' + _smfhex(this.dd);else if (this.ff == 81) {\n          var bpm = Math.round(this.getBPM() * 100) / 100;\n          s += 'Tempo: ' + bpm + ' bpm';\n        } else if (this.ff == 84) s += 'SMPTE Offset: ' + _smptetxt(_s2a(this.dd));else if (this.ff == 88) {\n          var d = 1 << this.dd.charCodeAt(1);\n          s += 'Time Signature: ' + this.dd.charCodeAt(0) + '/' + d;\n          s += ' ' + this.dd.charCodeAt(2) + ' ' + this.dd.charCodeAt(3);\n        } else if (this.ff == 89) {\n          s += 'Key Signature: ';\n          var ks = this.getKeySignature();\n\n          if (ks) {\n            s += ks[1];\n            if (ks[2]) s += ' min';\n          } else s += 'invalid';\n        } else if (this.ff == 127) {\n          if (this.dd.charCodeAt(0) == 0x43) {\n            if (this.dd.charCodeAt(1) == 0x7b) {\n              s += '[XF:' + __hex(this.dd.charCodeAt(2)) + ']';\n              ss = {\n                0: 'Version',\n                1: 'Chord',\n                2: 'Rehearsal Mark',\n                3: 'Phrase Mark',\n                4: 'Max Phrase Mark',\n                5: 'Fingering Number',\n                12: 'Guide Track Flag',\n                16: 'Guitar Info',\n                18: 'Chord Voicing',\n                127: 'XG Song Data Number'\n              }[this.dd.charCodeAt(2)];\n              s += ss ? ' ' + ss : '';\n              s += ': ';\n\n              if (this.dd.charCodeAt(2) == 0) {\n                return s + this.dd.substr(3, 4) + ' ' + _hex(_s2a(this.dd.substr(7)));\n              }\n\n              if (this.dd.charCodeAt(2) == 1) {\n                return s + this.getText();\n              }\n\n              return s + _hex(_s2a(this.dd.substr(3)));\n            }\n          }\n\n          s += 'Sequencer Specific' + _smfhex(this.dd);\n        } else s += 'SMF' + _smfhex(this.dd);\n        return s;\n      }\n\n      return 'empty';\n    }\n\n    s = _hex(this);\n    if (this[0] < 0x80) return s;\n    ss = {\n      241: 'MIDI Time Code',\n      242: 'Song Position',\n      243: 'Song Select',\n      244: 'Undefined',\n      245: 'Undefined',\n      246: 'Tune request',\n      248: 'Timing clock',\n      249: 'Undefined',\n      250: 'Start',\n      251: 'Continue',\n      252: 'Stop',\n      253: 'Undefined',\n      254: 'Active Sensing',\n      255: 'Reset'\n    }[this[0]];\n    if (ss) return s + ' -- ' + ss;\n\n    if (this.isMidiSoft()) {\n      ss = _toLine(this.getText());\n      if (ss) ss = ' ' + ss;\n      return s + ' -- [K:' + __hex(this[5]) + ']' + ss;\n    }\n\n    var c = this[0] >> 4;\n    ss = {\n      8: 'Note Off',\n      10: 'Aftertouch',\n      12: 'Program Change',\n      13: 'Channel Aftertouch',\n      14: 'Pitch Wheel'\n    }[c];\n    if (ss) return s + ' -- ' + ss;\n    if (c == 9) return s + ' -- ' + (this[2] ? 'Note On' : 'Note Off');\n    if (c != 11) return s;\n    ss = {\n      0: 'Bank Select MSB',\n      1: 'Modulation Wheel MSB',\n      2: 'Breath Controller MSB',\n      4: 'Foot Controller MSB',\n      5: 'Portamento Time MSB',\n      6: 'Data Entry MSB',\n      7: 'Channel Volume MSB',\n      8: 'Balance MSB',\n      10: 'Pan MSB',\n      11: 'Expression Controller MSB',\n      12: 'Effect Control 1 MSB',\n      13: 'Effect Control 2 MSB',\n      16: 'General Purpose Controller 1 MSB',\n      17: 'General Purpose Controller 2 MSB',\n      18: 'General Purpose Controller 3 MSB',\n      19: 'General Purpose Controller 4 MSB',\n      31: 'Karaoke',\n      32: 'Bank Select LSB',\n      33: 'Modulation Wheel LSB',\n      34: 'Breath Controller LSB',\n      36: 'Foot Controller LSB',\n      37: 'Portamento Time LSB',\n      38: 'Data Entry LSB',\n      39: 'Channel Volume LSB',\n      40: 'Balance LSB',\n      42: 'Pan LSB',\n      43: 'Expression Controller LSB',\n      44: 'Effect control 1 LSB',\n      45: 'Effect control 2 LSB',\n      48: 'General Purpose Controller 1 LSB',\n      49: 'General Purpose Controller 2 LSB',\n      50: 'General Purpose Controller 3 LSB',\n      51: 'General Purpose Controller 4 LSB',\n      64: 'Damper Pedal',\n      65: 'Portamento',\n      66: 'Sostenuto',\n      67: 'Soft Pedal',\n      68: 'Legato',\n      69: 'Hold 2',\n      70: 'Sound Variation',\n      71: 'Filter Resonance',\n      72: 'Release Time',\n      73: 'Attack Time',\n      74: 'Brightness',\n      75: 'Decay Time',\n      76: 'Vibrato Rate',\n      77: 'Vibrato Depth',\n      78: 'Vibrato Delay',\n      79: 'Sound Controller 10',\n      80: 'General Purpose Controller 5',\n      81: 'General Purpose Controller 6',\n      82: 'General Purpose Controller 7',\n      83: 'General Purpose Controller 8',\n      84: 'Portamento Control',\n      88: 'High Resolution Velocity Prefix',\n      91: 'Effects 1 Depth',\n      92: 'Effects 2 Depth',\n      93: 'Effects 3 Depth',\n      94: 'Effects 4 Depth',\n      95: 'Effects 5 Depth',\n      96: 'Data Increment',\n      97: 'Data Decrement',\n      98: 'Non-Registered Parameter Number LSB',\n      99: 'Non-Registered Parameter Number MSB',\n      100: 'Registered Parameter Number LSB',\n      101: 'Registered Parameter Number MSB',\n      120: 'All Sound Off',\n      121: 'Reset All Controllers',\n      122: 'Local Control On/Off',\n      123: 'All Notes Off',\n      124: 'Omni Mode Off',\n      125: 'Omni Mode On',\n      126: 'Mono Mode On',\n      127: 'Poly Mode On'\n    }[this[1]];\n    if (this[1] >= 64 && this[1] <= 69) ss += this[2] < 64 ? ' Off' : ' On';\n    if (!ss) ss = 'Undefined';\n    return s + ' -- ' + ss;\n  };\n\n  MIDI.prototype._stamp = function (obj) {\n    this._from.push(obj._orig ? obj._orig : obj);\n\n    return this;\n  };\n\n  MIDI.prototype._unstamp = function (obj) {\n    if (typeof obj == 'undefined') this._from = [];else {\n      if (obj._orig) obj = obj._orig;\n\n      var i = this._from.indexOf(obj);\n\n      if (i > -1) this._from.splice(i, 1);\n    }\n    return this;\n  };\n\n  MIDI.prototype._stamped = function (obj) {\n    if (obj._orig) obj = obj._orig;\n\n    for (var i = 0; i < this._from.length; i++) if (this._from[i] == obj) return true;\n\n    return false;\n  };\n\n  JZZ.MIDI = MIDI;\n  _J.prototype.MIDI = MIDI;\n\n  function _clear_ctxt() {\n    var i;\n    this._cc = [];\n\n    for (i = 0; i < 16; i++) this._cc[i] = {};\n  }\n\n  function _rpn_txt(msb, lsb) {\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\n    var c = {\n      '0000': 'Pitch Bend Sensitivity',\n      '0001': 'Channel Fine Tune',\n      '0002': 'Channel Coarse Tune',\n      '0003': 'Select Tuning Program',\n      '0004': 'Select Tuning Bank',\n      '0005': 'Vibrato Depth Range',\n      '7f7f': 'NONE'\n    }[a + '' + b];\n    return 'RPN ' + a + ' ' + b + (c ? ': ' + c : '');\n  }\n\n  function _nrpn_txt(msb, lsb) {\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\n    return 'NRPN ' + a + ' ' + b;\n  }\n\n  function _read_ctxt(msg) {\n    if (!msg.length || msg[0] < 0x80) return msg;\n\n    if (msg[0] == 0xff) {\n      this._clear();\n\n      return msg;\n    }\n\n    var ch = msg[0] & 15;\n    var st = msg[0] >> 4;\n    var s;\n\n    if (st == 12) {\n      msg._bm = this._cc[ch].bm;\n      msg._bl = this._cc[ch].bl;\n      if (JZZ.MIDI.programName) msg.label(JZZ.MIDI.programName(msg[1], msg._bm, msg._bl));\n    } else if (st == 11) {\n      switch (msg[1]) {\n        case 0:\n          this._cc[ch].bm = msg[2];\n          break;\n\n        case 32:\n          this._cc[ch].bl = msg[2];\n          break;\n\n        case 98:\n          this._cc[ch].nl = msg[2];\n          this._cc[ch].rn = 'n';\n          break;\n\n        case 99:\n          this._cc[ch].nm = msg[2];\n          this._cc[ch].rn = 'n';\n          break;\n\n        case 100:\n          this._cc[ch].rl = msg[2];\n          this._cc[ch].rn = 'r';\n          break;\n\n        case 101:\n          this._cc[ch].rm = msg[2];\n          this._cc[ch].rn = 'r';\n          break;\n\n        case 6:\n        case 38:\n        case 96:\n        case 97:\n          if (this._cc[ch].rn == 'r') {\n            msg._rm = this._cc[ch].rm;\n            msg._rl = this._cc[ch].rl;\n            msg.label(_rpn_txt(this._cc[ch].rm, this._cc[ch].rl));\n          }\n\n          if (this._cc[ch].rn == 'n') {\n            msg._nm = this._cc[ch].rm;\n            msg._nl = this._cc[ch].nl;\n            msg.label(_nrpn_txt(this._cc[ch].nm, this._cc[ch].nl));\n          }\n\n          break;\n      }\n    } else if (msg.isFullSysEx()) {\n      if (msg[1] == 0x7f) {\n        if (msg[3] == 4) {\n          s = {\n            1: 'Master Volume',\n            2: 'Master Balance',\n            3: 'Master Fine Tuning',\n            4: 'Master Coarse Tuning'\n          }[msg[4]];\n          if (s) msg.label(s);\n        } else if (msg[3] == 8) {\n          s = {\n            2: 'Note Tuning',\n            7: 'Note Tuning, Bank',\n            8: 'Scale Tuning, 1 byte format',\n            9: 'Scale Tuning, 2 byte format'\n          }[msg[4]];\n          if (s) msg.label(s);\n        }\n      } else if (msg[1] == 0x7e) {\n        if (msg[3] == 6) {\n          if (msg[4] == 1) msg.label('Device ID Request');else if (msg[4] == 2) {\n            msg.label('Device ID Response');\n          }\n        } else if (msg[3] == 8) {\n          s = {\n            0: 'Bulk Tuning Dump Request',\n            1: 'Bulk Tuning Dump',\n            3: 'Bulk Tuning Dump Request, Bank',\n            4: 'Bulk Tuning Dump, Bank',\n            5: 'Scale Tuning Dump, 1 byte format',\n            6: 'Scale Tuning Dump, 2 byte format',\n            7: 'Note Tuning, Bank',\n            8: 'Scale Tuning, 1 byte format',\n            9: 'Scale Tuning, 2 byte format'\n          }[msg[4]];\n          if (s) msg.label(s);\n        } else if (msg[3] == 9) {\n          if (msg[4] == 1) {\n            msg.label('GM1 System On');\n\n            this._clear();\n\n            this._gm = '1';\n          } else if (msg[4] == 2) {\n            msg.label('GM System Off');\n\n            this._clear();\n\n            this._gm = '0';\n          } else if (msg[4] == 3) {\n            msg.label('GM2 System On');\n\n            this._clear();\n\n            this._gm = '2';\n          }\n        }\n      } else if (msg[1] == 0x43) {\n        if ((msg[2] & 0xf0) == 0x10 && msg[3] == 0x4c) {\n          if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0x7e && msg[7] == 0) {\n            msg.label('XG System On');\n\n            this._clear();\n\n            this._gm = 'Y';\n          } else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0) msg.label('XG Master Tuning');else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 4) msg.label('XG Master Volume');else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 6) msg.label('XG Master Transpose');else if (msg[4] == 8 && msg[5] < 16 && msg[6] >= 0x41 && msg[6] <= 0x4c) msg.label('XG Scale Tuning');else msg.label('XG Parameter');\n        }\n      } else if (msg[1] == 0x41) {\n        if (msg[3] == 0x42 && msg[4] == 0x12) {\n          if (msg[5] == 0x40) {\n            if (msg[6] == 0) {\n              if (msg[7] == 0x7f && msg[8] == 0 && msg[9] == 0x41) {\n                msg.label('GS Reset');\n\n                this._clear();\n\n                this._gm = 'R';\n              } else if (msg[7] == 0) msg.label('GS Master Tuning');else if (msg[7] == 4) msg.label('GS Master Volume');else if (msg[7] == 5) msg.label('GS Master Transpose');else msg.label('GS Parameter');\n            } else if ((msg[6] & 0xf0) == 0x10 && msg[7] == 0x15) msg.label('GS Drum Part Change');else if ((msg[6] & 0xf0) == 0x10 && msg[7] >= 0x40 && msg[7] <= 0x4b) msg.label('GS Scale Tuning');else msg.label('GS Parameter');\n          }\n\n          if (msg[5] == 0x41) msg.label('GS Parameter');\n        }\n      }\n    }\n\n    return msg;\n  }\n\n  function Context() {\n    var self = new _M();\n    self._clear = _clear_ctxt;\n    self._read = _read_ctxt;\n\n    self._receive = function (msg) {\n      this._emit(this._read(msg));\n    };\n\n    self._clear();\n\n    self._resume();\n\n    return self;\n  }\n\n  JZZ.Context = Context;\n  _J.prototype.Context = Context;\n\n  function MPE() {\n    var self = this instanceof MPE ? this : self = new MPE();\n    self.reset();\n    if (arguments.length) MPE.prototype.setup.apply(self, arguments);\n    return self;\n  }\n\n  MPE.validate = function (arg) {\n    var a = arg instanceof Array ? arg : arguments;\n    if (a[0] != parseInt(a[0]) || a[0] < 0 || a[0] > 14) throw RangeError('Bad master channel value: ' + a[0]);\n    if (a[1] != parseInt(a[1]) || a[1] < 0 || a[0] + a[1] > 15) throw RangeError('Bad zone size value: ' + a[1]);\n  };\n\n  MPE.prototype.reset = function () {\n    for (var n = 0; n < 16; n++) this[n] = {\n      band: 0,\n      master: n\n    };\n  };\n\n  MPE.prototype.setup = function (m, n) {\n    MPE.validate(m, n);\n    var k;\n    var last = m + n;\n    if (this[m].master == m && this[m].band == n) return;\n    if (!n && !this[m].band) return;\n\n    if (this[m].band) {\n      k = m + this[m].band;\n      if (last < k) last = k;\n    } else if (this[m].master == m - 1) {\n      k = m - 1;\n      k = k + this[k].band;\n      if (last < k) last = k;\n      this[m - 1] = {\n        band: 0,\n        master: m - 1\n      };\n    } else if (this[m].master != m) {\n      k = this[m].master;\n      k = k + this[k].band;\n      if (last < k) last = k;\n      this[this[m].master].band = m - this[m].master - 1;\n    }\n\n    this[m].master = m;\n    this[m].band = n;\n\n    for (k = m + 1; k <= m + n; k++) {\n      if (this[k].band && last < k + this[k].band) last = k + this[k].band;\n      this[k] = {\n        band: 0,\n        master: m\n      };\n    }\n\n    for (; k <= last; k++) this[k] = {\n      band: 0,\n      master: k\n    };\n  };\n\n  MPE.prototype.filter = function (msg) {\n    var c = msg.getChannel();\n    if (!this[c] || !this[this[c].master].band) return msg;\n    var m = this[c].master;\n    var n = this[m].band;\n    var i, j, k;\n\n    if (typeof msg._mpe != 'undefined') {\n      k = 256;\n\n      for (i = m + 1; i <= m + n; i++) {\n        if (!this[i].notes) {\n          if (k > 0) {\n            c = i;\n            k = 0;\n          }\n        } else {\n          if (k > this[i].notes.length) {\n            c = i;\n            k = this[i].notes.length;\n          }\n\n          for (j = 0; j < this[i].notes.length; j++) {\n            if (this[i].notes[j] == msg._mpe) {\n              c = i;\n              k = -1;\n              break;\n            }\n          }\n        }\n      }\n\n      msg.setChannel(c);\n      msg._mpe = undefined;\n    }\n\n    if (c == m) return msg; // bad mpe\n\n    if (msg.isNoteOn()) {\n      if (!this[c].notes) this[c].notes = [];\n\n      _push(this[c].notes, msg.getNote());\n    } else if (msg.isNoteOff()) {\n      if (this[c].notes) _pop(this[c].notes, msg.getNote());\n    }\n\n    return msg;\n  };\n\n  JZZ.MPE = MPE;\n  JZZ.lib = {};\n  JZZ.lib.now = _now;\n  JZZ.lib.schedule = _schedule;\n\n  JZZ.lib.openMidiOut = function (name, engine) {\n    var port = new _M();\n\n    engine._openOut(port);\n\n    port._info = engine._info(name);\n    return port;\n  };\n\n  JZZ.lib.openMidiIn = function (name, engine) {\n    var port = new _M();\n\n    engine._openIn(port);\n\n    port._info = engine._info(name);\n    return port;\n  };\n\n  JZZ.lib.registerMidiOut = function (name, engine) {\n    var x = engine._info(name);\n\n    for (var i = 0; i < _virtual._outs.length; i++) if (_virtual._outs[i].name == x.name) return false;\n\n    x.engine = engine;\n\n    _virtual._outs.push(x);\n\n    if (_jzz) {\n      _postRefresh();\n\n      if (_jzz._bad) {\n        _jzz._repair();\n\n        _jzz._resume();\n      }\n    }\n\n    return true;\n  };\n\n  JZZ.lib.registerMidiIn = function (name, engine) {\n    var x = engine._info(name);\n\n    for (var i = 0; i < _virtual._ins.length; i++) if (_virtual._ins[i].name == x.name) return false;\n\n    x.engine = engine;\n\n    _virtual._ins.push(x);\n\n    if (_jzz) {\n      _postRefresh();\n\n      if (_jzz._bad) {\n        _jzz._repair();\n\n        _jzz._resume();\n      }\n    }\n\n    return true;\n  };\n\n  var _ac;\n\n  function _initAudioContext() {\n    if (!_ac && typeof window !== 'undefined') {\n      var AudioContext = window.AudioContext || window.webkitAudioContext;\n\n      if (AudioContext) {\n        _ac = new AudioContext();\n        if (_ac && !_ac.createGain) _ac.createGain = _ac.createGainNode;\n\n        var _activateAudioContext = function () {\n          if (_ac.state != 'running') {\n            _ac.resume();\n\n            var osc = _ac.createOscillator();\n\n            var gain = _ac.createGain();\n\n            try {\n              gain.gain.value = 0;\n            } catch (err) {}\n\n            gain.gain.setTargetAtTime(0, _ac.currentTime, 0.01);\n            osc.connect(gain);\n            gain.connect(_ac.destination);\n            if (!osc.start) osc.start = osc.noteOn;\n            if (!osc.stop) osc.stop = osc.noteOff;\n            osc.start(0.1);\n            osc.stop(0.11);\n          } else {\n            document.removeEventListener('touchstart', _activateAudioContext);\n            document.removeEventListener('touchend', _activateAudioContext);\n            document.removeEventListener('mousedown', _activateAudioContext);\n            document.removeEventListener('keydown', _activateAudioContext);\n          }\n        };\n\n        if (typeof document != 'undefined') {\n          document.addEventListener('touchstart', _activateAudioContext);\n          document.addEventListener('touchend', _activateAudioContext);\n          document.addEventListener('mousedown', _activateAudioContext);\n          document.addEventListener('keydown', _activateAudioContext);\n\n          _activateAudioContext();\n        }\n      }\n    }\n  }\n\n  JZZ.lib.copyMidiHelpers = _copyMidiHelpers;\n\n  JZZ.lib.getAudioContext = function () {\n    _initAudioContext();\n\n    return _ac;\n  };\n\n  var _b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n  JZZ.lib.fromBase64 = function (input) {\n    var output = '';\n    var chr1, chr2, chr3;\n    var enc1, enc2, enc3, enc4;\n    var i = 0;\n    input = input.replace(/[^A-Za-z0-9+/=]/g, '');\n\n    while (i < input.length) {\n      enc1 = _b64.indexOf(input.charAt(i++));\n      enc2 = _b64.indexOf(input.charAt(i++));\n      enc3 = _b64.indexOf(input.charAt(i++));\n      enc4 = _b64.indexOf(input.charAt(i++));\n      chr1 = enc1 << 2 | enc2 >> 4;\n      chr2 = (enc2 & 15) << 4 | enc3 >> 2;\n      chr3 = (enc3 & 3) << 6 | enc4;\n      output = output + String.fromCharCode(chr1);\n\n      if (enc3 != 64) {\n        output = output + String.fromCharCode(chr2);\n      }\n\n      if (enc4 != 64) {\n        output = output + String.fromCharCode(chr3);\n      }\n    }\n\n    return output;\n  };\n\n  JZZ.lib.toBase64 = function (data) {\n    var o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = '',\n        arr = [];\n    if (!data) return data;\n\n    do {\n      o1 = data.charCodeAt(i++);\n      o2 = data.charCodeAt(i++);\n      o3 = data.charCodeAt(i++);\n      bits = o1 << 16 | o2 << 8 | o3;\n      h1 = bits >> 18 & 0x3f;\n      h2 = bits >> 12 & 0x3f;\n      h3 = bits >> 6 & 0x3f;\n      h4 = bits & 0x3f;\n      arr[ac++] = _b64.charAt(h1) + _b64.charAt(h2) + _b64.charAt(h3) + _b64.charAt(h4);\n    } while (i < data.length);\n\n    enc = arr.join('');\n    var r = data.length % 3;\n    return r ? enc.slice(0, r - 3) + '==='.slice(r) : enc;\n  };\n\n  JZZ.lib.fromUTF8 = function (data) {\n    data = typeof data == 'undefined' ? '' : '' + data;\n    var out = '';\n    var i, n, m;\n\n    for (i = 0; i < data.length; i++) {\n      n = data.charCodeAt(i);\n      if (n > 0xff) return data;\n      if (n < 0x80) out += data[i];else if ((n & 0xe0) == 0xc0) {\n        n = (n & 0x1f) << 6;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += m & 0x3f;\n        out += String.fromCharCode(n);\n      } else if ((n & 0xf0) == 0xe0) {\n        n = (n & 0x0f) << 12;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 6;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += m & 0x3f;\n        out += String.fromCharCode(n);\n      } else if ((n & 0xf8) == 0xf0) {\n        n = (n & 0x07) << 18;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 12;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += (m & 0x3f) << 6;\n        i++;\n        if (i >= data.length) return data;\n        m = data.charCodeAt(i);\n        if ((m & 0xc0) != 0x80) return data;\n        n += m & 0x3f;\n        if (n > 0x10ffff) return data;\n        n -= 0x10000;\n        out += String.fromCharCode(0xd800 + (n >> 10));\n        out += String.fromCharCode(0xdc00 + (n & 0x3ff));\n      }\n    }\n\n    return out;\n  };\n\n  JZZ.lib.toUTF8 = function (data) {\n    data = typeof data == 'undefined' ? '' : '' + data;\n    var out = '';\n    var i, n;\n\n    for (i = 0; i < data.length; i++) {\n      n = data.charCodeAt(i);\n      if (n < 0x80) out += data[i];else if (n < 0x800) {\n        out += String.fromCharCode(0xc0 + (n >> 6));\n        out += String.fromCharCode(0x80 + (n & 0x3f));\n      } else if (n < 0x10000) {\n        out += String.fromCharCode(0xe0 + (n >> 12));\n        out += String.fromCharCode(0x80 + (n >> 6 & 0x3f));\n        out += String.fromCharCode(0x80 + (n & 0x3f));\n      }\n      /* istanbul ignore next */\n      else {\n          out += String.fromCharCode(0xf0 + (n >> 18));\n          out += String.fromCharCode(0x80 + (n >> 12 & 0x3f));\n          out += String.fromCharCode(0x80 + (n >> 6 & 0x3f));\n          out += String.fromCharCode(0x80 + (n & 0x3f));\n        }\n    }\n\n    return out;\n  }; // Web MIDI API\n\n\n  var _wma = [];\n  var _outputMap = {};\n  var _inputMap = {};\n  var Promise = _scope.Promise;\n  /* istanbul ignore next */\n\n  if (typeof Promise !== 'function') {\n    Promise = function (executor) {\n      this.executor = executor;\n    };\n\n    Promise.prototype.then = function (resolve, reject) {\n      if (typeof resolve !== 'function') {\n        resolve = _nop;\n      }\n\n      if (typeof reject !== 'function') {\n        reject = _nop;\n      }\n\n      this.executor(resolve, reject);\n    };\n  }\n\n  function DOMException(name, message, code) {\n    this.name = name;\n    this.message = message;\n    this.code = code;\n  }\n\n  function MIDIConnectionEvent(port, target) {\n    this.bubbles = false;\n    this.cancelBubble = false;\n    this.cancelable = false;\n    this.currentTarget = target;\n    this.defaultPrevented = false;\n    this.eventPhase = 0;\n    this.path = [];\n    this.port = port;\n    this.returnValue = true;\n    this.srcElement = target;\n    this.target = target;\n    this.timeStamp = _now();\n    this.type = 'statechange';\n  }\n\n  function MIDIMessageEvent(port, data) {\n    this.bubbles = false;\n    this.cancelBubble = false;\n    this.cancelable = false;\n    this.currentTarget = port;\n    this.data = data;\n    this.defaultPrevented = false;\n    this.eventPhase = 0;\n    this.path = [];\n    this.receivedTime = _now();\n    this.returnValue = true;\n    this.srcElement = port;\n    this.target = port;\n    this.timeStamp = this.receivedTime;\n    this.type = 'midimessage';\n  }\n\n  function _statechange(p, a) {\n    if (p) {\n      if (p.onstatechange) p.onstatechange(new MIDIConnectionEvent(p, p));\n      if (a.onstatechange) a.onstatechange(new MIDIConnectionEvent(p, a));\n    }\n  }\n\n  function MIDIInput(a, p) {\n    var self = this;\n    var _open = false;\n    var _ochng = null;\n    var _onmsg = null;\n    this.type = 'input';\n    this.id = p.id;\n    this.name = p.name;\n    this.manufacturer = p.man;\n    this.version = p.ver;\n    Object.defineProperty(this, 'state', {\n      get: function () {\n        return p.connected ? 'connected' : 'disconnected';\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'connection', {\n      get: function () {\n        return _open ? p.proxy ? 'open' : 'pending' : 'closed';\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'onmidimessage', {\n      get: function () {\n        return _onmsg;\n      },\n      set: function (value) {\n        if (_func(value)) {\n          _onmsg = value;\n          if (!_open) self.open().then(_nop, _nop);\n        } else _onmsg = null;\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'onstatechange', {\n      get: function () {\n        return _ochng;\n      },\n      set: function (value) {\n        if (_func(value)) _ochng = value;else _ochng = null;\n      },\n      enumerable: true\n    });\n\n    this.open = function () {\n      return new Promise(function (resolve, reject) {\n        if (_open) resolve(self);else {\n          p.open().then(function () {\n            if (!_open) {\n              _open = true;\n\n              _statechange(self, a);\n            }\n\n            resolve(self);\n          }, function () {\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\n          });\n        }\n      });\n    };\n\n    this.close = function () {\n      return new Promise(function (resolve\n      /*, reject*/\n      ) {\n        if (_open) {\n          _open = false;\n          p.close();\n\n          _statechange(self, a);\n        }\n\n        resolve(self);\n      });\n    };\n\n    Object.freeze(this);\n  }\n\n  function _split(q) {\n    var i, k;\n\n    while (q.length) {\n      for (i = 0; i < q.length; i++) if (q[i] == parseInt(q[i]) && q[i] >= 0x80 && q[i] <= 0xff && q[i] != 0xf7) break;\n\n      q.splice(0, i);\n      if (!q.length) return;\n\n      if (q[0] == 0xf0) {\n        for (i = 1; i < q.length; i++) if (q[i] == 0xf7) break;\n\n        if (i == q.length) return;\n        return q.splice(0, i + 1);\n      } else {\n        k = _datalen(q[0]) + 1;\n        if (k > q.length) return;\n\n        for (i = 1; i < k; i++) if (q[i] != parseInt(q[i]) || q[i] < 0 || q[i] >= 0x80) break;\n\n        if (i == k) return q.splice(0, i);else q.splice(0, i);\n      }\n    }\n  }\n\n  function _InputProxy(id, name, man, ver) {\n    var self = this;\n    this.id = id;\n    this.name = name;\n    this.man = man;\n    this.ver = ver;\n    this.connected = true;\n    this.ports = [];\n    this.pending = [];\n    this.proxy = undefined;\n    this.queue = [];\n\n    this.onmidi = function (msg) {\n      var m;\n      self.queue = self.queue.concat(msg.slice());\n\n      for (m = _split(self.queue); m; m = _split(self.queue)) {\n        for (i = 0; i < self.ports.length; i++) {\n          if (self.ports[i][0].onmidimessage && (m[0] != 0xf0 || self.ports[i][1])) {\n            self.ports[i][0].onmidimessage(new MIDIMessageEvent(self, new Uint8Array(m)));\n          }\n        }\n      }\n    };\n  }\n\n  _InputProxy.prototype.open = function () {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n      var i;\n      if (self.proxy || !self.connected) resolve();else {\n        self.pending.push([resolve, reject]);\n\n        if (self.pending.length == 1) {\n          JZZ().openMidiIn(self.name).or(function () {\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\n\n            self.pending = [];\n          }).and(function () {\n            self.proxy = this;\n            self.proxy.connect(self.onmidi);\n\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\n\n            self.pending = [];\n          });\n        }\n      }\n    });\n  };\n\n  _InputProxy.prototype.close = function () {\n    var i;\n\n    if (this.proxy) {\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\n\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n\n  _InputProxy.prototype.disconnect = function () {\n    this.connected = false;\n\n    if (this.proxy) {\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n\n  _InputProxy.prototype.reconnect = function () {\n    var self = this;\n    var i, p;\n    var a = [];\n    this.connected = true;\n\n    for (i = 0; i < _wma.length; i++) {\n      p = _wma[i].inputs.get(this.id);\n      if (p.connection == 'closed') _statechange(p, _wma[i]);else a.push([p, _wma[i]]);\n    }\n\n    if (a.length) {\n      JZZ()._openMidiInNR(self.name).or(function () {\n        for (i = 0; i < a.length; i++) a[i][0].close();\n      }).and(function () {\n        self.proxy = this;\n        self.proxy.connect(self.onmidi);\n\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\n      });\n    }\n  };\n\n  function _datalen(x) {\n    if (x >= 0x80 && x <= 0xbf || x >= 0xe0 && x <= 0xef || x == 0xf2) return 2;\n    if (x >= 0xc0 && x <= 0xdf || x == 0xf1 || x == 0xf3) return 1;\n    return 0;\n  }\n\n  var _epr = \"Failed to execute 'send' on 'MIDIOutput': \";\n\n  function _validate(arr, sysex) {\n    var i, k;\n    var msg;\n    var data = [];\n\n    for (i = 0; i < arr.length; i++) {\n      if (arr[i] != parseInt(arr[i]) || arr[i] < 0 || arr[i] > 255) throw TypeError(_epr + arr[i] + ' is not a UInt8 value.');\n    }\n\n    k = 0;\n\n    for (i = 0; i < arr.length; i++) {\n      if (!k) {\n        if (arr[i] < 0x80) throw TypeError(_epr + 'Running status is not allowed at index ' + i + ' (' + arr[i] + ').');\n        if (arr[i] == 0xf7) throw TypeError(_epr + 'Unexpected end of system exclusive message at index ' + i + ' (' + arr[i] + ').');\n        msg = [arr[i]];\n        data.push(msg);\n\n        if (arr[i] == 0xf0) {\n          if (!sysex) throw new DOMException('InvalidAccessError', _epr + 'System exclusive messag is not allowed at index ' + i + ' (' + arr[i] + ').', 15);\n          k = -1;\n\n          for (; i < arr.length; i++) {\n            msg.push(arr[i]);\n\n            if (arr[i] == 0xf7) {\n              k = 0;\n              break;\n            }\n          }\n        } else {\n          k = _datalen(arr[i]);\n        }\n      } else {\n        if (arr[i] > 0x7f) throw TypeError(_epr + 'Unexpected status byte at index ' + i + ' (' + arr[i] + ').');\n        msg.push(arr[i]);\n        k--;\n      }\n    }\n\n    if (k) throw TypeError(_epr + 'Message is incomplete');\n    return [data];\n  }\n\n  function MIDIOutput(a, p) {\n    var self = this;\n    var _open = false;\n    var _ochng = null;\n    this.type = 'output';\n    this.id = p.id;\n    this.name = p.name;\n    this.manufacturer = p.man;\n    this.version = p.ver;\n    Object.defineProperty(this, 'state', {\n      get: function () {\n        return p.connected ? 'connected' : 'disconnected';\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'connection', {\n      get: function () {\n        return _open ? p.proxy ? 'open' : 'pending' : 'closed';\n      },\n      enumerable: true\n    });\n    Object.defineProperty(this, 'onstatechange', {\n      get: function () {\n        return _ochng;\n      },\n      set: function (value) {\n        if (_func(value)) _ochng = value;else _ochng = null;\n      },\n      enumerable: true\n    });\n\n    this.open = function () {\n      return new Promise(function (resolve, reject) {\n        if (_open) resolve(self);else {\n          p.open().then(function () {\n            if (!_open) {\n              _open = true;\n\n              _statechange(self, a);\n            }\n\n            resolve(self);\n          }, function () {\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\n          });\n        }\n      });\n    };\n\n    this.close = function () {\n      return new Promise(function (resolve\n      /*, reject*/\n      ) {\n        if (_open) {\n          _open = false;\n          self.clear();\n          p.close();\n\n          _statechange(self, a);\n        }\n\n        resolve(self);\n      });\n    };\n\n    this.clear = function () {};\n\n    this.send = function (data, timestamp) {\n      _validate(data, a.sysexEnabled);\n\n      if (!p.connected) throw new DOMException('InvalidStateError', 'Port is not connected', 11);\n\n      if (_open) {\n        var now = _now();\n\n        if (timestamp > now) setTimeout(function () {\n          p.proxy.send(data);\n        }, timestamp - now);else p.proxy.send(data);\n      } else this.open().then(function () {\n        self.send(data, timestamp);\n      }, _nop);\n    };\n\n    Object.freeze(this);\n  }\n\n  function _OutputProxy(id, name, man, ver) {\n    this.id = id;\n    this.name = name;\n    this.man = man;\n    this.ver = ver;\n    this.connected = true;\n    this.ports = [];\n    this.pending = [];\n    this.proxy = undefined;\n  }\n\n  _OutputProxy.prototype.open = function () {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n      var i;\n      if (self.proxy || !self.connected) resolve();else {\n        self.pending.push([resolve, reject]);\n\n        if (self.pending.length == 1) {\n          JZZ().openMidiOut(self.name).or(function () {\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\n\n            self.pending = [];\n          }).and(function () {\n            self.proxy = this;\n\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\n\n            self.pending = [];\n          });\n        }\n      }\n    });\n  };\n\n  _OutputProxy.prototype.close = function () {\n    var i;\n\n    if (this.proxy) {\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\n\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n\n  _OutputProxy.prototype.disconnect = function () {\n    this.connected = false;\n\n    if (this.proxy) {\n      this.proxy.close();\n      this.proxy = undefined;\n    }\n  };\n\n  _OutputProxy.prototype.reconnect = function () {\n    var self = this;\n    var i, p;\n    var a = [];\n    this.connected = true;\n\n    for (i = 0; i < _wma.length; i++) {\n      p = _wma[i].outputs.get(this.id);\n      if (p.connection == 'closed') _statechange(p, _wma[i]);else a.push([p, _wma[i]]);\n    }\n\n    if (a.length) {\n      JZZ()._openMidiOutNR(self.name).or(function () {\n        for (i = 0; i < a.length; i++) a[i][0].close();\n      }).and(function () {\n        self.proxy = this;\n\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\n      });\n    }\n  };\n\n  function _Maplike(data) {\n    this.has = function (id) {\n      return data.hasOwnProperty(id) && data[id].connected;\n    };\n\n    this.keys = function () {\n      try {\n        // some old browsers may have no Map object\n        var m = new Map();\n\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n\n        return m.keys();\n      } catch (e) {}\n    };\n\n    this.values = function () {\n      try {\n        var m = new Map();\n\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n\n        return m.values();\n      } catch (e) {}\n    };\n\n    this.entries = function () {\n      try {\n        var m = new Map();\n\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\n\n        return m.entries();\n      } catch (e) {}\n    };\n\n    this.forEach = function (fun, self) {\n      if (typeof self == 'undefined') self = this;\n\n      for (var id in data) if (this.has(id)) fun.call(self, this.get(id), id, this);\n    };\n\n    Object.defineProperty(this, 'size', {\n      get: function () {\n        var len = 0;\n\n        for (var id in data) if (this.has(id)) len++;\n\n        return len;\n      },\n      enumerable: true\n    });\n  }\n\n  function MIDIInputMap(_access, _inputs) {\n    this.get = function (id) {\n      if (_inputMap.hasOwnProperty(id) && _inputMap[id].connected) {\n        if (!_inputs[id]) {\n          _inputs[id] = new MIDIInput(_access, _inputMap[id]);\n\n          _inputMap[id].ports.push([_inputs[id], _access.sysexEnabled]);\n        }\n\n        return _inputs[id];\n      }\n    };\n\n    Object.freeze(this);\n  }\n\n  MIDIInputMap.prototype = new _Maplike(_inputMap);\n  MIDIInputMap.prototype.constructor = MIDIInputMap;\n\n  function MIDIOutputMap(_access, _outputs) {\n    this.get = function (id) {\n      if (_outputMap.hasOwnProperty(id) && _outputMap[id].connected) {\n        if (!_outputs[id]) {\n          _outputs[id] = new MIDIOutput(_access, _outputMap[id]);\n\n          _outputMap[id].ports.push([_outputs[id], _access.sysexEnabled]);\n        }\n\n        return _outputs[id];\n      }\n    };\n\n    Object.freeze(this);\n  }\n\n  MIDIOutputMap.prototype = new _Maplike(_outputMap);\n  MIDIOutputMap.prototype.constructor = MIDIOutputMap;\n\n  function _wm_watch(x) {\n    var i, k, p, a;\n\n    for (i = 0; i < x.inputs.added.length; i++) {\n      p = x.inputs.added[i];\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\n\n      _inputMap[p.id].reconnect();\n    }\n\n    for (i = 0; i < x.outputs.added.length; i++) {\n      p = x.outputs.added[i];\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\n\n      _outputMap[p.id].reconnect();\n    }\n\n    for (i = 0; i < x.inputs.removed.length; i++) {\n      p = x.inputs.removed[i];\n\n      if (_inputMap.hasOwnProperty(p.id)) {\n        a = [];\n\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].inputs.get(p.id), _wma[k]]);\n\n        _inputMap[p.id].disconnect();\n\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\n      }\n    }\n\n    for (i = 0; i < x.outputs.removed.length; i++) {\n      p = x.outputs.removed[i];\n\n      if (_outputMap.hasOwnProperty(p.id)) {\n        a = [];\n\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].outputs.get(p.id), _wma[k]]);\n\n        _outputMap[p.id].disconnect();\n\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\n      }\n    }\n  }\n\n  function MIDIAccess(sysex) {\n    var _inputs = {};\n    var _outputs = {};\n    var _onstatechange = null;\n    var self = this;\n    this.sysexEnabled = sysex;\n    this.inputs = new MIDIInputMap(self, _inputs);\n    this.outputs = new MIDIOutputMap(self, _outputs);\n    Object.defineProperty(this, 'onstatechange', {\n      get: function () {\n        return _onstatechange;\n      },\n      set: function (f) {\n        _onstatechange = _func(f) ? f : null;\n      },\n      enumerable: true\n    });\n    Object.freeze(this);\n    var i;\n    var p;\n    var info = _jzz._info;\n\n    for (i = 0; i < info.inputs.length; i++) {\n      p = info.inputs[i];\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\n    }\n\n    for (i = 0; i < info.outputs.length; i++) {\n      p = info.outputs[i];\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\n    }\n\n    if (!_wma.length) JZZ().onChange(_wm_watch);\n\n    _wma.push(this);\n  }\n\n  JZZ.requestMIDIAccess = function (opt) {\n    return new Promise(function (resolve, reject) {\n      JZZ.JZZ(opt).or(function () {}).and(function () {\n        var sysex = !!(opt && opt.sysex);\n        if (sysex && !this.info().sysex) reject(new DOMException('SecurityError', 'Sysex is not allowed', 18));else {\n          var wma = new MIDIAccess(sysex);\n          resolve(wma);\n        }\n      });\n    });\n  };\n\n  if (typeof navigator !== 'undefined' && !navigator.requestMIDIAccess) navigator.requestMIDIAccess = JZZ.requestMIDIAccess;\n\n  JZZ.close = function () {\n    if (_engine._close) _engine._close();\n  };\n\n  return JZZ;\n});","map":{"version":3,"sources":["C:/Users/31505/Desktop/MemomusicFront1111-main/node_modules/jzz/javascript/JZZ.js"],"names":["global","factory","exports","module","define","amd","window","JZZ","MIDI","_scope","_version","i","j","k","m","n","_time","Date","now","getTime","_startTime","_now","performance","_schedule","f","setTimeout","_nop","_func","_R","_orig","_ready","_queue","_log","prototype","_exec","length","x","shift","apply","_push","func","arg","push","_slip","unshift","_pause","_resume","_break","err","_bad","_repair","_crash","_err","log","_clone","_dup","F","ret","_image","_thenable","then","self","good","bad","_then","Error","_wait","obj","delay","wait","_kick","_rechain","name","arguments","_and","q","console","and","_or","or","_info","info","engine","sysex","_close","close","_tryAny","arr","toString","_pop","splice","_J","_for","hasOwnProperty","call","key","val","Object","Array","ver","version","inputs","outputs","_outs","_ins","_outsW","_insW","_postRefresh","_jzz","_engine","_type","_sysex","_allOuts","_allIns","id","manufacturer","_virtual","type","_watcher","_handles","diff","_diff","removed","_inMap","_closeAll","_outMap","_fireW","_refresh","refresh","_filterList","before","after","etc","slice","a","RegExp","test","concat","_notFound","port","msg","_openMidiOut","pack","_openOut","openMidiOut","_M","_openMidiOutNR","_openMidiIn","_openIn","openMidiIn","_openMidiInNR","_onChange","watcher","_connectW","onChange","_W","_filter","_mpe","out","outs","filter","_receive","_emit","send","note","c","v","t","noteOn","_ch","_master","noteOff","_stamp","_stamped","emit","_connect","_disconnect","connect","disconnect","connected","dup","_sxid","_band","undefined","sxId","_7b","img","ch","MPE","setup","mpe","validate","_validateChannel","parseInt","RangeError","_watch","_disconnectW","_unwatch","_changed","x0","y0","x1","y1","ax","ay","rx","ry","h","added","_tryNODE","_initNode","require","_tryJazzPlugin","div","document","createElement","style","visibility","body","appendChild","width","height","classid","isJazz","_initJazzPlugin","_navigator","_requestMIDIAccess","_findMidiAccess","navigator","requestMIDIAccess","indexOf","_tryWebMIDI","onGood","midi","_initWebMIDI","onBad","opt","_tryWebMIDIsysex","_tryCRX","inst","eventHandle","getElementById","JSON","parse","innerText","removeEventListener","_initCRX","addEventListener","dispatchEvent","Event","_zeroBreak","_filterEngines","_filterEngineNames","degrade","_initNONE","web","none","head","tail","toLowerCase","_initJZZ","_options","_initEngineJP","_inArr","_outArr","_main","clients","MidiOutInfo","MidiInInfo","impl","_pool","_newPlugin","_closeOut","plugin","MidiOutRaw","open","s","MidiOutOpen","MidiOutClose","_impl","_closeIn","handle","makeHandle","onmidi","MidiInOpen","MidiInClose","setInterval","clearInterval","plg","access","_access","forEach","dev","found","evt","data","onmidimessage","onstatechange","refreshClients","_msg","ready","CustomEvent","detail","client","_start","output","input","split","ins","Widget","addMidiIn","widget","lib","registerMidiIn","addMidiOut","registerMidiOut","SMPTE","reset","setType","getType","setHour","getHour","setMinute","getMinute","setSecond","getSecond","setFrame","getFrame","setQuarter","getQuarter","_fixDropFrame","second","frame","minute","isFullFrame","quarter","hour","incrFrame","decrFrame","incrQF","backwards","decrQF","_825","read","_","_b","_f","_a","_mtc","_hrtype","_dec","_smptetxt","join","_from","noteValue","programValue","_throw","constructor","_noteNum","octaveValue","freq","_float","parseFloat","_7bn","Math","pow","TypeError","f0","log2","to7b","floor","to14b","to21b","_MIDI","_noteMap","d","e","g","b","_oor","_8b","_14b","_16b","_21b","_lsb","_msb","_8bs","charCodeAt","_to777","_01","y","_rt","_ntu","kkk","vvv","sort","_f2ntu","_hz2ntu","_12x7","_12x14","_helperMPE","aftertouch","_helperCH","control","program","pressure","pitchBend","l","pitchBendF","bankMSB","bankLSB","modMSB","modLSB","breathMSB","breathLSB","footMSB","footLSB","portamentoMSB","portamentoLSB","dataMSB","dataLSB","volumeMSB","volumeLSB","balanceMSB","balanceLSB","panMSB","panLSB","expressionMSB","expressionLSB","damper","portamento","sostenuto","soft","legato","hold2","soundVariation","filterResonance","releaseTime","attackTime","brightness","decayTime","vibratoRate","vibratoDepth","vibratoDelay","ptc","dataIncr","dataDecr","nrpnLSB","nrpnMSB","rpnLSB","rpnMSB","allSoundOff","resetAllControllers","localControl","allNotesOff","omni","mono","poly","_splitMasterTuning","_gsxg12b","round","_helperNC","mtc","songPosition","songSelect","tune","clock","start","continue","stop","active","sxIdRequest","sxTuningDumpRequest","sxFullFrame","sxMasterVolume","sxMasterVolumeF","sxMasterFineTuning","sxMasterFineTuningF","sxMasterCoarseTuning","sxMasterCoarseTuningF","sxNoteTuning","sxNoteTuningF","sxNoteTuningHZ","sxScaleTuning1","sxScaleTuning1F","sxScaleTuning2","sxScaleTuning2F","sxGM","gm","sxGS","sxXG","sxid","sxMidiSoft","gsMasterVolume","gsMasterVolumeF","gsMasterFineTuning","gsMasterFineTuningF","gsMasterCoarseTuning","gsMasterCoarseTuningF","gsOctaveTuning","gsOctaveTuningF","xgMasterVolume","xgMasterVolumeF","xgMasterFineTuning","xgMasterFineTuningF","xgMasterCoarseTuning","xgMasterCoarseTuningF","xgOctaveTuning","xgOctaveTuningF","sxScaleTuning","sxScaleTuningF","sxMasterTranspose","sxMasterTransposeF","gsMasterTranspose","gsMasterTransposeF","xgMasterTranspose","xgMasterTransposeF","_helperGCH","bank","modF","mod","breathF","breath","footF","foot","portamentoTimeF","portamentoTime","dataF","volumeF","volume","balanceF","balance","panF","pan","expressionF","expression","nrpn","rpn","rpnPitchBendRange","rpnPitchBendRangeF","rpnFineTuning","rpnFineTuningF","rpnCoarseTuning","rpnCoarseTuningF","rpnTuning","rpnTuningF","rpnTuningA","rpnSelectTuningProgram","rpnSelectTuningBank","rpnSelectTuning","rpnModulationDepthRange","rpnModulationDepthRangeF","rpnNull","mode1","mode2","mode3","mode4","_helperGNC","sxMasterTuning","sxMasterTuningF","gsMasterTuningF","xgMasterTuningF","sxMasterTuningA","gsMasterTuningA","xgMasterTuningA","gsScaleTuning","gsScaleTuningF","xgScaleTuning","xgScaleTuningF","_smf","ff","dd","_helperSMF","smf","_2s","smfSeqNumber","String","fromCharCode","_smftxt","smfText","toUTF8","smfCopyright","smfSeqName","smfInstrName","smfLyric","smfMarker","smfCuePoint","smfProgName","smfDevName","smfChannelPrefix","smfMidiPort","smfEndOfTrack","smfTempo","smfBPM","bpm","smfSMPTE","smfTimeSignature","nn","cc","bb","match","smfKeySignature","sf","CB","GB","DB","AB","EB","BB","C","G","D","A","E","B","H","toUpperCase","mi","MAJ","MAJOR","DUR","M","MIN","MINOR","MOLL","smfSequencer","_helpers","_copyHelperNC","_copyHelperSMF","_copyHelperGNC","_copyHelperMPE","_copyHelperCH","chan","args","_copyHelperGCH","_copyMidiHelpers","_channelMap","getChannel","setChannel","getNote","setNote","getVelocity","setVelocity","getSysExId","setSysExId","getData","setData","_is_yamaha_smf","_is_yamaha_chord","_yamaha_chord","getText","fromUTF8","isMidiSoft","setText","getTempo","getBPM","ms","getTimeSignature","getKeySignature","isNoteOn","isNoteOff","isSysEx","isFullSysEx","isSMF","isEOT","isTempo","isTimeSignature","isKeySignature","isGmReset","isGsReset","isXgReset","_s2a","_a2s","_s2n","__hex","_hex","_toLine","_smfhex","label","lbl","_str","ss","ks","substr","_unstamp","_clear_ctxt","_cc","_rpn_txt","msb","lsb","_nrpn_txt","_read_ctxt","_clear","st","_bm","bm","_bl","bl","programName","nl","rn","nm","rl","rm","_rm","_rl","_nm","_nl","_gm","Context","_read","band","master","last","notes","schedule","_ac","_initAudioContext","AudioContext","webkitAudioContext","createGain","createGainNode","_activateAudioContext","state","resume","osc","createOscillator","gain","value","setTargetAtTime","currentTime","destination","copyMidiHelpers","getAudioContext","_b64","fromBase64","chr1","chr2","chr3","enc1","enc2","enc3","enc4","replace","charAt","toBase64","o1","o2","o3","h1","h2","h3","h4","bits","ac","enc","r","_wma","_outputMap","_inputMap","Promise","executor","resolve","reject","DOMException","message","code","MIDIConnectionEvent","target","bubbles","cancelBubble","cancelable","currentTarget","defaultPrevented","eventPhase","path","returnValue","srcElement","timeStamp","MIDIMessageEvent","receivedTime","_statechange","p","MIDIInput","_open","_ochng","_onmsg","man","defineProperty","get","enumerable","proxy","set","freeze","_split","_datalen","_InputProxy","ports","pending","queue","Uint8Array","connection","reconnect","_epr","_validate","MIDIOutput","clear","timestamp","sysexEnabled","_OutputProxy","_Maplike","has","keys","Map","values","entries","fun","len","MIDIInputMap","_inputs","MIDIOutputMap","_outputs","_wm_watch","MIDIAccess","_onstatechange","wma"],"mappings":"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","sourcesContent":["(function(global, factory) {\r\n  /* istanbul ignore next */\r\n  if (typeof exports === 'object' && typeof module !== 'undefined') {\r\n    module.exports = factory();\r\n  }\r\n  else if (typeof define === 'function' && define.amd) {\r\n    define('JZZ', [], factory);\r\n  }\r\n  else {\r\n    if (!global) global = window;\r\n    if (global.JZZ && global.JZZ.MIDI) return;\r\n    global.JZZ = factory();\r\n  }\r\n})(this, function() {\r\n\r\n  var _scope = typeof window === 'undefined' ? global : window;\r\n  var _version = '1.4.9';\r\n  var i, j, k, m, n;\r\n\r\n  /* istanbul ignore next */\r\n  var _time = Date.now || function () { return new Date().getTime(); };\r\n  var _startTime = _time();\r\n  /* istanbul ignore next */\r\n  var _now = typeof performance != 'undefined' && performance.now ?\r\n    function() { return performance.now(); } : function() { return _time() - _startTime; };\r\n  var _schedule = function(f) {\r\n    setTimeout(f, 0);\r\n  };\r\n  function _nop() {}\r\n  function _func(f) { return typeof f == 'function'; }\r\n\r\n  // _R: common root for all async objects\r\n  function _R() {\r\n    this._orig = this;\r\n    this._ready = false;\r\n    this._queue = [];\r\n    this._log = [];\r\n  }\r\n  _R.prototype._exec = function() {\r\n    while (this._ready && this._queue.length) {\r\n      var x = this._queue.shift();\r\n      x[0].apply(this, x[1]);\r\n    }\r\n  };\r\n  _R.prototype._push = function(func, arg) { this._queue.push([func, arg]); _R.prototype._exec.apply(this); };\r\n  _R.prototype._slip = function(func, arg) { this._queue.unshift([func, arg]); };\r\n  _R.prototype._pause = function() { this._ready = false; };\r\n  _R.prototype._resume = function() { this._ready = true; _R.prototype._exec.apply(this); };\r\n  _R.prototype._break = function(err) { this._orig._bad = true; this._orig._log.push(err || 'Unknown JZZ error'); };\r\n  _R.prototype._repair = function() { this._orig._bad = false; };\r\n  _R.prototype._crash = function(err) { this._break(err); this._resume(); };\r\n  _R.prototype._err = function() { return this._log[this._log.length - 1]; };\r\n  _R.prototype.log = function() { return _clone(this._log); };\r\n  _R.prototype._dup = function() {\r\n    var F = function() {};\r\n    F.prototype = this._orig;\r\n    var ret = new F();\r\n    ret._ready = false;\r\n    ret._queue = [];\r\n    return ret;\r\n  };\r\n  _R.prototype._image = function() { return this._dup(); };\r\n  _R.prototype._thenable = function() {\r\n    if (this.then) return this;\r\n    var self = this;\r\n    var F = function() {}; F.prototype = self;\r\n    var ret = new F();\r\n    ret.then = function(good, bad) { self._push(_then, [good, bad]); return this; };      \r\n    return ret;\r\n  };\r\n  function _then(good, bad) {\r\n    if (this._bad) {\r\n      if (_func(bad)) bad.apply(this, [new Error(this._err())]);\r\n    }\r\n    else {\r\n      if (_func(good)) good.apply(this, [this]);\r\n    }\r\n  }\r\n  function _wait(obj, delay) {\r\n    if (this._bad) obj._crash(this._err());\r\n    else setTimeout(function() { obj._resume(); }, delay);\r\n  }\r\n  _R.prototype.wait = function(delay) {\r\n    if (!delay) return this;\r\n    var ret = this._image();\r\n    this._push(_wait, [ret, delay]);\r\n    return ret._thenable();\r\n  };\r\n  function _kick(obj) { if (this._bad) obj._break(this._err()); obj._resume(); }\r\n  function _rechain(self, obj, name) {\r\n    self[name] = function() {\r\n      var arg = arguments;\r\n      var ret = obj._image();\r\n      this._push(_kick, [ret]);\r\n      return ret[name].apply(ret, arg);\r\n    };\r\n  }\r\n  function _and(q) {\r\n    if (!this._bad) {\r\n      if (_func(q)) q.apply(this); else console.log(q);\r\n    }\r\n  }\r\n  _R.prototype.and = function(func) { this._push(_and, [func]); return this._thenable(); };\r\n  function _or(q) {\r\n    if (this._bad) {\r\n      if (_func(q)) q.apply(this); else console.log(q);\r\n    }\r\n  }\r\n  _R.prototype.or = function(func) { this._push(_or, [func]); return this._thenable(); };\r\n\r\n  _R.prototype._info = {};\r\n  _R.prototype.info = function() {\r\n    var info = _clone(this._orig._info);\r\n    if (typeof info.engine == 'undefined') info.engine = 'none';\r\n    if (typeof info.sysex == 'undefined') info.sysex = true;\r\n    return info;\r\n  };\r\n  _R.prototype.name = function() { return this.info().name; };\r\n\r\n  function _close(obj) {\r\n    if (this._bad) obj._crash(this._err());\r\n    else {\r\n      this._break('Closed');\r\n      obj._resume();\r\n    }\r\n  }\r\n  _R.prototype.close = function() {\r\n    var ret = new _R();\r\n    if (this._close) this._push(this._close, []);\r\n    this._push(_close, [ret]);\r\n    return ret._thenable();\r\n  };\r\n\r\n  function _tryAny(arr) {\r\n    if (!arr.length) {\r\n      this._break();\r\n      return;\r\n    }\r\n    var func = arr.shift();\r\n    if (arr.length) {\r\n      var self = this;\r\n      this._slip(_or, [ function() { _tryAny.apply(self, [arr]); } ]);\r\n    }\r\n    try {\r\n      this._repair();\r\n      func.apply(this);\r\n    }\r\n    catch (err) {\r\n      this._break(err.toString());\r\n    }\r\n  }\r\n\r\n  function _push(arr, obj) {\r\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) return;\r\n    arr.push(obj);\r\n  }\r\n  function _pop(arr, obj) {\r\n    for (var i = 0; i < arr.length; i++) if (arr[i] === obj) {\r\n      arr.splice(i, 1);\r\n      return;\r\n    }\r\n  }\r\n\r\n  // _J: JZZ object\r\n  function _J() {\r\n    _R.apply(this);\r\n  }\r\n  _J.prototype = new _R();\r\n\r\n  function _for(x, f) {\r\n    for(var k in x) if (x.hasOwnProperty(k)) f.call(this, k);\r\n  }\r\n  function _clone(obj, key, val) {\r\n    if (typeof key == 'undefined') return _clone(obj, [], []);\r\n    if (obj instanceof Object) {\r\n      for (var i = 0; i < key.length; i++) if (key[i] === obj) return val[i];\r\n      var ret;\r\n      if (obj instanceof Array) ret = []; else ret = {};\r\n      key.push(obj); val.push(ret);\r\n      _for(obj, function(k) { ret[k] = _clone(obj[k], key, val); });\r\n      return ret;\r\n    }\r\n    return obj;\r\n  }\r\n  _J.prototype._info = { name: 'JZZ.js', ver: _version, version: _version, inputs: [], outputs: [] };\r\n\r\n  var _outs = [];\r\n  var _ins = [];\r\n  var _outsW = [];\r\n  var _insW = [];\r\n\r\n  function _postRefresh() {\r\n    _jzz._info.engine = _engine._type;\r\n    _jzz._info.version = _engine._version;\r\n    _jzz._info.sysex = _engine._sysex;\r\n    _jzz._info.inputs = [];\r\n    _jzz._info.outputs = [];\r\n    _outs = [];\r\n    _ins = [];\r\n    _engine._allOuts = {};\r\n    _engine._allIns = {};\r\n    var i, x;\r\n    for (i = 0; i < _engine._outs.length; i++) {\r\n      x = _engine._outs[i];\r\n      x.engine = _engine;\r\n      _engine._allOuts[x.name] = x;\r\n      _jzz._info.outputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: _engine._type\r\n      });\r\n      _outs.push(x);\r\n    }\r\n    for (i = 0; i < _virtual._outs.length; i++) {\r\n      x = _virtual._outs[i];\r\n      _jzz._info.outputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: x.type\r\n      });\r\n      _outs.push(x);\r\n    }\r\n    for (i = 0; i < _engine._ins.length; i++) {\r\n      x = _engine._ins[i];\r\n      x.engine = _engine;\r\n      _engine._allIns[x.name] = x;\r\n      _jzz._info.inputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: _engine._type\r\n      });\r\n      _ins.push(x);\r\n    }\r\n    for (i = 0; i < _virtual._ins.length; i++) {\r\n      x = _virtual._ins[i];\r\n      _jzz._info.inputs.push({\r\n        id: x.name,\r\n        name: x.name,\r\n        manufacturer: x.manufacturer,\r\n        version: x.version,\r\n        engine: x.type\r\n      });\r\n      _ins.push(x);\r\n    }\r\n    if (_jzz._watcher && _jzz._watcher._handles.length) {\r\n      var diff = _diff(_insW, _outsW, _jzz._info.inputs, _jzz._info.outputs);\r\n       if (diff) {\r\n        for (j = 0; j < diff.inputs.removed.length; j++) {\r\n          x = _engine._inMap[diff.inputs.removed[j].name];\r\n          if (x) x._closeAll();\r\n        }\r\n        for (j = 0; j < diff.outputs.removed.length; j++) {\r\n          x = _engine._outMap[diff.outputs.removed[j].name];\r\n          if (x) x._closeAll();\r\n        }\r\n        _fireW(diff);\r\n      }\r\n    }\r\n    _insW = _jzz._info.inputs;\r\n    _outsW = _jzz._info.outputs;\r\n  }\r\n  function _refresh() {\r\n    if (!this._bad) _engine._refresh(this);\r\n  }\r\n  _J.prototype.refresh = function() {\r\n    this._push(_refresh, []);\r\n    return this._thenable();\r\n  };\r\n\r\n  function _filterList(q, arr) {\r\n    var i, n;\r\n    if (_func(q)) q = q(arr);\r\n    if (!(q instanceof Array)) q = [q];\r\n    var before = [];\r\n    var after = [];\r\n    var etc = arr.slice();\r\n    var a = before;\r\n    for (i = 0; i < q.length; i++) {\r\n      if (typeof q[i] == 'undefined') a = after;\r\n      else if (q[i] instanceof RegExp) for (n = 0; n < etc.length; n++) {\r\n        if (q[i].test(etc[n].name)) {\r\n          a.push(etc[n]);\r\n          etc.splice(n, 1);\r\n          n--;\r\n        }\r\n      }\r\n      else {\r\n        for (n = 0; n < etc.length; n++) if (q[i] + '' === n + '' || q[i] === etc[n].name || (q[i] instanceof Object && q[i].name === etc[n].name)) {\r\n          a.push(etc[n]);\r\n          etc.splice(n, 1);\r\n          n--;\r\n        }\r\n      }\r\n    }\r\n    return a == before ? before : before.concat(etc).concat(after);\r\n  }\r\n\r\n  function _notFound(port, q) {\r\n    var msg;\r\n    if (q instanceof RegExp) msg = 'Port matching ' + q + ' not found';\r\n    else if (q instanceof Object || typeof q == 'undefined') msg = 'Port not found';\r\n    else msg = 'Port \"' + q + '\" not found';\r\n    port._crash(msg);\r\n  }\r\n  function _openMidiOut(port, arg) {\r\n    if (this._bad) port._crash(this._err());\r\n    else {\r\n      var arr = _filterList(arg, _outs);\r\n      if (!arr.length) { _notFound(port, arg); return; }\r\n      var pack = function(x) { return function() { x.engine._openOut(this, x.name); }; };\r\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\r\n      port._slip(_tryAny, [arr]);\r\n      port._resume();\r\n    }\r\n  }\r\n  _J.prototype.openMidiOut = function(arg) {\r\n    var port = new _M();\r\n    this._push(_refresh, []);\r\n    this._push(_openMidiOut, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n  _J.prototype._openMidiOutNR = function(arg) {\r\n    var port = new _M();\r\n    this._push(_openMidiOut, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n\r\n  function _openMidiIn(port, arg) {\r\n    if (this._bad) port._crash(this._err());\r\n    else {\r\n      var arr = _filterList(arg, _ins);\r\n      if (!arr.length) { _notFound(port, arg); return; }\r\n      var pack = function(x) { return function() { x.engine._openIn(this, x.name); }; };\r\n      for (var i = 0; i < arr.length; i++) arr[i] = pack(arr[i]);\r\n      port._slip(_tryAny, [arr]);\r\n      port._resume();\r\n    }\r\n  }\r\n  _J.prototype.openMidiIn = function(arg) {\r\n    var port = new _M();\r\n    this._push(_refresh, []);\r\n    this._push(_openMidiIn, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n  _J.prototype._openMidiInNR = function(arg) {\r\n    var port = new _M();\r\n    this._push(_openMidiIn, [port, arg]);\r\n    return port._thenable();\r\n  };\r\n\r\n  function _onChange(watcher, arg) {\r\n    if (this._bad) watcher._crash();\r\n    else {\r\n      watcher._slip(_connectW, [arg]);\r\n      watcher._resume();\r\n    }\r\n  }\r\n  _J.prototype.onChange = function(arg) {\r\n    if (!this._orig._watcher) this._orig._watcher = new _W();\r\n    var watcher = this._orig._watcher._image();\r\n    this._push(_onChange, [watcher, arg]);\r\n    return watcher._thenable();\r\n  };\r\n\r\n  _J.prototype._close = function() {\r\n    _engine._close();\r\n  };\r\n\r\n  // _M: MIDI-In/Out object\r\n  function _M() {\r\n    _R.apply(this);\r\n    this._handles = [];\r\n    this._outs = [];\r\n  }\r\n  _M.prototype = new _R();\r\n  _M.prototype._filter = function(msg) {\r\n    if (this._orig._mpe) {\r\n      var out;\r\n      var outs = 0;\r\n      if (this._handles && this._handles.length) {\r\n        outs = this._handles.length;\r\n        out = this._handles[0];\r\n      }\r\n      if (this._outs && this._outs.length) {\r\n        outs = this._outs.length;\r\n        out = this._outs[0];\r\n      }\r\n      if (outs == 1 && !out._mpe) {\r\n        msg = this._orig._mpe.filter(msg);\r\n      }\r\n    }\r\n    return msg;\r\n  };\r\n  _M.prototype._receive = function(msg) { this._emit(this._filter(msg)); };\r\n  function _receive(msg) { if (!this._bad) this._receive(msg); }\r\n  _M.prototype.send = function() {\r\n    this._push(_receive, [MIDI.apply(null, arguments)]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.note = function(c, n, v, t) {\r\n    this.noteOn(c, n, v);\r\n    if (typeof this._ch == 'undefined' && typeof this._master == 'undefined') {\r\n      if (t > 0) this.wait(t).noteOff(c, n);\r\n    }\r\n    else {\r\n      if (v > 0) this.wait(v).noteOff(c);\r\n    }\r\n    return this._thenable();\r\n  };\r\n  _M.prototype._emit = function(msg) {\r\n    var i;\r\n    for (i = 0; i < this._handles.length; i++) this._handles[i].apply(this, [MIDI(msg)._stamp(this)]);\r\n    for (i = 0; i < this._outs.length; i++) {\r\n      var m = MIDI(msg);\r\n      if (!m._stamped(this._outs[i])) this._outs[i].send(m._stamp(this));\r\n    }\r\n  };\r\n  function _emit(msg) { this._emit(msg); }\r\n  _M.prototype.emit = function(msg) {\r\n    this._push(_emit, [msg]);\r\n    return this._thenable();\r\n  };\r\n  function _connect(arg) {\r\n    if (_func(arg)) _push(this._orig._handles, arg);\r\n    else _push(this._orig._outs, arg);\r\n  }\r\n  function _disconnect(arg) {\r\n    if (typeof arg == 'undefined') {\r\n      this._orig._handles = [];\r\n      this._orig._outs = [];\r\n    }\r\n    else if (_func(arg)) _pop(this._orig._handles, arg);\r\n    else _pop(this._orig._outs, arg);\r\n  }\r\n  _M.prototype.connect = function(arg) {\r\n    this._push(_connect, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.disconnect = function(arg) {\r\n    this._push(_disconnect, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _M.prototype.connected = function() {\r\n    return this._orig._handles.length + this._orig._outs.length;\r\n  };\r\n  _M.prototype._image = function() {\r\n    var dup = this._dup();\r\n    dup._ch = this._ch;\r\n    dup._sxid = this._sxid;\r\n    dup._master = this._master;\r\n    dup._band = this._band;\r\n    return dup;\r\n  };\r\n  _M.prototype._ch = undefined;\r\n  _M.prototype._sxid = 0x7f;\r\n  _M.prototype._master = undefined;\r\n  _M.prototype._band = undefined;\r\n\r\n  _M.prototype.sxId = function(id) {\r\n    if (typeof id == 'undefined') id = _M.prototype._sxid;\r\n    if (id == this._sxid) return this._thenable();\r\n    id = _7b(id);\r\n    var img = this._image();\r\n    img._sxid = id;\r\n    this._push(_kick, [img]);\r\n    return img._thenable();\r\n  };\r\n  _M.prototype.ch = function(c) {\r\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this._thenable();\r\n    var img = this._image();\r\n    if (typeof c != 'undefined') c = _ch(c);\r\n    img._ch = c;\r\n    img._master = undefined;\r\n    img._band = undefined;\r\n    this._push(_kick, [img]);\r\n    return img._thenable();\r\n  };\r\n\r\n  function _mpe(m, n) {\r\n    if (!this._orig._mpe) this._orig._mpe = new MPE();\r\n    this._orig._mpe.setup(m, n);\r\n  }\r\n  _M.prototype.mpe = function(m, n) {\r\n    if (m == this._master && n == this._band || typeof m == 'undefined' && typeof this._master == 'undefined') return this._thenable();\r\n    if (typeof m != 'undefined') MPE.validate(m, n);\r\n    if (!n) return this.ch(m);\r\n    var img = this._image();\r\n    img._ch = undefined;\r\n    img._master = m;\r\n    img._band = n;\r\n    this._push(_mpe, [m, n]);\r\n    this._push(_kick, [img]);\r\n    return img._thenable();\r\n  };\r\n  function _validateChannel(c) {\r\n    if (c != parseInt(c) || c < 0 || c > 15)\r\n      throw RangeError('Bad channel value (must not be less than 0 or more than 15): ' + c);\r\n  }\r\n\r\n  // _W: Watcher object ~ MIDIAccess.onstatechange\r\n  function _W() {\r\n    _R.apply(this);\r\n    this._handles = [];\r\n    _rechain(this, _jzz, 'refresh');\r\n    _rechain(this, _jzz, 'openMidiOut');\r\n    _rechain(this, _jzz, 'openMidiIn');\r\n    _rechain(this, _jzz, 'onChange');\r\n    _rechain(this, _jzz, 'close');\r\n  }\r\n  _W.prototype = new _R();\r\n  function _connectW(arg) {\r\n    if (_func(arg)) {\r\n      if (!this._orig._handles.length) _engine._watch();\r\n      _push(this._orig._handles, arg);\r\n    }\r\n  }\r\n  function _disconnectW(arg) {\r\n    if (typeof arg == 'undefined') this._orig._handles = [];\r\n    else _pop(this._orig._handles, arg);\r\n    if (!this._orig._handles.length) _engine._unwatch();\r\n  }\r\n  _W.prototype.connect = function(arg) {\r\n    this._push(_connectW, [arg]);\r\n    return this._thenable();\r\n  };\r\n  _W.prototype.disconnect = function(arg) {\r\n    this._push(_disconnectW, [arg]);\r\n    return this._thenable();\r\n  };\r\n  function _changed(x0, y0, x1, y1) {\r\n    var i;\r\n    if (x0.length != x1.length || y0.length != y1.length) return true;\r\n    for (i = 0; i < x0.length; i++) if (x0[i].name != x1[i].name) return true;\r\n    for (i = 0; i < y0.length; i++) if (y0[i].name != y1[i].name) return true;\r\n    return false;\r\n  }\r\n  function _diff(x0, y0, x1, y1) {\r\n    if (!_changed(x0, y0, x1, y1)) return;\r\n    var ax = []; // added\r\n    var ay = [];\r\n    var rx = []; // removed\r\n    var ry = [];\r\n    var i;\r\n    var h = {};\r\n    for (i = 0; i < x0.length; i++) h[x0[i].name] = true;\r\n    for (i = 0; i < x1.length; i++) if (!h[x1[i].name]) ax.push(x1[i]);\r\n    h = {};\r\n    for (i = 0; i < x1.length; i++) h[x1[i].name] = true;\r\n    for (i = 0; i < x0.length; i++) if (!h[x0[i].name]) rx.push(x0[i]);\r\n    h = {};\r\n    for (i = 0; i < y0.length; i++) h[y0[i].name] = true;\r\n    for (i = 0; i < y1.length; i++) if (!h[y1[i].name]) ay.push(y1[i]);\r\n    h = {};\r\n    for (i = 0; i < y1.length; i++) h[y1[i].name] = true;\r\n    for (i = 0; i < y0.length; i++) if (!h[y0[i].name]) ry.push(y0[i]);\r\n    return { inputs: { added: ax, removed: rx }, outputs: { added: ay, removed: ry } };\r\n  }\r\n  function _fireW(arg) {\r\n    for (i = 0; i < _jzz._watcher._handles.length; i++) _jzz._watcher._handles[i].apply(_jzz, [arg]);\r\n  }\r\n\r\n  var _jzz;\r\n  var _engine = { _outs: [], _ins: [] };\r\n  var _virtual = { _outs: [], _ins: [] };\r\n\r\n  // Node.js\r\n  function _tryNODE() {\r\n    if (typeof module != 'undefined' && module.exports) {\r\n      _initNode(require('jazz-midi'));\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n  // Jazz-Plugin\r\n  function _tryJazzPlugin() {\r\n    var div = document.createElement('div');\r\n    div.style.visibility = 'hidden';\r\n    document.body.appendChild(div);\r\n    var obj = document.createElement('object');\r\n    obj.style.visibility = 'hidden';\r\n    obj.style.width = '0px'; obj.style.height = '0px';\r\n    obj.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\r\n    obj.type = 'audio/x-jazz';\r\n    document.body.appendChild(obj);\r\n    /* istanbul ignore next */\r\n    if (obj.isJazz) {\r\n      _initJazzPlugin(obj);\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n\r\n  // Web MIDI API\r\n  var _navigator;\r\n  var _requestMIDIAccess;\r\n  function _findMidiAccess() {\r\n    if (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\r\n      _navigator = navigator;\r\n      _requestMIDIAccess = navigator.requestMIDIAccess;\r\n      try {\r\n        if (_requestMIDIAccess.toString().indexOf('JZZ(') != -1) _requestMIDIAccess = undefined;\r\n      }\r\n      catch (err) {}\r\n    }\r\n  }\r\n  function _tryWebMIDI() {\r\n    _findMidiAccess();\r\n    if (_requestMIDIAccess) {\r\n      var self = this;\r\n      var onGood = function(midi) {\r\n        _initWebMIDI(midi);\r\n        self._resume();\r\n      };\r\n      var onBad = function(msg) {\r\n        self._crash(msg);\r\n      };\r\n      var opt = {};\r\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\r\n      this._pause();\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n  function _tryWebMIDIsysex() {\r\n    _findMidiAccess();\r\n    if (_requestMIDIAccess) {\r\n      var self = this;\r\n      var onGood = function(midi) {\r\n        _initWebMIDI(midi, true);\r\n        self._resume();\r\n      };\r\n      var onBad = function(msg) {\r\n        self._crash(msg);\r\n      };\r\n      var opt = { sysex:true };\r\n      _requestMIDIAccess.call(_navigator, opt).then(onGood, onBad);\r\n      this._pause();\r\n      return;\r\n    }\r\n    this._break();\r\n  }\r\n\r\n  // Web-extension\r\n  function _tryCRX() {\r\n    var self = this;\r\n    var inst;\r\n    var msg;\r\n    function eventHandle() {\r\n      inst = true;\r\n      if (!msg) msg = document.getElementById('jazz-midi-msg');\r\n      if (!msg) return;\r\n      var a = [];\r\n      try { a = JSON.parse(msg.innerText); } catch (err) {}\r\n      msg.innerText = '';\r\n      document.removeEventListener('jazz-midi-msg', eventHandle);\r\n      if (a[0] === 'version') {\r\n        _initCRX(msg, a[2]);\r\n        self._resume();\r\n      }\r\n      else {\r\n        self._crash();\r\n      }\r\n    }\r\n    this._pause();\r\n    document.addEventListener('jazz-midi-msg', eventHandle);\r\n    try { document.dispatchEvent(new Event('jazz-midi')); } catch (err) {}\r\n    _schedule(function() { if (!inst) self._crash(); });\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  function _zeroBreak() {\r\n    this._pause();\r\n    var self = this;\r\n    _schedule(function() { self._crash(); });\r\n  }\r\n\r\n  function _filterEngines(opt) {\r\n    var ret = [];\r\n    var arr = _filterEngineNames(opt);\r\n    for (var i = 0; i < arr.length; i++) {\r\n      if (arr[i] == 'webmidi') {\r\n        if (opt && opt.sysex === true) ret.push(_tryWebMIDIsysex);\r\n        if (!opt || opt.sysex !== true || opt.degrade === true) ret.push(_tryWebMIDI);\r\n      }\r\n      else if (arr[i] == 'node') { ret.push(_tryNODE); ret.push(_zeroBreak); }\r\n      else if (arr[i] == 'extension') ret.push(_tryCRX);\r\n      else if (arr[i] == 'plugin') ret.push(_tryJazzPlugin);\r\n    }\r\n    ret.push(_initNONE);\r\n    return ret;\r\n  }\r\n\r\n  function _filterEngineNames(opt) {\r\n    var web = ['node', 'extension', 'plugin', 'webmidi'];\r\n    if (!opt || !opt.engine) return web;\r\n    var arr = opt.engine instanceof Array ? opt.engine : [opt.engine];\r\n    var dup = {};\r\n    var none;\r\n    var etc;\r\n    var head = [];\r\n    var tail = [];\r\n    var i;\r\n    for (i = 0; i < arr.length; i++) {\r\n      var name = arr[i].toString().toLowerCase();\r\n      if (dup[name]) continue;\r\n      dup[name] = true;\r\n      if (name === 'none') none = true;\r\n      if (name === 'etc' || typeof name == 'undefined') etc = true;\r\n      if (etc) tail.push(name); else head.push(name);\r\n      _pop(web, name);\r\n    }\r\n    if (etc || head.length || tail.length) none = false;\r\n    return none ? [] : head.concat(etc ? web : tail);\r\n  }\r\n\r\n  function _initJZZ(opt) {\r\n    _jzz = new _J();\r\n    _jzz._options = opt;\r\n    _jzz._push(_tryAny, [_filterEngines(opt)]);\r\n    _jzz.refresh();\r\n    _jzz._resume();\r\n  }\r\n\r\n  function _initNONE() {\r\n    _engine._type = 'none';\r\n    _engine._version = _version;\r\n    _engine._sysex = true;\r\n    _engine._outs = [];\r\n    _engine._ins = [];\r\n    _engine._refresh = function() { _postRefresh(); };\r\n    _engine._watch = _nop;\r\n    _engine._unwatch = _nop;\r\n    _engine._close = _nop;\r\n  }\r\n  // common initialization for Jazz-Plugin and jazz-midi\r\n  function _initEngineJP() {\r\n    _engine._inArr = [];\r\n    _engine._outArr = [];\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    _engine._version = _engine._main.version;\r\n    _engine._sysex = true;\r\n    var watcher;\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._refresh = function() {\r\n      _engine._outs = [];\r\n      _engine._ins = [];\r\n      var i, x;\r\n      for (i = 0; (x = _engine._main.MidiOutInfo(i)).length; i++) {\r\n        _engine._outs.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\r\n      }\r\n      for (i = 0; (x = _engine._main.MidiInInfo(i)).length; i++) {\r\n        _engine._ins.push({ type: _engine._type, name: x[0], manufacturer: x[1], version: x[2] });\r\n      }\r\n      _postRefresh();\r\n    };\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._outArr.length) _engine._pool.push(_engine._newPlugin());\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (a.length) this.plugin.MidiOutRaw(a.slice()); }\r\n        };\r\n        var plugin = _engine._pool[_engine._outArr.length];\r\n        impl.plugin = plugin;\r\n        _engine._outArr.push(impl);\r\n        _engine._outMap[name] = impl;\r\n      }\r\n      if (!impl.open) {\r\n        var s = impl.plugin.MidiOutOpen(name);\r\n        if (s !== name) {\r\n          if (s) impl.plugin.MidiOutClose();\r\n          port._break(); return;\r\n        }\r\n        impl.open = true;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._receive = function(arg) { impl._receive(arg); };\r\n      port._close = function() { impl._close(this); };\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._inArr.length) _engine._pool.push(_engine._newPlugin());\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll,\r\n          handle: function(t, a) {\r\n            for (var i = 0; i < this.clients.length; i++) {\r\n              var msg = MIDI(a);\r\n              this.clients[i]._emit(msg);\r\n            }\r\n          }\r\n        };\r\n        var makeHandle = function(x) { return function(t, a) { x.handle(t, a); }; };\r\n        impl.onmidi = makeHandle(impl);\r\n        var plugin = _engine._pool[_engine._inArr.length];\r\n        impl.plugin = plugin;\r\n        _engine._inArr.push(impl);\r\n        _engine._inMap[name] = impl;\r\n      }\r\n      if (!impl.open) {\r\n        var s = impl.plugin.MidiInOpen(name, impl.onmidi);\r\n        if (s !== name) {\r\n          if (s) impl.plugin.MidiInClose();\r\n          port._break(); return;\r\n        }\r\n        impl.open = true;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._close = function() { impl._close(this); };\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        impl.plugin.MidiOutClose();\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        impl.plugin.MidiInClose();\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      for (var i = 0; i < _engine._inArr.length; i++) if (_engine._inArr[i].open) _engine._inArr[i].plugin.MidiInClose();\r\n      _engine._unwatch();\r\n    };\r\n    _engine._watch = function() {\r\n      if (!watcher) watcher = setInterval(function() { _engine._refresh(); }, 250);\r\n    };\r\n    _engine._unwatch = function() {\r\n      if (watcher) clearInterval(watcher);\r\n      watcher = undefined;\r\n    };\r\n  }\r\n\r\n  function _initNode(obj) {\r\n    _engine._type = 'node';\r\n    _engine._main = obj;\r\n    _engine._pool = [];\r\n    _engine._newPlugin = function() { return new obj.MIDI(); };\r\n    _initEngineJP();\r\n  }\r\n  /* istanbul ignore next */\r\n  function _initJazzPlugin(obj) {\r\n    _engine._type = 'plugin';\r\n    _engine._main = obj;\r\n    _engine._pool = [obj];\r\n    _engine._newPlugin = function() {\r\n      var plg = document.createElement('object');\r\n      plg.style.visibility = 'hidden';\r\n      plg.style.width = '0px'; obj.style.height = '0px';\r\n      plg.classid = 'CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90';\r\n      plg.type = 'audio/x-jazz';\r\n      document.body.appendChild(plg);\r\n      return plg.isJazz ? plg : undefined;\r\n    };\r\n    _initEngineJP();\r\n  }\r\n  function _initWebMIDI(access, sysex) {\r\n    _engine._type = 'webmidi';\r\n    _engine._version = 43;\r\n    _engine._sysex = !!sysex;\r\n    _engine._access = access;\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    var watcher;\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._refresh = function() {\r\n      _engine._outs = [];\r\n      _engine._ins = [];\r\n      _engine._access.outputs.forEach(function(port) {\r\n        _engine._outs.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\r\n      });\r\n      _engine._access.inputs.forEach(function(port) {\r\n        _engine._ins.push({type: _engine._type, name: port.name, manufacturer: port.manufacturer, version: port.version});\r\n      });\r\n      _postRefresh();\r\n    };\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (impl.dev && a.length) this.dev.send(a.slice()); }\r\n        };\r\n      }\r\n      var found;\r\n      _engine._access.outputs.forEach(function(dev) {\r\n        if (dev.name === name) found = dev;\r\n      });\r\n      if (found) {\r\n        impl.dev = found;\r\n        _engine._outMap[name] = impl;\r\n        port._orig._impl = impl;\r\n        _push(impl.clients, port._orig);\r\n        port._info = impl.info;\r\n        port._receive = function(arg) { impl._receive(arg); };\r\n        port._close = function() { impl._close(this); };\r\n        if (impl.dev.open) {\r\n          port._pause();\r\n          impl.dev.open().then(function() {\r\n            port._resume();\r\n          }, function() {\r\n            port._crash();\r\n          });\r\n        }\r\n      }\r\n      else port._break();\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll,\r\n          handle: function(evt) {\r\n            for (var i = 0; i < this.clients.length; i++) {\r\n              var msg = MIDI([].slice.call(evt.data));\r\n              this.clients[i]._emit(msg);\r\n            }\r\n          }\r\n        };\r\n      }\r\n      var found;\r\n      _engine._access.inputs.forEach(function(dev) {\r\n        if (dev.name === name) found = dev;\r\n      });\r\n      if (found) {\r\n        impl.dev = found;\r\n        var makeHandle = function(x) { return function(evt) { x.handle(evt); }; };\r\n        impl.dev.onmidimessage = makeHandle(impl);\r\n        _engine._inMap[name] = impl;\r\n        port._orig._impl = impl;\r\n        _push(impl.clients, port._orig);\r\n        port._info = impl.info;\r\n        port._close = function() { impl._close(this); };\r\n        if (impl.dev.open) {\r\n          port._pause();\r\n          impl.dev.open().then(function() {\r\n            port._resume();\r\n          }, function() {\r\n            port._crash();\r\n          });\r\n        }\r\n      }\r\n      else port._break();\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length) {\r\n        if (impl.dev && impl.dev.close) impl.dev.close();\r\n        impl.dev = undefined;\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length) {\r\n        if (impl.dev) {\r\n          impl.dev.onmidimessage = null;\r\n          if (impl.dev.close) impl.dev.close();\r\n        }\r\n        impl.dev = undefined;\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      _engine._unwatch();\r\n    };\r\n    _engine._watch = function() {\r\n      _engine._access.onstatechange = function() {\r\n        watcher = true;\r\n        _schedule(function() {\r\n          if (watcher) {\r\n            _engine._refresh();\r\n            watcher = false;\r\n          }\r\n        });\r\n      };\r\n    };\r\n    _engine._unwatch = function() {\r\n      _engine._access.onstatechange = undefined;\r\n    };\r\n  }\r\n  function _initCRX(msg, ver) {\r\n    _engine._type = 'extension';\r\n    _engine._version = ver;\r\n    _engine._sysex = true;\r\n    _engine._pool = [];\r\n    _engine._outs = [];\r\n    _engine._ins = [];\r\n    _engine._inArr = [];\r\n    _engine._outArr = [];\r\n    _engine._inMap = {};\r\n    _engine._outMap = {};\r\n    _engine._outsW = [];\r\n    _engine._insW = [];\r\n    _engine.refreshClients = [];\r\n    _engine._msg = msg;\r\n    _engine._newPlugin = function() {\r\n      var plugin = { id: _engine._pool.length };\r\n      _engine._pool.push(plugin);\r\n      if (!plugin.id) plugin.ready = true;\r\n      else document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['new'] }));\r\n    };\r\n    _engine._newPlugin();\r\n    _engine._refresh = function(client) {\r\n      _engine.refreshClients.push(client);\r\n      client._pause();\r\n      _schedule(function() {\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['refresh'] }));\r\n      });\r\n    };\r\n    function _closeAll() {\r\n      for (var i = 0; i < this.clients.length; i++) this._close(this.clients[i]);\r\n    }\r\n    _engine._openOut = function(port, name) {\r\n      var impl = _engine._outMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._outArr.length) _engine._newPlugin();\r\n        var plugin = _engine._pool[_engine._outArr.length];\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allOuts[name].manufacturer,\r\n            version: _engine._allOuts[name].version,\r\n            type: 'MIDI-out',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openout', plugin.id, name] })); },\r\n          _close: function(port) { _engine._closeOut(port); },\r\n          _closeAll: _closeAll,\r\n          _receive: function(a) { if (a.length) { var v = a.slice(); v.splice(0, 0, 'play', plugin.id); document.dispatchEvent(new CustomEvent('jazz-midi', {detail: v})); } }\r\n        };\r\n        impl.plugin = plugin;\r\n        plugin.output = impl;\r\n        _engine._outArr.push(impl);\r\n        _engine._outMap[name] = impl;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._receive = function(arg) { impl._receive(arg); };\r\n      port._close = function() { impl._close(this); };\r\n      if (!impl.open) {\r\n        port._pause();\r\n        if (impl.plugin.ready) impl._start();\r\n      }\r\n    };\r\n    _engine._openIn = function(port, name) {\r\n      var impl = _engine._inMap[name];\r\n      if (!impl) {\r\n        if (_engine._pool.length <= _engine._inArr.length) _engine._newPlugin();\r\n        var plugin = _engine._pool[_engine._inArr.length];\r\n        impl = {\r\n          name: name,\r\n          clients: [],\r\n          info: {\r\n            name: name,\r\n            manufacturer: _engine._allIns[name].manufacturer,\r\n            version: _engine._allIns[name].version,\r\n            type: 'MIDI-in',\r\n            sysex: _engine._sysex,\r\n            engine: _engine._type\r\n          },\r\n          _start: function() { document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['openin', plugin.id, name] })); },\r\n          _close: function(port) { _engine._closeIn(port); },\r\n          _closeAll: _closeAll\r\n        };\r\n        impl.plugin = plugin;\r\n        plugin.input = impl;\r\n        _engine._inArr.push(impl);\r\n        _engine._inMap[name] = impl;\r\n      }\r\n      port._orig._impl = impl;\r\n      _push(impl.clients, port._orig);\r\n      port._info = impl.info;\r\n      port._close = function() { impl._close(this); };\r\n      if (!impl.open) {\r\n        port._pause();\r\n        if (impl.plugin.ready) impl._start();\r\n      }\r\n    };\r\n    _engine._closeOut = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closeout', impl.plugin.id] }));\r\n      }\r\n    };\r\n    _engine._closeIn = function(port) {\r\n      var impl = port._impl;\r\n      _pop(impl.clients, port._orig);\r\n      if (!impl.clients.length && impl.open) {\r\n        impl.open = false;\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', { detail: ['closein', impl.plugin.id] }));\r\n      }\r\n    };\r\n    _engine._close = function() {\r\n      _engine._unwatch();\r\n    };\r\n    var watcher;\r\n    _engine._watch = function() {\r\n      _engine._insW = _engine._ins;\r\n      _engine._outsW = _engine._outs;\r\n      watcher = setInterval(function() {\r\n        document.dispatchEvent(new CustomEvent('jazz-midi', {detail:['refresh']}));\r\n      }, 250);\r\n    };\r\n    _engine._unwatch = function() {\r\n      clearInterval(watcher);\r\n      watcher = undefined;\r\n    };\r\n    document.addEventListener('jazz-midi-msg', function() {\r\n      var v = _engine._msg.innerText.split('\\n');\r\n      var impl, i, j;\r\n      _engine._msg.innerText = '';\r\n      for (i = 0; i < v.length; i++) {\r\n        var a = [];\r\n        try { a = JSON.parse(v[i]); } catch (err) {}\r\n        if (!a.length) continue;\r\n        if (a[0] === 'refresh') {\r\n          if (a[1].ins) {\r\n            for (j = 0; j < a[1].ins.length; j++) a[1].ins[j].type = _engine._type;\r\n            _engine._ins = a[1].ins;\r\n          }\r\n          if (a[1].outs) {\r\n            for (j = 0; j < a[1].outs.length; j++) a[1].outs[j].type = _engine._type;\r\n            _engine._outs = a[1].outs;\r\n          }\r\n          _postRefresh();\r\n          for (j = 0; j < _engine.refreshClients.length; j++) _engine.refreshClients[j]._resume();\r\n          _engine.refreshClients = [];\r\n        }\r\n        else if (a[0] === 'version') {\r\n          var plugin = _engine._pool[a[1]];\r\n          if (plugin) {\r\n            plugin.ready = true;\r\n            if (plugin.input) plugin.input._start();\r\n            if (plugin.output) plugin.output._start();\r\n          }\r\n        }\r\n        else if (a[0] === 'openout') {\r\n          impl = _engine._pool[a[1]].output;\r\n          if (impl) {\r\n            if (a[2] == impl.name) {\r\n              impl.open = true;\r\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\r\n            }\r\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\r\n          }\r\n        }\r\n        else if (a[0] === 'openin') {\r\n          impl = _engine._pool[a[1]].input;\r\n          if (impl) {\r\n            if (a[2] == impl.name) {\r\n              impl.open = true;\r\n              if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._resume();\r\n            }\r\n            else if (impl.clients) for (j = 0; j < impl.clients.length; j++) impl.clients[j]._crash();\r\n          }\r\n        }\r\n        else if (a[0] === 'midi') {\r\n          impl = _engine._pool[a[1]].input;\r\n          if (impl && impl.clients) {\r\n            for (j = 0; j < impl.clients.length; j++) {\r\n              var msg = MIDI(a.slice(3));\r\n              impl.clients[j]._emit(msg);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  var JZZ = function(opt) {\r\n    if (!_jzz) _initJZZ(opt);\r\n    return _jzz._thenable();\r\n  };\r\n  JZZ.JZZ = JZZ;\r\n  JZZ.version = _version;\r\n  JZZ.info = function() { return _J.prototype.info(); };\r\n\r\n  function Widget(arg) {\r\n    var self = new _M();\r\n    if (arg instanceof Object) _for(arg, function(k) { self[k] = arg[k]; });\r\n    self._resume();\r\n    return self;\r\n  }\r\n  JZZ.Widget = Widget;\r\n  _J.prototype.Widget = JZZ.Widget;\r\n  JZZ.addMidiIn = function(name, widget) {\r\n    var info = _clone(widget._info || {});\r\n    info.name = name;\r\n    info.type = info.type || 'javascript';\r\n    info.manufacturer = info.manufacturer || 'virtual';\r\n    info.version = info.version || '0.0';\r\n    var engine = {\r\n      _info: function() { return info; },\r\n      _openIn: function(port) {\r\n        port._pause();\r\n        port._info = _clone(info);\r\n        port._close = function() { widget.disconnect(port); };\r\n        widget.connect(port);\r\n        port._resume();\r\n      }\r\n    };\r\n    return JZZ.lib.registerMidiIn(name, engine);\r\n  };\r\n  JZZ.addMidiOut = function(name, widget) {\r\n    var info = _clone(widget._info || {});\r\n    info.name = name;\r\n    info.type = info.type || 'javascript';\r\n    info.manufacturer = info.manufacturer || 'virtual';\r\n    info.version = info.version || '0.0';\r\n    var engine = {\r\n      _info: function() { return info; },\r\n      _openOut: function(port) {\r\n        port._pause();\r\n        port._info = _clone(info);\r\n        port._close = function() { port.disconnect(); };\r\n        _connect.apply(port, [widget]);\r\n        port._resume();\r\n      }\r\n    };\r\n    return JZZ.lib.registerMidiOut(name, engine);\r\n  };\r\n\r\n  // JZZ.SMPTE\r\n\r\n  function SMPTE() {\r\n    var self = this instanceof SMPTE ? this : self = new SMPTE();\r\n    SMPTE.prototype.reset.apply(self, arguments);\r\n    return self;\r\n  }\r\n  SMPTE.prototype.reset = function(arg) {\r\n    if (arg instanceof SMPTE) {\r\n      this.setType(arg.getType());\r\n      this.setHour(arg.getHour());\r\n      this.setMinute(arg.getMinute());\r\n      this.setSecond(arg.getSecond());\r\n      this.setFrame(arg.getFrame());\r\n      this.setQuarter(arg.getQuarter());\r\n      return this;\r\n    }\r\n    var arr = arg instanceof Array ? arg : arguments;\r\n    this.setType(arr[0]);\r\n    this.setHour(arr[1]);\r\n    this.setMinute(arr[2]);\r\n    this.setSecond(arr[3]);\r\n    this.setFrame(arr[4]);\r\n    this.setQuarter(arr[5]);\r\n    return this;\r\n  };\r\n  function _fixDropFrame() { if (this.type == 29.97 && !this.second && this.frame < 2 && this.minute % 10) this.frame = 2; }\r\n  SMPTE.prototype.isFullFrame = function() { return this.quarter == 0 || this.quarter == 4; };\r\n  SMPTE.prototype.getType = function() { return this.type; };\r\n  SMPTE.prototype.getHour = function() { return this.hour; };\r\n  SMPTE.prototype.getMinute = function() { return this.minute; };\r\n  SMPTE.prototype.getSecond = function() { return this.second; };\r\n  SMPTE.prototype.getFrame = function() { return this.frame; };\r\n  SMPTE.prototype.getQuarter = function() { return this.quarter; };\r\n  SMPTE.prototype.setType = function(x) {\r\n    if (typeof x == 'undefined' || x == 24) this.type = 24;\r\n    else if (x == 25) this.type = 25;\r\n    else if (x == 29.97) { this.type = 29.97; _fixDropFrame.apply(this); }\r\n    else if (x == 30) this.type = 30;\r\n    else throw RangeError('Bad SMPTE frame rate: ' + x);\r\n    if (this.frame >= this.type) this.frame = this.type - 1; // could not be more than 29\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setHour = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 24) throw RangeError('Bad SMPTE hours value: ' + x);\r\n    this.hour = x;\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setMinute = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE minutes value: ' + x);\r\n    this.minute = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setSecond = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 60) throw RangeError('Bad SMPTE seconds value: ' + x);\r\n    this.second = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setFrame = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= this.type) throw RangeError('Bad SMPTE frame number: ' + x);\r\n    this.frame = x;\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.setQuarter = function(x) {\r\n    if (typeof x == 'undefined') x = 0;\r\n    if (x != parseInt(x) || x < 0 || x >= 8) throw RangeError('Bad SMPTE quarter frame: ' + x);\r\n    this.quarter = x;\r\n    return this;\r\n  };\r\n  SMPTE.prototype.incrFrame = function() {\r\n    this.frame++;\r\n    if (this.frame >= this.type) {\r\n      this.frame = 0;\r\n      this.second++;\r\n      if (this.second >= 60) {\r\n        this.second = 0;\r\n        this.minute++;\r\n        if (this.minute >= 60) {\r\n          this.minute = 0;\r\n          this.hour = this.hour >= 23 ? 0 : this.hour + 1;\r\n        }\r\n      }\r\n    }\r\n    _fixDropFrame.apply(this);\r\n    return this;\r\n  };\r\n  SMPTE.prototype.decrFrame = function() {\r\n    if (!this.second && this.frame == 2 && this.type == 29.97 && this.minute % 10) this.frame = 0; // drop-frame\r\n    this.frame--;\r\n    if (this.frame < 0) {\r\n      this.frame = this.type == 29.97 ? 29 : this.type - 1;\r\n      this.second--;\r\n      if (this.second < 0) {\r\n        this.second = 59;\r\n        this.minute--;\r\n        if (this.minute < 0) {\r\n          this.minute = 59;\r\n          this.hour = this.hour ? this.hour - 1 : 23;\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  };\r\n  SMPTE.prototype.incrQF = function() {\r\n    this.backwards = false;\r\n    this.quarter = (this.quarter + 1) & 7;\r\n    if (this.quarter == 0 || this.quarter == 4) this.incrFrame();\r\n    return this;\r\n  };\r\n  SMPTE.prototype.decrQF = function() {\r\n    this.backwards = true;\r\n    this.quarter = (this.quarter + 7) & 7;\r\n    if (this.quarter == 3 || this.quarter == 7) this.decrFrame();\r\n    return this;\r\n  };\r\n  function _825(a) { return [[24, 25, 29.97, 30][(a[7] >> 1) & 3], ((a[7] & 1) << 4) | a[6], (a[5] << 4) | a[4], (a[3] << 4) | a[2], (a[1] << 4) | a[0]]; }\r\n  SMPTE.prototype.read = function(m) {\r\n    if (!(m instanceof MIDI)) m = MIDI.apply(null, arguments);\r\n    if (m[0] == 0xf0 && m[1] == 0x7f && m[3] == 1 && m[4] == 1 && m[9] == 0xf7) {\r\n      this.type = [24, 25, 29.97, 30][(m[5] >> 5) & 3];\r\n      this.hour = m[5] & 31;\r\n      this.minute = m[6];\r\n      this.second = m[7];\r\n      this.frame = m[8];\r\n      this.quarter = 0;\r\n      this._ = undefined;\r\n      this._b = undefined;\r\n      this._f = undefined;\r\n      return true;\r\n    }\r\n    if (m[0] == 0xf1 && typeof m[1] != 'undefined') {\r\n      var q = m[1] >> 4;\r\n      var n = m[1] & 15;\r\n      if (q == 0) {\r\n        if (this._ == 7) {\r\n          if (this._f == 7) {\r\n            this.reset(_825(this._a));\r\n            this.incrFrame();\r\n          }\r\n          this.incrFrame();\r\n        }\r\n      }\r\n      else if (q == 3) {\r\n        if (this._ == 4) {\r\n          this.decrFrame();\r\n        }\r\n      }\r\n      else if (q == 4) {\r\n        if (this._ == 3) {\r\n          this.incrFrame();\r\n        }\r\n      }\r\n      else if (q == 7) {\r\n        if (this._ === 0) {\r\n          if (this._b === 0) {\r\n            this.reset(_825(this._a));\r\n            this.decrFrame();\r\n          }\r\n          this.decrFrame();\r\n        }\r\n      }\r\n      if (!this._a) this._a = [];\r\n      this._a[q] = n;\r\n      this._f = this._f === q - 1 || q == 0 ? q : undefined;\r\n      this._b = this._b === q + 1 || q == 7 ? q : undefined;\r\n      this._ = q;\r\n      this.quarter = q;\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n  function _mtc(t) {\r\n    if (!t.backwards && t.quarter >= 4) t.decrFrame(); // continue encoding previous frame\r\n    else if (t.backwards && t.quarter < 4) t.incrFrame();\r\n    var ret;\r\n    switch (t.quarter >> 1) {\r\n      case 0: ret = t.frame; break;\r\n      case 1: ret = t.second; break;\r\n      case 2: ret = t.minute; break;\r\n      default: ret = t.hour;\r\n    }\r\n    if (t.quarter & 1) ret >>= 4;\r\n    else ret &= 15;\r\n    if (t.quarter == 7) {\r\n      if (t.type == 25) ret |= 2;\r\n      else if (t.type == 29.97) ret |= 4;\r\n      else if (t.type == 30) ret |= 6;\r\n    }\r\n    // restore original t\r\n    if (!t.backwards && t.quarter >= 4) t.incrFrame();\r\n    else if (t.backwards && t.quarter < 4) t.decrFrame();\r\n    return ret | (t.quarter << 4);\r\n  }\r\n  function _hrtype(t) {\r\n    if (t.type == 25) return t.hour | 0x20;\r\n    if (t.type == 29.97) return t.hour | 0x40;\r\n    if (t.type == 30) return t.hour | 0x60;\r\n    return t.hour;\r\n  }\r\n  function _dec(x) { return x < 10 ? '0' + x : x; }\r\n  function _smptetxt(x) {\r\n    var arr = [];\r\n    for (var i = 0; i < x.length; i++) arr[i] = _dec(i ? x[i] : x[i] & 0x1f);\r\n    return arr.join(':');\r\n  }\r\n  SMPTE.prototype.toString = function() { return _smptetxt([this.hour, this.minute, this.second, this.frame]); };\r\n  JZZ.SMPTE = SMPTE;\r\n  _J.prototype.SMPTE = SMPTE;\r\n\r\n  // JZZ.MIDI\r\n\r\n  function MIDI(arg) {\r\n    var self = this instanceof MIDI ? this : self = new MIDI();\r\n    var i;\r\n    if (arg instanceof MIDI) {\r\n      self._from = arg._from.slice();\r\n      _for(arg, function(i) { if (i != '_from') self[i] = arg[i]; });\r\n      return self;\r\n    }\r\n    else self._from = [];\r\n    if (typeof arg == 'undefined') return self;\r\n    var arr = arg instanceof Array ? arg : arguments;\r\n    for (i = 0; i < arr.length; i++) {\r\n      n = arr[i];\r\n      if (i == 1) {\r\n        if (self[0] >= 0x80 && self[0] <= 0xAF) n = MIDI.noteValue(n);\r\n        if (self[0] >= 0xC0 && self[0] <= 0xCF) n = MIDI.programValue(n);\r\n      }\r\n      if (n != parseInt(n) || n < 0 || n > 255) _throw(arr[i]);\r\n      self.push(n);\r\n    }\r\n    return self;\r\n  }\r\n  MIDI.prototype = [];\r\n  MIDI.prototype.constructor = MIDI;\r\n  var _noteNum = {};\r\n  MIDI.noteValue = function(x) { return typeof x == 'undefined' ? undefined : _noteNum[x.toString().toLowerCase()]; };\r\n  MIDI.programValue = function(x) { return x; };\r\n  MIDI.octaveValue = function(x) {\r\n    var n = _noteNum[x.toString().toLowerCase()];\r\n    if (typeof n == 'undefined') n = _noteNum[x.toString().toLowerCase() + '1'];\r\n    return typeof n == 'undefined' ? undefined : n % 12;\r\n  };\r\n  MIDI.freq = function(n, a) {\r\n    if (typeof a == 'undefined') a = 440.0;\r\n    _float(a);\r\n    if (n != parseFloat(n)) n = _7bn(n);\r\n    return (a * Math.pow(2, (n - 69.0) / 12.0));\r\n  };\r\n  function _float(x) { if (x != parseFloat(x)) throw TypeError('Not a number: ' + x); }\r\n  MIDI.shift = function(f, f0) {\r\n    if (typeof f0 == 'undefined') f0 = 440;\r\n    _float(f);\r\n    _float(f0);\r\n    return Math.log2(f / f0) * 12;\r\n  };\r\n  MIDI.midi = function(f, f0) {\r\n    if (f != parseFloat(f)) return _7bn(f);\r\n    return MIDI.shift(f, f0) + 69;\r\n  };\r\n  MIDI.to7b = function(x) {\r\n    _float(x);\r\n    return x <= 0 ? 0 : x >= 1 ? 0x7f : Math.floor(x * 0x80);\r\n  };\r\n  MIDI.to14b = function(x) {\r\n    _float(x);\r\n    return x <= 0 ? 0 : x >= 1 ? 0x3fff : Math.floor(x * 0x4000);\r\n  };\r\n  MIDI.to21b = function(x) {\r\n    if (typeof x == 'undefined') return 0x1fffff;\r\n    _float(x);\r\n    if (x <= 0) return 0;\r\n    x = (Math.floor(x) << 14) + MIDI.to14b(x - Math.floor(x));\r\n    return x < 0x1fffff ? x : 0x1ffffe;\r\n  };\r\n  function _MIDI() {}\r\n  _MIDI.prototype = MIDI;\r\n  MIDI._sxid = 0x7f;\r\n  MIDI.sxId = function(id) {\r\n    if (typeof id == 'undefined') id = MIDI._sxid;\r\n    if (id == this._sxid) return this;\r\n    id = _7b(id);\r\n    var ret = new _MIDI();\r\n    ret._ch = this._ch;\r\n    ret._sxid = id;\r\n    return ret;\r\n  };\r\n  MIDI.ch = function(c) {\r\n    if (c == this._ch || typeof c == 'undefined' && typeof this._ch == 'undefined') return this;\r\n    var ret = new _MIDI();\r\n    if (typeof c != 'undefined') c = _ch(c);\r\n    ret._ch = c;\r\n    ret._sxid = this._sxid;\r\n    return ret;\r\n  };\r\n\r\n  var _noteMap = { c:0, d:2, e:4, f:5, g:7, a:9, b:11, h:11 };\r\n  _for(_noteMap, function(k) {\r\n    for (n = 0; n < 12; n++) {\r\n      m = _noteMap[k] + n * 12;\r\n      if (m > 127) break;\r\n      _noteNum[k + n] = m; _noteNum[k + '' + n] = m;\r\n      if (m > 0) {\r\n        _noteNum[k + 'b' + n] = m - 1; _noteNum[k + '' + n] = m - 1;\r\n        _noteNum[k + 'bb' + n] = m - 2; _noteNum[k + '' + n] = m - 2; _noteNum[k + '' + n] = m - 2;\r\n      }\r\n      if (m < 127) {\r\n        _noteNum[k + '#' + n] = m + 1; _noteNum[k + '' + n] = m + 1;\r\n        _noteNum[k + '##' + n] = m + 2; _noteNum[k + '' + n] = m + 2; _noteNum[k + '' + n] = m + 2;\r\n      }\r\n    }\r\n  });\r\n  for (n = 0; n < 128; n++) _noteNum[n] = n;\r\n  function _throw(x) { throw RangeError('Bad MIDI value: ' + x); }\r\n  function _bad(x) { throw TypeError('Invalid value: ' + x); }\r\n  function _oor(x) { throw RangeError('Out of range: ' + x); }\r\n  function _ch(c) { _validateChannel(c); return parseInt(c); }\r\n  function _7b(n, m) { if (n != parseInt(n) || n < 0 || n > 0x7f) _throw(typeof m == 'undefined' ? n : m); return parseInt(n); }\r\n  function _8b(n) { if (n != parseInt(n) || n < 0 || n > 0xff) _throw(n); return parseInt(n); }\r\n  function _14b(n) { if (n != parseInt(n) || n < 0 || n > 0x3fff) _throw(n); return parseInt(n); }\r\n  function _16b(n) { if (n != parseInt(n) || n < 0 || n > 0xffff) throw RangeError('Expected a 16-bit value: ' + n); return parseInt(n); }\r\n  function _21b(n) { if (n != parseInt(n) || n < 0 || n > 0x1fffff) _throw(n); return parseInt(n); }\r\n  function _7bn(n) { return _7b(MIDI.noteValue(n), n); }\r\n  function _lsb(n) { return _14b(n) & 0x7f; }\r\n  function _msb(n) { return _14b(n) >> 7; }\r\n  function _8bs(s) { s = '' + s; for (var i = 0; i < s.length; i++) if (s.charCodeAt(i) > 255) _throw(s[i]); return s; }\r\n  function _to777(n) { return [n >> 14, (n >> 7) & 0x7f, n & 0x7f]; }\r\n  function _01(x, y) {\r\n    if (x != parseFloat(x)) _bad(typeof y == 'undefined' ? x : y);\r\n    if (x < 0 || x > 1) _oor(typeof y == 'undefined' ? x : y);\r\n    return parseFloat(x);\r\n }\r\n  function _rt(b) { return typeof b != 'undefined' && !b ? 0x7E : 0x7F; }\r\n  function _ntu(x) {\r\n    var k, m;\r\n    var kkk = [];\r\n    var vvv = {};\r\n    _for(x, function(k) {\r\n      m = _21b(x[k]);\r\n      k = _7bn(k);\r\n      if (k in vvv) throw RangeError('Duplicate MIDI value: ' + k);\r\n      kkk.push(k);\r\n      vvv[k] = m;\r\n    });\r\n    kkk.sort();\r\n    var out = [kkk.length];\r\n    for (k = 0; k < kkk.length; k++) out = out.concat([kkk[k]], _to777(vvv[kkk[k]]));\r\n    return out;\r\n  }\r\n  function _f2ntu(x) {\r\n    var out = {};\r\n    _for (x, function(k) { out[k] = MIDI.to21b(x[k] == parseFloat(x[k]) ? x[k] : _7bn(x[k])); });\r\n    return out;\r\n  }\r\n  function _hz2ntu(x) {\r\n    var out = {};\r\n    _for (x, function(k) { out[k] = MIDI.to21b(MIDI.midi(x[k])); });\r\n    return out;\r\n  }\r\n  function _12x7(a) {\r\n    var out = [];\r\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\r\n    for (var i = 0; i < 12; i++) out.push(_7b(a[i]));\r\n    return out;\r\n  }\r\n  function _12x14(a) {\r\n    var out = [];\r\n    if (!(a instanceof Array) || a.length != 12) throw TypeError('Expected an array of size 12');\r\n    for (var i = 0; i < 12; i++) {\r\n      out.push(_msb(a[i]));\r\n      out.push(_lsb(a[i]));\r\n    }\r\n    return out;\r\n  }\r\n  var _helperMPE = {\r\n    noteOff: function(c, n, v) { if (typeof v == 'undefined') v = 64; return [0x80 + _ch(c), _7bn(n), _7b(v)]; },\r\n    noteOn: function(c, n, v) { if (typeof v == 'undefined') v = 127; return [0x90 + _ch(c), _7bn(n), _7b(v)]; },\r\n    aftertouch: function(c, n, v) { return [0xA0 + _ch(c), _7bn(n), _7b(v)]; },\r\n  };\r\n  var _helperCH = {\r\n    control: function(c, n, v) { return [0xB0 + _ch(c), _7b(n), _7b(v)]; },\r\n    program: function(c, n) { return [0xC0 + _ch(c), _7b(MIDI.programValue(n), n)]; },\r\n    pressure: function(c, n) { return [0xD0 + _ch(c), _7b(n)]; },\r\n    pitchBend: function(c, n, l) { return typeof l == 'undefined' ? [0xE0 + _ch(c), _lsb(n), _msb(n)] : [0xE0 + _ch(c), _7b(l), _7b(n)]; },\r\n    pitchBendF: function(c, x) { return _helperCH.pitchBend(c, MIDI.to14b((x + 1) / 2)); },\r\n    bankMSB: function(c, n) { return [0xB0 + _ch(c), 0x00, _7b(n)]; },\r\n    bankLSB: function(c, n) { return [0xB0 + _ch(c), 0x20, _7b(n)]; },\r\n    modMSB: function(c, n) { return [0xB0 + _ch(c), 0x01, _7b(n)]; },\r\n    modLSB: function(c, n) { return [0xB0 + _ch(c), 0x21, _7b(n)]; },\r\n    breathMSB: function(c, n) { return [0xB0 + _ch(c), 0x02, _7b(n)]; },\r\n    breathLSB: function(c, n) { return [0xB0 + _ch(c), 0x22, _7b(n)]; },\r\n    footMSB: function(c, n) { return [0xB0 + _ch(c), 0x04, _7b(n)]; },\r\n    footLSB: function(c, n) { return [0xB0 + _ch(c), 0x24, _7b(n)]; },\r\n    portamentoMSB: function(c, n) { return [0xB0 + _ch(c), 0x05, _7b(n)]; },\r\n    portamentoLSB: function(c, n) { return [0xB0 + _ch(c), 0x25, _7b(n)]; },\r\n    dataMSB: function(c, n) { return [0xB0 + _ch(c), 0x06, _7b(n)]; },\r\n    dataLSB: function(c, n) { return [0xB0 + _ch(c), 0x26, _7b(n)]; },\r\n    volumeMSB: function(c, n) { return [0xB0 + _ch(c), 0x07, _7b(n)]; },\r\n    volumeLSB: function(c, n) { return [0xB0 + _ch(c), 0x27, _7b(n)]; },\r\n    balanceMSB: function(c, n) { return [0xB0 + _ch(c), 0x08, _7b(n)]; },\r\n    balanceLSB: function(c, n) { return [0xB0 + _ch(c), 0x28, _7b(n)]; },\r\n    panMSB: function(c, n) { return [0xB0 + _ch(c), 0x0A, _7b(n)]; },\r\n    panLSB: function(c, n) { return [0xB0 + _ch(c), 0x2A, _7b(n)]; },\r\n    expressionMSB: function(c, n) { return [0xB0 + _ch(c), 0x0B, _7b(n)]; },\r\n    expressionLSB: function(c, n) { return [0xB0 + _ch(c), 0x2B, _7b(n)]; },\r\n    damper: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x40, b ? 127 : 0]; },\r\n    portamento: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x41, b ? 127 : 0]; },\r\n    sostenuto: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x42, b ? 127 : 0]; },\r\n    soft: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x43, b ? 127 : 0]; },\r\n    legato: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x44, b ? 127 : 0]; },\r\n    hold2: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x45, b ? 127 : 0]; },\r\n    soundVariation: function(c, n) { return [0xB0 + _ch(c), 0x46, _7bn(n)]; },\r\n    filterResonance: function(c, n) { return [0xB0 + _ch(c), 0x47, _7bn(n)]; },\r\n    releaseTime: function(c, n) { return [0xB0 + _ch(c), 0x48, _7bn(n)]; },\r\n    attackTime: function(c, n) { return [0xB0 + _ch(c), 0x49, _7bn(n)]; },\r\n    brightness: function(c, n) { return [0xB0 + _ch(c), 0x4A, _7bn(n)]; },\r\n    decayTime: function(c, n) { return [0xB0 + _ch(c), 0x4B, _7bn(n)]; },\r\n    vibratoRate: function(c, n) { return [0xB0 + _ch(c), 0x4C, _7bn(n)]; },\r\n    vibratoDepth: function(c, n) { return [0xB0 + _ch(c), 0x4D, _7bn(n)]; },\r\n    vibratoDelay: function(c, n) { return [0xB0 + _ch(c), 0x4E, _7bn(n)]; },\r\n    ptc: function(c, n) { return [0xB0 + _ch(c), 0x54, _7bn(n)]; },\r\n    dataIncr: function(c) { return [0xB0 + _ch(c), 0x60, 0]; },\r\n    dataDecr: function(c) { return [0xB0 + _ch(c), 0x61, 0]; },\r\n    nrpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x62, _7b(n)]; },\r\n    nrpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x63, _7b(n)]; },\r\n    rpnLSB: function(c, n) { return [0xB0 + _ch(c), 0x64, _7b(n)]; },\r\n    rpnMSB: function(c, n) { return [0xB0 + _ch(c), 0x65, _7b(n)]; },\r\n    allSoundOff: function(c) { return [0xB0 + _ch(c), 0x78, 0]; },\r\n    resetAllControllers: function(c) { return [0xB0 + _ch(c), 0x79, 0]; },\r\n    localControl: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), 0x7a, b ? 127 : 0]; },\r\n    allNotesOff: function(c) { return [0xB0 + _ch(c), 0x7b, 0]; },\r\n    omni: function(c, b) { if (typeof b == 'undefined') b = true; return [0xB0 + _ch(c), b ? 0x7d : 0x7c, 0]; },\r\n    mono: function(c, n) { if (typeof n == 'undefined') n = 1; return [0xB0 + _ch(c), 0x7e, _7b(n)]; },\r\n    poly: function(c) { return [0xB0 + _ch(c), 0x7f, 0]; },\r\n  };\r\n  function _splitMasterTuning(a, b, c, d) {\r\n    if (typeof b != 'undefined') return [_7b(a), _7b(b), _7b(c), _7b(d)];\r\n    if (a != parseInt(a) || a < 0 || n > 0xffff) _bad(a);\r\n    a = parseInt(a);\r\n    return [(a >> 12) & 0xf, (a >> 8) & 0xf, (a >> 4) & 0xf, a & 0xf];\r\n  }\r\n  function _gsxg12b(x) { // -1 <= x <= 1\r\n    _float(x);\r\n    return Math.round(x * 1000 + 0x400);\r\n  }\r\n  var _helperNC = { // no channel\r\n    mtc: function(t) { return [0xF1, _mtc(t)]; },\r\n    songPosition: function(n, l) { return typeof l == 'undefined' ? [0xF2, _lsb(n), _msb(n)] : [0xF2, _7b(l), _7b(n)]; },\r\n    songSelect: function(n) { return [0xF3, _7b(n)]; },\r\n    tune: function() { return [0xF6]; },\r\n    clock: function() { return [0xF8]; },\r\n    start: function() { return [0xFA]; },\r\n    continue: function() { return [0xFB]; },\r\n    stop: function() { return [0xFC]; },\r\n    active: function() { return [0xFE]; },\r\n    sxIdRequest: function() { return [0xF0, 0x7E, this._sxid, 0x06, 0x01, 0xF7]; },\r\n    sxTuningDumpRequest: function(n, k) { return typeof k == 'undefined' ?\r\n      [0xF0, 0x7E, this._sxid, 0x08, 0x00, _7b(n), 0xF7] : [0xF0, 0x7E, this._sxid, 0x08, 0x03, _7b(n), _7b(k), 0xF7]; },\r\n    sxFullFrame: function(t) { return [0xF0, 0x7F, this._sxid, 0x01, 0x01, _hrtype(t), t.getMinute(), t.getSecond(), t.getFrame(), 0xF7]; },\r\n    sxMasterVolume: function(n, l) { return typeof l == 'undefined' ?\r\n      [0xF0, 0x7F, this._sxid, 0x04, 0x01, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x01, _7b(l), _7b(n), 0xF7]; },\r\n    sxMasterVolumeF: function(x) { return _helperNC.sxMasterVolume.call(this, MIDI.to14b(_01(x))); },\r\n    sxMasterFineTuning: function(n, l) { return typeof l == 'undefined' ?\r\n      [0xF0, 0x7F, this._sxid, 0x04, 0x03, _lsb(n), _msb(n), 0xF7] : [0xF0, 0x7F, this._sxid, 0x04, 0x03, _7b(l), _7b(n), 0xF7]; },\r\n    sxMasterFineTuningF: function(x) { return _helperNC.sxMasterFineTuning.call(this, MIDI.to14b(_01((x % 1 + 1) / 2, x))); },\r\n    sxMasterCoarseTuning: function(n) { return [0xF0, 0x7F, this._sxid, 0x04, 0x04, 0x00, _7b(n), 0xF7]; },\r\n    sxMasterCoarseTuningF: function(x) { return _helperNC.sxMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\r\n    sxNoteTuning: function(a, b, c, d) { return b == parseInt(b) ?\r\n      [0xF0, _rt(d), this._sxid, 0x08, 0x07, _7b(a), _7b(b)].concat(_ntu(c), [0xF7]) :\r\n      [0xF0, 0x7F, this._sxid, 0x08, 0x02, _7b(a)].concat(_ntu(b), [0xF7]); },\r\n    sxNoteTuningF: function(a, b, c, d) { return b == parseInt(b) ?\r\n      _helperNC.sxNoteTuning.call(this, a, b, _f2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _f2ntu(b)); },\r\n    sxNoteTuningHZ: function(a, b, c, d) { return b == parseInt(b) ?\r\n      _helperNC.sxNoteTuning.call(this, a, b, _hz2ntu(c), d) : _helperNC.sxNoteTuning.call(this, a, _hz2ntu(b)); },\r\n    sxScaleTuning1: function(a, b, c) { return a == parseInt(a) ?\r\n      [0xF0, _rt(c), this._sxid, 0x08, 0x08].concat(_to777(_16b(a)), _12x7(b), [0xF7]) :\r\n      _helperNC.sxScaleTuning1.call(this, 0xffff, a, b); },\r\n    sxScaleTuning1F: function(a, b, c) { if (a != parseInt(a)) return _helperNC.sxScaleTuning1F.call(this, 0xffff, a, b);\r\n      var v = []; for (var i = 0; i < b.length; i++) {\r\n        if (b[i] < -0.64 || b[i] > 0.63) throw RangeError('Out of range: ' + b[i]);\r\n        v.push(Math.floor(b[i] * 100 + 64)); }\r\n      return _helperNC.sxScaleTuning1.call(this, a, v, c); },\r\n    sxScaleTuning2: function(a, b, c) { return a == parseInt(a) ?\r\n      [0xF0, _rt(c), this._sxid, 0x08, 0x09].concat(_to777(_16b(a)), _12x14(b), [0xF7]) :\r\n      _helperNC.sxScaleTuning2.call(this, 0xffff, a, b); },\r\n    sxScaleTuning2F: function(a, b, c) { if (a != parseInt(a)) return _helperNC.sxScaleTuning2F.call(this, 0xffff, a, b);\r\n      var v = []; for (var i = 0; i < b.length; i++) {\r\n        var x = (b[i] + 1) / 2;\r\n        if (x < -1 || x > 1) throw RangeError('Out of range: ' + b[i]);\r\n        v.push(MIDI.to14b((b[i] + 1) / 2)); }\r\n      return _helperNC.sxScaleTuning2.call(this, a, v, c); },\r\n    sxGM: function(gm) { if (typeof gm == 'undefined') gm = 1; return [0xF0, 0x7E, this._sxid, 0x09, gm ? gm == 2 ? 3 : 1 : 2, 0xf7]; },\r\n    sxGS: function(arg) { var arr = typeof arg == 'undefined' ? [0x40, 0, 0x7F, 0] : arg instanceof Array ? arg : arguments;\r\n      var c = 0; var a = [0xF0, 0x41, this._sxid, 0x42, 0x12];\r\n      for (var i = 0; i < arr.length; i++) { var x = _7b(arr[i]); a.push(x); c += x; }\r\n      c %= 128; a.push(c ? 128 - c : 0); a.push(0xf7); return a; },\r\n    sxXG: function(arg) { var arr = typeof arg == 'undefined' ? [0, 0, 0x7E, 0] : arg instanceof Array ? arg : arguments;\r\n      var sxid = this._sxid == 0x7f ? 0 : this._sxid;\r\n      if (sxid > 15) _throw('Bad Yamaha device number: ' + sxid);\r\n      var a = [0xf0, 0x43, 16 + sxid, 0x4c];\r\n      for (var i = 0; i < arr.length; i++) a.push(_7b(arr[i])); a.push(0xf7); return a; },\r\n    sxMidiSoft: function(n, s) {\r\n      var a = [0xf0, 0x00, 0x20, 0x24, 0x00, _7b(n || 0)];\r\n      s = typeof s == 'undefined' ? '' : '' + s;\r\n      for (var i = 0; i < s.length; i++) a.push(_7b(s.charCodeAt(i)));\r\n      a.push(0xf7); return a; },\r\n    gsMasterVolume: function(n) { return _helperNC.sxGS.call(this, [0x40, 0, 4, _7b(n)]); },\r\n    gsMasterVolumeF: function(x) { return _helperNC.gsMasterVolume.call(this, MIDI.to7b(_01(x))); },\r\n    gsMasterFineTuning: function(a, b, c, d) { a = _splitMasterTuning(a, b, c, d); return _helperNC.sxGS.call(this, [0x40, 0, 0, a[0], a[1], a[2], a[3]]); },\r\n    gsMasterFineTuningF: function(x) { return _helperNC.gsMasterFineTuning.call(this, _gsxg12b(x % 1)); },\r\n    gsMasterCoarseTuning: function(n) { return _helperNC.sxGS.call(this, [0x40, 0, 5, _7b(n)]); },\r\n    gsMasterCoarseTuningF: function(x) { return _helperNC.gsMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\r\n    gsOctaveTuning: function(c, n, x) { return _helperNC.sxGS.call(this, [0x40, 0x10 + [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 11, 12, 13, 14, 15][_ch(c)], 0x40 + MIDI.octaveValue(n), _7b(x)]); },\r\n    gsOctaveTuningF: function(c, n, x) { if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\r\n      return _helperNC.gsOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64)); },\r\n    xgMasterVolume: function(n) { return _helperNC.sxXG.call(this, [0, 0, 4, _7b(n)]); },\r\n    xgMasterVolumeF: function(x) { return _helperNC.xgMasterVolume.call(this, MIDI.to7b(_01(x))); },\r\n    xgMasterFineTuning: function(a, b, c, d) { a = _splitMasterTuning(a, b, c, d); return _helperNC.sxXG.call(this, [0, 0, 0, a[0], a[1], a[2], a[3]]); },\r\n    xgMasterFineTuningF: function(x) { return _helperNC.xgMasterFineTuning.call(this, _gsxg12b(x % 1)); },\r\n    xgMasterCoarseTuning: function(n) { return _helperNC.sxXG.call(this, [0, 0, 6, _7b(n)]); },\r\n    xgMasterCoarseTuningF: function(x) { return _helperNC.xgMasterCoarseTuning.call(this, 0x40 + (x - x % 1)); },\r\n    xgOctaveTuning: function(c, n, x) { return _helperNC.sxXG.call(this, [8, _ch(c), 0x41 + MIDI.octaveValue(n), _7b(x)]); },\r\n    xgOctaveTuningF: function(c, n, x) { if (x < -0.64 || x > 0.63) throw RangeError('Out of range: ' + x);\r\n      return _helperNC.xgOctaveTuning.call(this, c, n, Math.floor(x * 100 + 64)); },\r\n    reset: function() { return [0xFF]; },\r\n  };\r\n  _helperNC.sxScaleTuning = _helperNC.sxScaleTuning2;\r\n  _helperNC.sxScaleTuningF = _helperNC.sxScaleTuning2F;\r\n  _helperNC.sxMasterTranspose = _helperNC.sxMasterCoarseTuning;\r\n  _helperNC.sxMasterTransposeF = _helperNC.sxMasterCoarseTuningF;\r\n  _helperNC.gsMasterTranspose = _helperNC.gsMasterCoarseTuning;\r\n  _helperNC.gsMasterTransposeF = _helperNC.gsMasterCoarseTuningF;\r\n  _helperNC.xgMasterTranspose = _helperNC.xgMasterCoarseTuning;\r\n  _helperNC.xgMasterTransposeF = _helperNC.xgMasterCoarseTuningF;\r\n  var _helperGCH = { // compound messages\r\n    bank: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.bankMSB(c, _msb(m)), _helperCH.bankLSB(c, _lsb(m))] : [_helperCH.bankMSB(c, m), _helperCH.bankLSB(c, l)]; },\r\n    modF: function(c, x) { return _helperGCH.mod(c, MIDI.to14b(x)); },\r\n    mod: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.modMSB(c, _msb(m)), _helperCH.modLSB(c, _lsb(m))] : [_helperCH.modMSB(c, m), _helperCH.modLSB(c, l)]; },\r\n    breathF: function(c, x) { return _helperGCH.breath(c, MIDI.to14b(x)); },\r\n    breath: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.breathMSB(c, _msb(m)), _helperCH.breathLSB(c, _lsb(m))] : [_helperCH.breathMSB(c, m), _helperCH.breathLSB(c, l)]; },\r\n    footF: function(c, x) { return _helperGCH.foot(c, MIDI.to14b(x)); },\r\n    foot: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.footMSB(c, _msb(m)), _helperCH.footLSB(c, _lsb(m))] : [_helperCH.footMSB(c, m), _helperCH.footLSB(c, l)]; },\r\n    portamentoTimeF: function(c, x) { return _helperGCH.portamentoTime(c, MIDI.to14b(x)); },\r\n    portamentoTime: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.portamentoMSB(c, _msb(m)), _helperCH.portamentoLSB(c, _lsb(m))] : [_helperCH.portamentoMSB(c, m), _helperCH.portamentoLSB(c, l)]; },\r\n    dataF: function(c, x) { return _helperGCH.data(c, MIDI.to14b(x)); },\r\n    data: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.dataMSB(c, _msb(m)), _helperCH.dataLSB(c, _lsb(m))] : [_helperCH.dataMSB(c, m), _helperCH.dataLSB(c, l)]; },\r\n    volumeF: function(c, x) { return _helperGCH.volume(c, MIDI.to14b(x)); },\r\n    volume: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.volumeMSB(c, _msb(m)), _helperCH.volumeLSB(c, _lsb(m))] : [_helperCH.volumeMSB(c, m), _helperCH.volumeLSB(c, l)]; },\r\n    balanceF: function(c, x) { return _helperGCH.balance(c, MIDI.to14b((x + 1) / 2)); },\r\n    balance: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.balanceMSB(c, _msb(m)), _helperCH.balanceLSB(c, _lsb(m))] : [_helperCH.balanceMSB(c, m), _helperCH.balanceLSB(c, l)]; },\r\n    panF: function(c, x) { return _helperGCH.pan(c, MIDI.to14b((x + 1) / 2)); },\r\n    pan: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.panMSB(c, _msb(m)), _helperCH.panLSB(c, _lsb(m))] : [_helperCH.panMSB(c, m), _helperCH.panLSB(c, l)]; },\r\n    expressionF: function(c, x) { return _helperGCH.expression(c, MIDI.to14b(x)); },\r\n    expression: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.expressionMSB(c, _msb(m)), _helperCH.expressionLSB(c, _lsb(m))] : [_helperCH.expressionMSB(c, m), _helperCH.expressionLSB(c, l)]; },\r\n    nrpn: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.nrpnMSB(c, _msb(m)), _helperCH.nrpnLSB(c, _lsb(m))] : [_helperCH.nrpnMSB(c, m), _helperCH.nrpnLSB(c, l)]; },\r\n    rpn: function(c, m, l) { return typeof l == 'undefined' ?\r\n      [_helperCH.rpnMSB(c, _msb(m)), _helperCH.rpnLSB(c, _lsb(m))] : [_helperCH.rpnMSB(c, m), _helperCH.rpnLSB(c, l)]; },\r\n    rpnPitchBendRange: function(c, m, l) { return _helperGCH.rpn(c, 0, 0).concat(_helperGCH.data(c, m, l)); },\r\n    rpnPitchBendRangeF: function(c, x) { return _helperGCH.rpnPitchBendRange(c, _7b(x - x % 1), Math.floor((x % 1) * 100)); },\r\n    rpnFineTuning: function(c, m, l) { return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.data(c, m, l)); },\r\n    rpnFineTuningF: function(c, x) { return _helperGCH.rpn(c, 0, 1).concat(_helperGCH.dataF(c, (x % 1 + 1) / 2)); },\r\n    rpnCoarseTuning: function(c, m) { return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, m)]); },\r\n    rpnCoarseTuningF: function(c, x) { return _helperGCH.rpn(c, 0, 2).concat([_helperCH.dataMSB(c, 0x40 + (x - x % 1))]); },\r\n    rpnTuning: function(c, n, m, l) { return _helperGCH.rpnCoarseTuning(c, n).concat(_helperGCH.rpnFineTuning(c, m, l)); },\r\n    rpnTuningF: function(c, x) { return _helperGCH.rpnCoarseTuningF(c, x).concat(_helperGCH.rpnFineTuningF(c, x)); },\r\n    rpnTuningA: function(c, a) { return _helperGCH.rpnTuningF(c, MIDI.shift(a)); },\r\n    rpnSelectTuningProgram: function(c, n) { return _helperGCH.rpn(c, 0, 3).concat([_helperCH.dataMSB(c, n)]); },\r\n    rpnSelectTuningBank: function(c, n) { return _helperGCH.rpn(c, 0, 4).concat([_helperCH.dataMSB(c, n)]); },\r\n    rpnSelectTuning: function(c, n, k) { return typeof k == 'undefined' ?\r\n      _helperGCH.rpnSelectTuningProgram(c, n) : _helperGCH.rpnSelectTuningBank(c, n).concat(_helperGCH.rpnSelectTuningProgram(c, k)); },\r\n    rpnModulationDepthRange: function(c, m, l) { return _helperGCH.rpn(c, 0, 5).concat(_helperGCH.data(c, m, l)); },\r\n    rpnModulationDepthRangeF: function(c, x) { return _helperGCH.rpnModulationDepthRange(c, _7b(x - x % 1), Math.floor((x % 1) * 128)); },\r\n    rpnNull: function(c) { return _helperGCH.rpn(c, 0x7f, 0x7f); },\r\n    mode1: function(c) { return [ _helperCH.omni(c, true), _helperCH.poly(c) ]; },\r\n    mode2: function(c) { return [ _helperCH.omni(c, true), _helperCH.mono(c) ]; },\r\n    mode3: function(c) { return [ _helperCH.omni(c, false), _helperCH.poly(c) ]; },\r\n    mode4: function(c) { return [ _helperCH.omni(c, false), _helperCH.mono(c) ]; },\r\n  };\r\n  var _helperGNC = { // compound messages no channel\r\n    sxMasterTuning: function(n, m, l) { return [_helperNC.sxMasterCoarseTuning.call(this, n), _helperNC.sxMasterFineTuning.call(this, m, l)]; },\r\n    sxMasterTuningF: function(x) { return [_helperNC.sxMasterCoarseTuningF.call(this, x), _helperNC.sxMasterFineTuningF.call(this, x)]; },\r\n    gsMasterTuningF: function(x) { return [_helperNC.gsMasterCoarseTuningF.call(this, x), _helperNC.gsMasterFineTuningF.call(this, x)]; },\r\n    xgMasterTuningF: function(x) { return [_helperNC.xgMasterCoarseTuningF.call(this, x), _helperNC.xgMasterFineTuningF.call(this, x)]; },\r\n    sxMasterTuningA: function(a) { return _helperGNC.sxMasterTuningF.call(this, MIDI.shift(a)); },\r\n    gsMasterTuningA: function(a) { return _helperGNC.gsMasterTuningF.call(this, MIDI.shift(a)); },\r\n    xgMasterTuningA: function(a) { return _helperGNC.xgMasterTuningF.call(this, MIDI.shift(a)); },\r\n    gsScaleTuning: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\r\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuning.call(this, c, i, a[i])); return out; },\r\n    gsScaleTuningF: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\r\n      for (var i = 0; i < 12; i++) out.push(_helperNC.gsOctaveTuningF.call(this, c, i, a[i])); return out; },\r\n    xgScaleTuning: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\r\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuning.call(this, c, i, a[i])); return out; },\r\n    xgScaleTuningF: function(c, a) { var out = []; if (a.length != 12) throw RangeError('Wrong input size: ' + a.length);\r\n      for (var i = 0; i < 12; i++) out.push(_helperNC.xgOctaveTuningF.call(this, c, i, a[i])); return out; },\r\n  };\r\n  function _smf(ff, dd) {\r\n    var midi = new MIDI();\r\n    midi.ff = _8b(ff);\r\n    midi.dd = typeof dd == 'undefined' ? '' : _8bs(dd);\r\n    return midi;\r\n  }\r\n  var _helperSMF = { // Standard MIDI File events\r\n    smf: function(arg) {\r\n      if (arg instanceof MIDI) return new MIDI(arg);\r\n      var arr = arg instanceof Array ? arg : arguments;\r\n      var ff = _8b(arr[0]);\r\n      var dd = '';\r\n      if (arr.length == 2) dd = _2s(arr[1]);\r\n      else if (arr.length > 2) dd = _2s(Array.prototype.slice.call(arr, 1));\r\n      return _smf(ff, dd);\r\n    },\r\n    smfSeqNumber: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        if (dd < 0 || dd > 0xffff) throw RangeError('Sequence number out of range: ' + dd);\r\n        dd = String.fromCharCode(dd >> 8) + String.fromCharCode(dd & 0xff);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00\\x00';\r\n        else if (dd.length == 1) dd = '\\x00' + dd;\r\n        else if (dd.length > 2) throw RangeError('Sequence number out of range' + _smftxt(dd));\r\n      }\r\n      return _smf(0, dd);\r\n    },\r\n    smfText: function(dd) { return _smf(1, JZZ.lib.toUTF8(dd)); },\r\n    smfCopyright: function(dd) { return _smf(2, JZZ.lib.toUTF8(dd)); },\r\n    smfSeqName: function(dd) { return _smf(3, JZZ.lib.toUTF8(dd)); },\r\n    smfInstrName: function(dd) { return _smf(4, JZZ.lib.toUTF8(dd)); },\r\n    smfLyric: function(dd) { return _smf(5, JZZ.lib.toUTF8(dd)); },\r\n    smfMarker: function(dd) { return _smf(6, JZZ.lib.toUTF8(dd)); },\r\n    smfCuePoint: function(dd) { return _smf(7, JZZ.lib.toUTF8(dd)); },\r\n    smfProgName: function(dd) { return _smf(8, JZZ.lib.toUTF8(dd)); },\r\n    smfDevName: function(dd) { return _smf(9, JZZ.lib.toUTF8(dd)); },\r\n    smfChannelPrefix: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        _validateChannel(dd);\r\n        dd = String.fromCharCode(dd);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00';\r\n        else if (dd.length > 1 || dd.charCodeAt(0) > 15) throw RangeError('Channel number out of range' + _smftxt(dd));\r\n      }\r\n      return _smf(32, dd);\r\n    },\r\n    smfMidiPort: function(dd) {\r\n      if (dd == parseInt(dd)) {\r\n        if (dd < 0 || dd > 127) throw RangeError('Port number out of range: ' + dd);\r\n        dd = String.fromCharCode(dd);\r\n      }\r\n      else {\r\n        dd = '' + dd;\r\n        if (dd.length == 0) dd = '\\x00';\r\n        else if (dd.length > 1 || dd.charCodeAt(0) > 127) throw RangeError('Port number out of range' + _smftxt(dd));\r\n      }\r\n      return _smf(33, dd);\r\n    },\r\n    smfEndOfTrack: function(dd) {\r\n      if (_2s(dd) != '') throw RangeError('Unexpected data' + _smftxt(_2s(dd)));\r\n      return _smf(47);\r\n    },\r\n    smfTempo: function(dd) { // microseconds per quarter note\r\n      if (('' + dd).length == 3) return _smf(81, dd);\r\n      if (dd == parseInt(dd) && dd > 0 && dd <= 0xffffff) {\r\n        return _smf(81, String.fromCharCode(dd >> 16) + String.fromCharCode((dd >> 8) & 0xff) + String.fromCharCode(dd & 0xff));\r\n      }\r\n      throw RangeError('Out of range' + _smftxt(_2s(dd)));\r\n    },\r\n    smfBPM: function(bpm) { return _helperSMF.smfTempo(Math.round(60000000.0 / bpm)); },\r\n    smfSMPTE: function(dd) {\r\n      if (dd instanceof SMPTE) return _smf(84, String.fromCharCode(dd.hour) + String.fromCharCode(dd.minute) + String.fromCharCode(dd.second) + String.fromCharCode(dd.frame) + String.fromCharCode((dd.quarter % 4) * 25));\r\n      var s = '' + dd;\r\n      if (s.length == 5) {\r\n        return _smf(84, dd);\r\n      }\r\n      var arr = dd instanceof Array ? dd : Array.prototype.slice.call(arguments);\r\n      arr.splice(0, 0, 30);\r\n      return _helperSMF.smfSMPTE(new SMPTE(arr));\r\n    },\r\n    smfTimeSignature: function(a, b, c, d) {\r\n      var nn, dd, cc, bb;\r\n      var m = ('' + a ).match(/^\\s*(\\d+)\\s*\\/\\s*(\\d+)\\s*$/);\r\n      if (m) {\r\n        nn = parseInt(m[1]);\r\n        dd = parseInt(m[2]);\r\n        if (nn > 0 && nn < 0x100 && dd > 0 && !(dd & (dd - 1))) {\r\n          cc = dd; dd = 0;\r\n          for (cc >>= 1; cc; cc >>= 1) dd++;\r\n          cc = b == parseInt(b) ? b : 24;\r\n          bb = c == parseInt(c) ? c : 8;\r\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\r\n        }\r\n        else if (('' + a ).length == 4) return _smf(88, a);\r\n      }\r\n      else if (a == parseInt(a) && b == parseInt(b)) {\r\n        if (a > 0 && a < 0x100 && b > 0 && !(b & (b - 1))) {\r\n          nn = a;\r\n          dd = 0;\r\n          cc = b;\r\n          for (cc >>= 1; cc; cc >>= 1) dd++;\r\n          cc = c == parseInt(c) ? c : 24;\r\n          bb = d == parseInt(d) ? d : 8;\r\n          return _smf(88, String.fromCharCode(nn) + String.fromCharCode(dd) + String.fromCharCode(cc) + String.fromCharCode(bb));\r\n        }\r\n        else if (('' + a ).length == 4) return _smf(88, a);\r\n        a = a + '/' + b;\r\n      }\r\n      else if (('' + a ).length == 4) return _smf(88, a);\r\n      throw RangeError('Wrong time signature' + _smftxt(_2s('' + a)));\r\n    },\r\n    smfKeySignature: function(dd) {\r\n      dd = '' + dd;\r\n      var m = dd.match(/^\\s*([A-H][b#]?)\\s*(|maj|major|dur|m|min|minor|moll)\\s*$/i);\r\n      if (m) {\r\n        var sf = {\r\n          CB: 0, GB: 1, DB: 2, AB: 3, EB: 4, BB: 5, F: 6, C: 7, G: 8, D: 9, A: 10,\r\n          E:11, B: 12, H: 12, 'F#': 13, 'C#': 14, 'G#': 15, 'D#': 16, 'A#': 17\r\n        }[m[1].toUpperCase()];\r\n        var mi = { '': 0, MAJ: 0, MAJOR: 0, DUR: 0, M: 1, MIN: 1, MINOR: 1, MOLL: 1}[m[2].toUpperCase()];\r\n        if (typeof sf != 'undefined' && typeof mi != 'undefined') {\r\n          if (mi) sf -= 3;\r\n          sf -= 7;\r\n          if (sf >= -7 && sf < 0) dd = String.fromCharCode(256 + sf) + String.fromCharCode(mi);\r\n          else if (sf >= 0 && sf <= 7) dd = String.fromCharCode(sf) + String.fromCharCode(mi);\r\n        }\r\n      }\r\n      if (dd.length == 2 && dd.charCodeAt(1) <= 1 && (dd.charCodeAt(0) <= 7 || dd.charCodeAt(0) <= 255 && dd.charCodeAt(0) >= 249)) return _smf(89, dd);\r\n      throw RangeError('Incorrect key signature' + _smftxt(dd));\r\n    },\r\n    smfSequencer: function(dd) { return _smf(127, _2s(dd)); }\r\n  };\r\n\r\n  var _helpers = {};\r\n  function _copyHelperNC(name, func) {\r\n    MIDI[name] = function() { return new MIDI(func.apply(this, arguments)); };\r\n    _helpers[name] = function() { return this.send(func.apply(this, arguments)); };\r\n  }\r\n  function _copyHelperSMF(name, func) {\r\n    MIDI[name] = function() { return func.apply(this, arguments); };\r\n    _helpers[name] = function() { return this.send(func.apply(this, arguments)); };\r\n  }\r\n  function _copyHelperGNC(name, func) {\r\n    MIDI[name] = function() {\r\n      var i;\r\n      var g = [];\r\n      var a = func.apply(this, arguments);\r\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\r\n      return g;\r\n    };\r\n    _helpers[name] = function() {\r\n      var a = func.apply(this, arguments);\r\n      var g = this;\r\n      for (var i = 0; i < a.length; i++) g = g.send(a[i]);\r\n      return g;\r\n    };\r\n  }\r\n  function _copyHelperMPE(name, func) {\r\n    MIDI[name] = function() {\r\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\r\n    };\r\n    _helpers[name] = function() {\r\n      if (typeof this._master != 'undefined') {\r\n        var msg = new MIDI(func.apply(this, [this._master].concat(Array.prototype.slice.call(arguments))));\r\n        msg._mpe = msg[1];\r\n        return this.send(msg);\r\n      }\r\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\r\n    };\r\n  }\r\n  function _copyHelperCH(name, func) {\r\n    MIDI[name] = function() {\r\n      return new MIDI(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\r\n    };\r\n    _helpers[name] = function() {\r\n      if (typeof this._master != 'undefined') {\r\n        var chan;\r\n        var args = Array.prototype.slice.call(arguments);\r\n        if (args.length < func.length) args = [this._master].concat(args);\r\n        else {\r\n          chan = _7bn(args[0]);\r\n          args[0] = this._master;\r\n        }\r\n        var msg = new MIDI(func.apply(this, args));\r\n        msg._mpe = chan;\r\n        return this.send(msg);\r\n      }\r\n      return this.send(func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments))));\r\n    };\r\n  }\r\n  function _copyHelperGCH(name, func) {\r\n    MIDI[name] = function() {\r\n      var i;\r\n      var g = [];\r\n      var a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\r\n      for (i = 0; i < a.length; i++) g.push(new MIDI(a[i]));\r\n      return g;\r\n    };\r\n    _helpers[name] = function() {\r\n      var i;\r\n      var a;\r\n      var g;\r\n      if (typeof this._master != 'undefined') {\r\n        var chan;\r\n        var args = Array.prototype.slice.call(arguments);\r\n        if (args.length < func.length) args = [this._master].concat(args);\r\n        else {\r\n          chan = _7bn(args[0]);\r\n          args[0] = this._master;\r\n        }\r\n        a = func.apply(this, args);\r\n        g = this;\r\n        for (i = 0; i < a.length; i++) {\r\n          var msg = MIDI(a[i]);\r\n          msg._mpe = chan;\r\n          g = g.send(msg);\r\n        }\r\n        return g;\r\n      }\r\n      a = func.apply(this, typeof this._ch == 'undefined' ? arguments : [this._ch].concat(Array.prototype.slice.call(arguments)));\r\n      g = this;\r\n      for (i = 0; i < a.length; i++) g = g.send(a[i]);\r\n      return g;\r\n    };\r\n  }\r\n\r\n  _for(_helperNC, function(n) { _copyHelperNC(n, _helperNC[n]); });\r\n  _for(_helperSMF, function(n) { _copyHelperSMF(n, _helperSMF[n]); });\r\n  _for(_helperGNC, function(n) { _copyHelperGNC(n, _helperGNC[n]); });\r\n  _for(_helperMPE, function(n) { _copyHelperMPE(n, _helperMPE[n]); });\r\n  _for(_helperCH, function(n) { _copyHelperCH(n, _helperCH[n]); });\r\n  _for(_helperGCH, function(n) { _copyHelperGCH(n, _helperGCH[n]); });\r\n\r\n  function _copyMidiHelpers(M) {\r\n    _for(_helpers, function(n) { M.prototype[n] = _helpers[n]; });\r\n  }\r\n  _copyMidiHelpers(_M);\r\n\r\n  var _channelMap = { a:10, b:11, c:12, d:13, e:14, f:15, A:10, B:11, C:12, D:13, E:14, F:15 };\r\n  for (k = 0; k < 16; k++) _channelMap[k] = k;\r\n  MIDI.prototype.getChannel = function() {\r\n    if (this.ff == 0x20 && this.dd.length == 1 && this.dd.charCodeAt(0) < 16) return this.dd.charCodeAt(0);\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xef) return;\r\n    return c & 15;\r\n  };\r\n  MIDI.prototype.setChannel = function(x) {\r\n    x = _channelMap[x];\r\n    if (typeof x == 'undefined') return this;\r\n    if (this.ff == 0x20) this.dd = String.fromCharCode(x);\r\n    else {\r\n      var c = this[0];\r\n      if (typeof c != 'undefined' && c >= 0x80 && c <= 0xef) this[0] = (c & 0xf0) | x;\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype.getNote = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return;\r\n    return this[1];\r\n  };\r\n  MIDI.prototype.setNote = function(x) {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0xaf) return this;\r\n    x = MIDI.noteValue(x);\r\n    if (typeof x != 'undefined') this[1] = x;\r\n    return this;\r\n  };\r\n  MIDI.prototype.getVelocity = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return;\r\n    return this[2];\r\n  };\r\n  MIDI.prototype.setVelocity = function(x) {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return this;\r\n    x = parseInt(x);\r\n    if (x >= 0 && x < 128) this[2] = x;\r\n    return this;\r\n  };\r\n  MIDI.prototype.getSysExId = function() {\r\n    if (this[0] == 0xf0) return this[2];\r\n  };\r\n  MIDI.prototype.setSysExId = function(x) {\r\n    if (this[0] == 0xf0 && this.length > 2) {\r\n      x = parseInt(x);\r\n      if (x >= 0 && x < 128) this[2] = x;\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype.getData = function() {\r\n    if (typeof this.dd != 'undefined') return this.dd.toString();\r\n  };\r\n  MIDI.prototype.setData = function(dd) {\r\n    this.dd = _2s(dd);\r\n    return this;\r\n  };\r\n  function _is_yamaha_smf(ff, dd) { return ff == 0x7f && typeof dd != 'undefined' && dd.charCodeAt(0) == 0x43 && dd.charCodeAt(1) == 0x7b; }\r\n  function _is_yamaha_chord(ff, dd) { return _is_yamaha_smf(ff, dd) && dd.charCodeAt(2) == 1; }\r\n  function _yamaha_chord(a, b) {\r\n    if (a >= 0 && a <= 0x7f && b >= 0 && b <= 0x7f) {\r\n      var c = a & 0xf;\r\n      var d = a >> 4;\r\n      if (c > 0 && c < 8 && d < 7) c = ['C', 'D', 'E', 'F', 'G', 'A', 'B'][c - 1] + ['bbb', 'bb', 'b', '', '#', '##', '###'][d];\r\n      else return '-';\r\n      if (b > 34) return c + '?';\r\n      else return c + [\r\n        '', '6', 'Maj7', 'Maj7(#11)', '(9)', 'Maj7(9)', '6(9)', 'aug', 'm', 'm6', 'm7', 'm7b5',\r\n        'm(9)', 'm7(9)', 'm7(11)', 'm+7', 'm+7(9)', 'dim', 'dim7', '7', '7sus4', '7b5', '7(9)',\r\n        '7(#11)', '7(13)', '7(b9)', '7(b13)', '7(#9)', 'Maj7aug', '7aug', '1+8', '1+5', 'sus4', '1+2+5', 'cc'][b];\r\n    }\r\n    return '-';\r\n  }\r\n  MIDI.prototype.getText = function() {\r\n    if (typeof this.dd != 'undefined') {\r\n      if (_is_yamaha_chord(this.ff, this.dd)) return _yamaha_chord(this.dd.charCodeAt(3), this.dd.charCodeAt(4));\r\n      else return JZZ.lib.fromUTF8(this.dd);\r\n    }\r\n    if (this.isMidiSoft()) {\r\n      var s = [];\r\n      for (var i = 6; i < this.length - 1; i++) s.push(String.fromCharCode(this[i]));\r\n      return s.join('');\r\n    }\r\n  };\r\n  MIDI.prototype.setText = function(dd) {\r\n    this.dd = JZZ.lib.toUTF8(dd);\r\n    return this;\r\n  };\r\n  MIDI.prototype.getTempo = function() {\r\n    if (this.ff == 0x51 && typeof this.dd != 'undefined') {\r\n      return this.dd.charCodeAt(0) * 65536 + this.dd.charCodeAt(1) * 256 + this.dd.charCodeAt(2);\r\n    }\r\n  };\r\n  MIDI.prototype.getBPM = function() {\r\n    var ms = this.getTempo();\r\n    if (ms) return 60000000 / ms;\r\n  };\r\n  MIDI.prototype.getTimeSignature = function() {\r\n    if (this.ff == 0x58 && typeof this.dd != 'undefined') {\r\n       return [this.dd.charCodeAt(0), 1 << this.dd.charCodeAt(1)];\r\n    }\r\n  };\r\n  MIDI.prototype.getKeySignature = function() {\r\n    if (this.ff == 0x59 && typeof this.dd != 'undefined') {\r\n      var sf = this.dd.charCodeAt(0);\r\n      var mi = this.dd.charCodeAt(1);\r\n      if (sf & 0x80) sf = sf - 0x100;\r\n      if (sf >= -7 && sf <= 7 && mi >= 0 && mi <= 1) {\r\n        return [sf,\r\n          ['Cb', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F', 'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#'][mi ? sf + 10 : sf + 7],\r\n          !!mi\r\n        ];\r\n      }\r\n    }\r\n  };\r\n\r\n  MIDI.prototype.isNoteOn = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x90 || c > 0x9f) return false;\r\n    return this[2] > 0 ? true : false;\r\n  };\r\n  MIDI.prototype.isNoteOff = function() {\r\n    var c = this[0];\r\n    if (typeof c == 'undefined' || c < 0x80 || c > 0x9f) return false;\r\n    if (c < 0x90) return true;\r\n    return this[2] == 0 ? true : false;\r\n  };\r\n  MIDI.prototype.isSysEx = function() {\r\n    return this[0] == 0xf0;\r\n  };\r\n  MIDI.prototype.isFullSysEx = function() {\r\n    return this[0] == 0xf0 && this[this.length - 1] == 0xf7;\r\n  };\r\n  MIDI.prototype.isMidiSoft = function() {\r\n    return this.isFullSysEx() && this[1] == 0 && this[2] == 0x20 && this[3] == 0x24 && this[4] == 0;\r\n  };\r\n  MIDI.prototype.isSMF = function() {\r\n    return this.ff >= 0 && this.ff <= 0x7f;\r\n  };\r\n  MIDI.prototype.isEOT = function() {\r\n    return this.ff == 0x2f;\r\n  };\r\n  MIDI.prototype.isTempo = function() {\r\n    return this.ff == 0x51;\r\n  };\r\n  MIDI.prototype.isTimeSignature = function() {\r\n    return this.ff == 0x58;\r\n  };\r\n  MIDI.prototype.isKeySignature = function() {\r\n    return this.ff == 0x59;\r\n  };\r\n  MIDI.prototype.isGmReset = function() {\r\n    return this.match([0xf0, 0x7e, [0, 0], 0x09, [0, 0], 0xf7]);\r\n  };\r\n  MIDI.prototype.isGsReset = function() {\r\n    return this.match([0xf0, 0x41, [0, 0], 0x42, 0x12, 0x40, 0, 0x7f, 0, 0x41, 0xf7]);\r\n  };\r\n  MIDI.prototype.isXgReset = function() {\r\n    return this.match([0xf0, 0x43, [0x10, 0xf0], 0x4c, 0, 0, 0x7e, 0, 0xf7]);\r\n  };\r\n  MIDI.prototype.match = function(a) {\r\n    var i, m;\r\n    for (i = 0; i < a.length; i++) {\r\n      m = a[i][1];\r\n      if (typeof m == 'undefined') {\r\n        if (this[i] != a[i]) return false;\r\n      }\r\n      else {\r\n        if ((this[i] & m) != (a[i][0] & m)) return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  function _s2a(x) {\r\n    var a = [];\r\n    for (var i = 0; i < x.length; i++) {\r\n      a[i] = x.charCodeAt(i);\r\n    }\r\n    return a;\r\n  }\r\n  function _a2s(x) {\r\n    var a = '';\r\n    for (var i = 0; i < x.length; i++) {\r\n      a += String.fromCharCode(x[i]);\r\n    }\r\n    return a;\r\n  }\r\n  function _2s(x) {\r\n    return x instanceof Array ? _a2s(x) : typeof x == 'undefined' ? '' : '' + x;\r\n  }\r\n  function _s2n(x) {\r\n    var n = 0;\r\n    for (var i = 0; i < x.length; i++) n = (n << 8) + x.charCodeAt(i);\r\n    return n;\r\n  }\r\n\r\n  function __hex(x) { return (x < 16 ? '0' : '') + x.toString(16); }\r\n  function _hex(x) {\r\n    var a = [];\r\n    for (var i = 0; i < x.length; i++) {\r\n      a[i] = __hex(x[i]);\r\n    }\r\n    return a.join(' ');\r\n  }\r\n  function _toLine(s) {\r\n    var out = '';\r\n    for (var i = 0; i < s.length; i++) {\r\n      if (s[i] == '\\n') out += '\\\\n';\r\n      else if (s[i] == '\\r') out += '\\\\r';\r\n      else if (s[i] == '\\t') out += '\\\\t';\r\n      else if (s.charCodeAt(i) < 32) out += '\\\\x' + __hex(s.charCodeAt(i));\r\n      else out += s[i];\r\n    }\r\n    return out;\r\n  }\r\n  function _smfhex(dd) {\r\n    return dd.length ? ': ' + _hex(_s2a(dd)) : '';\r\n  }\r\n  function _smftxt(dd) {\r\n    return dd.length ? ': ' + _toLine(JZZ.lib.fromUTF8(dd)) : '';\r\n  }\r\n  MIDI.prototype.label = function(s) {\r\n    this.lbl = this.lbl ? this.lbl + ', ' + s : s;\r\n    return this;\r\n  };\r\n  MIDI.prototype.toString = function() {\r\n    return this.lbl ? this._str() + ' (' + this.lbl + ')' : this._str();\r\n  };\r\n  MIDI.prototype._str = function() {\r\n    var s;\r\n    var ss;\r\n    if (!this.length) {\r\n      if (typeof this.ff != 'undefined') {\r\n        s = 'ff' + __hex(this.ff) + ' -- ';\r\n        if (this.ff == 0) s += 'Sequence Number: ' + _s2n(this.dd);\r\n        else if (this.ff > 0 && this.ff < 10) s += ['', 'Text', 'Copyright', 'Sequence Name', 'Instrument Name', 'Lyric', 'Marker', 'Cue Point', 'Program Name', 'Device Name'][this.ff] + _smftxt(this.dd);\r\n        else if (this.ff == 32) s += 'Channel Prefix' + _smfhex(this.dd);\r\n        else if (this.ff == 33) s += 'MIDI Port' + _smfhex(this.dd);\r\n        else if (this.ff == 47) s += 'End of Track' + _smfhex(this.dd);\r\n        else if (this.ff == 81) {\r\n          var bpm = Math.round(this.getBPM() * 100) / 100;\r\n          s += 'Tempo: ' + bpm + ' bpm';\r\n        }\r\n        else if (this.ff == 84) s += 'SMPTE Offset: ' + _smptetxt(_s2a(this.dd));\r\n        else if (this.ff == 88) {\r\n          var d = 1 << this.dd.charCodeAt(1);\r\n          s += 'Time Signature: ' + this.dd.charCodeAt(0) + '/' + d;\r\n          s += ' ' + this.dd.charCodeAt(2) + ' ' + this.dd.charCodeAt(3);\r\n        }\r\n        else if (this.ff == 89) {\r\n          s += 'Key Signature: ';\r\n          var ks = this.getKeySignature();\r\n          if (ks) {\r\n            s += ks[1];\r\n            if (ks[2]) s += ' min';\r\n          }\r\n          else s+= 'invalid';\r\n        }\r\n        else if (this.ff == 127) {\r\n          if (this.dd.charCodeAt(0) == 0x43) {\r\n            if (this.dd.charCodeAt(1) == 0x7b) {\r\n              s += '[XF:' + __hex(this.dd.charCodeAt(2)) + ']';\r\n              ss = { 0: 'Version', 1: 'Chord', 2: 'Rehearsal Mark', 3: 'Phrase Mark', 4: 'Max Phrase Mark',\r\n                5: 'Fingering Number', 12: 'Guide Track Flag', 16: 'Guitar Info', 18: 'Chord Voicing',\r\n                127: 'XG Song Data Number' }[this.dd.charCodeAt(2)];\r\n              s += ss ? ' ' + ss : '';\r\n              s += ': ';\r\n              if (this.dd.charCodeAt(2) == 0) {\r\n                return s + this.dd.substr(3, 4) + ' ' + _hex(_s2a(this.dd.substr(7)));\r\n              }\r\n              if (this.dd.charCodeAt(2) == 1) {\r\n                return s + this.getText();\r\n              }\r\n              return s + _hex(_s2a(this.dd.substr(3)));\r\n            }\r\n          }\r\n          s += 'Sequencer Specific' + _smfhex(this.dd);\r\n        }\r\n        else s += 'SMF' + _smfhex(this.dd);\r\n        return s;\r\n      }\r\n      return 'empty';\r\n    }\r\n    s = _hex(this);\r\n    if (this[0] < 0x80) return s;\r\n    ss = {\r\n      241: 'MIDI Time Code',\r\n      242: 'Song Position',\r\n      243: 'Song Select',\r\n      244: 'Undefined',\r\n      245: 'Undefined',\r\n      246: 'Tune request',\r\n      248: 'Timing clock',\r\n      249: 'Undefined',\r\n      250: 'Start',\r\n      251: 'Continue',\r\n      252: 'Stop',\r\n      253: 'Undefined',\r\n      254: 'Active Sensing',\r\n      255: 'Reset'\r\n    }[this[0]];\r\n    if (ss) return s + ' -- ' + ss;\r\n    if (this.isMidiSoft()) {\r\n      ss = _toLine(this.getText());\r\n      if (ss) ss = ' ' + ss;\r\n      return s + ' -- [K:' + __hex(this[5]) + ']' + ss;\r\n    }\r\n    var c = this[0] >> 4;\r\n    ss = {8: 'Note Off', 10: 'Aftertouch', 12: 'Program Change', 13: 'Channel Aftertouch', 14: 'Pitch Wheel'}[c];\r\n    if (ss) return s + ' -- ' + ss;\r\n    if (c == 9) return s + ' -- ' + (this[2] ? 'Note On' : 'Note Off');\r\n    if (c != 11) return s;\r\n    ss = {\r\n      0: 'Bank Select MSB',\r\n      1: 'Modulation Wheel MSB',\r\n      2: 'Breath Controller MSB',\r\n      4: 'Foot Controller MSB',\r\n      5: 'Portamento Time MSB',\r\n      6: 'Data Entry MSB',\r\n      7: 'Channel Volume MSB',\r\n      8: 'Balance MSB',\r\n      10: 'Pan MSB',\r\n      11: 'Expression Controller MSB',\r\n      12: 'Effect Control 1 MSB',\r\n      13: 'Effect Control 2 MSB',\r\n      16: 'General Purpose Controller 1 MSB',\r\n      17: 'General Purpose Controller 2 MSB',\r\n      18: 'General Purpose Controller 3 MSB',\r\n      19: 'General Purpose Controller 4 MSB',\r\n      31: 'Karaoke',\r\n      32: 'Bank Select LSB',\r\n      33: 'Modulation Wheel LSB',\r\n      34: 'Breath Controller LSB',\r\n      36: 'Foot Controller LSB',\r\n      37: 'Portamento Time LSB',\r\n      38: 'Data Entry LSB',\r\n      39: 'Channel Volume LSB',\r\n      40: 'Balance LSB',\r\n      42: 'Pan LSB',\r\n      43: 'Expression Controller LSB',\r\n      44: 'Effect control 1 LSB',\r\n      45: 'Effect control 2 LSB',\r\n      48: 'General Purpose Controller 1 LSB',\r\n      49: 'General Purpose Controller 2 LSB',\r\n      50: 'General Purpose Controller 3 LSB',\r\n      51: 'General Purpose Controller 4 LSB',\r\n      64: 'Damper Pedal',\r\n      65: 'Portamento',\r\n      66: 'Sostenuto',\r\n      67: 'Soft Pedal',\r\n      68: 'Legato',\r\n      69: 'Hold 2',\r\n      70: 'Sound Variation',\r\n      71: 'Filter Resonance',\r\n      72: 'Release Time',\r\n      73: 'Attack Time',\r\n      74: 'Brightness',\r\n      75: 'Decay Time',\r\n      76: 'Vibrato Rate',\r\n      77: 'Vibrato Depth',\r\n      78: 'Vibrato Delay',\r\n      79: 'Sound Controller 10',\r\n      80: 'General Purpose Controller 5',\r\n      81: 'General Purpose Controller 6',\r\n      82: 'General Purpose Controller 7',\r\n      83: 'General Purpose Controller 8',\r\n      84: 'Portamento Control',\r\n      88: 'High Resolution Velocity Prefix',\r\n      91: 'Effects 1 Depth',\r\n      92: 'Effects 2 Depth',\r\n      93: 'Effects 3 Depth',\r\n      94: 'Effects 4 Depth',\r\n      95: 'Effects 5 Depth',\r\n      96: 'Data Increment',\r\n      97: 'Data Decrement',\r\n      98: 'Non-Registered Parameter Number LSB',\r\n      99: 'Non-Registered Parameter Number MSB',\r\n      100: 'Registered Parameter Number LSB',\r\n      101: 'Registered Parameter Number MSB',\r\n      120: 'All Sound Off',\r\n      121: 'Reset All Controllers',\r\n      122: 'Local Control On/Off',\r\n      123: 'All Notes Off',\r\n      124: 'Omni Mode Off',\r\n      125: 'Omni Mode On',\r\n      126: 'Mono Mode On',\r\n      127: 'Poly Mode On'\r\n    }[this[1]];\r\n    if (this[1] >= 64 && this[1] <= 69) ss += this[2] < 64 ? ' Off' : ' On';\r\n    if (!ss) ss = 'Undefined';\r\n    return s + ' -- ' + ss;\r\n  };\r\n  MIDI.prototype._stamp = function(obj) { this._from.push(obj._orig ? obj._orig : obj); return this; };\r\n  MIDI.prototype._unstamp = function(obj) {\r\n    if (typeof obj == 'undefined') this._from = [];\r\n    else {\r\n      if (obj._orig) obj = obj._orig;\r\n      var i = this._from.indexOf(obj);\r\n      if (i > -1) this._from.splice(i, 1);\r\n    }\r\n    return this;\r\n  };\r\n  MIDI.prototype._stamped = function(obj) {\r\n    if (obj._orig) obj = obj._orig;\r\n    for (var i = 0; i < this._from.length; i++) if (this._from[i] == obj) return true;\r\n    return false;\r\n  };\r\n\r\n  JZZ.MIDI = MIDI;\r\n  _J.prototype.MIDI = MIDI;\r\n\r\n  function _clear_ctxt() {\r\n    var i;\r\n    this._cc = [];\r\n    for (i = 0; i < 16; i++) this._cc[i] = {};\r\n  }\r\n  function _rpn_txt(msb, lsb) {\r\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\r\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\r\n    var c = {\r\n      '0000': 'Pitch Bend Sensitivity',\r\n      '0001': 'Channel Fine Tune',\r\n      '0002': 'Channel Coarse Tune',\r\n      '0003': 'Select Tuning Program',\r\n      '0004': 'Select Tuning Bank',\r\n      '0005': 'Vibrato Depth Range',\r\n      '7f7f': 'NONE'\r\n    }[a + '' + b];\r\n    return 'RPN ' + a + ' ' + b + (c ? ': ' + c : '');\r\n  }\r\n  function _nrpn_txt(msb, lsb) {\r\n    var a = typeof msb == 'undefined' ? '??' : __hex(msb);\r\n    var b = typeof lsb == 'undefined' ? '??' : __hex(lsb);\r\n    return 'NRPN ' + a + ' ' + b;\r\n  }\r\n  function _read_ctxt(msg) {\r\n    if (!msg.length || msg[0] < 0x80) return msg;\r\n    if (msg[0] == 0xff) { this._clear(); return msg; }\r\n    var ch = msg[0] & 15;\r\n    var st = msg[0] >> 4;\r\n    var s;\r\n    if (st == 12) {\r\n      msg._bm = this._cc[ch].bm;\r\n      msg._bl = this._cc[ch].bl;\r\n      if (JZZ.MIDI.programName) msg.label(JZZ.MIDI.programName(msg[1], msg._bm, msg._bl));\r\n    }\r\n    else if (st == 11) {\r\n      switch (msg[1]) {\r\n        case 0: this._cc[ch].bm = msg[2]; break;\r\n        case 32: this._cc[ch].bl = msg[2]; break;\r\n        case 98: this._cc[ch].nl = msg[2]; this._cc[ch].rn = 'n'; break;\r\n        case 99: this._cc[ch].nm = msg[2]; this._cc[ch].rn = 'n'; break;\r\n        case 100: this._cc[ch].rl = msg[2]; this._cc[ch].rn = 'r'; break;\r\n        case 101: this._cc[ch].rm = msg[2]; this._cc[ch].rn = 'r'; break;\r\n        case 6: case 38: case 96: case 97:\r\n          if (this._cc[ch].rn == 'r') {\r\n            msg._rm = this._cc[ch].rm;\r\n            msg._rl = this._cc[ch].rl;\r\n            msg.label(_rpn_txt(this._cc[ch].rm, this._cc[ch].rl));\r\n          }\r\n          if (this._cc[ch].rn == 'n') {\r\n            msg._nm = this._cc[ch].rm;\r\n            msg._nl = this._cc[ch].nl;\r\n            msg.label(_nrpn_txt(this._cc[ch].nm, this._cc[ch].nl));\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    else if (msg.isFullSysEx()) {\r\n      if (msg[1] == 0x7f) {\r\n        if (msg[3] == 4) {\r\n          s = { 1: 'Master Volume', 2: 'Master Balance', 3: 'Master Fine Tuning', 4: 'Master Coarse Tuning' }[msg[4]];\r\n          if (s) msg.label(s);\r\n        }\r\n        else if (msg[3] == 8) {\r\n          s = { 2: 'Note Tuning', 7: 'Note Tuning, Bank', 8: 'Scale Tuning, 1 byte format', 9: 'Scale Tuning, 2 byte format' }[msg[4]];\r\n          if (s) msg.label(s);\r\n        }\r\n      }\r\n      else if (msg[1] == 0x7e) {\r\n        if (msg[3] == 6) {\r\n          if (msg[4] == 1) msg.label('Device ID Request');\r\n          else if (msg[4] == 2) {\r\n            msg.label('Device ID Response');\r\n          }\r\n        }\r\n        else if (msg[3] == 8) {\r\n          s = {\r\n            0: 'Bulk Tuning Dump Request', 1: 'Bulk Tuning Dump', 3: 'Bulk Tuning Dump Request, Bank', 4: 'Bulk Tuning Dump, Bank',\r\n            5: 'Scale Tuning Dump, 1 byte format', 6: 'Scale Tuning Dump, 2 byte format',\r\n            7: 'Note Tuning, Bank', 8: 'Scale Tuning, 1 byte format', 9: 'Scale Tuning, 2 byte format'\r\n          }[msg[4]];\r\n          if (s) msg.label(s);\r\n        }\r\n        else if (msg[3] == 9) {\r\n          if (msg[4] == 1) { msg.label('GM1 System On'); this._clear(); this._gm = '1'; }\r\n          else if (msg[4] == 2) { msg.label('GM System Off'); this._clear(); this._gm = '0'; }\r\n          else if (msg[4] == 3) { msg.label('GM2 System On'); this._clear(); this._gm = '2'; }\r\n        }\r\n      }\r\n      else if (msg[1] == 0x43) {\r\n        if ((msg[2] & 0xf0) == 0x10 && msg[3] == 0x4c) {\r\n          if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0x7e && msg[7] == 0) {\r\n            msg.label('XG System On'); this._clear(); this._gm = 'Y';\r\n          }\r\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 0) msg.label('XG Master Tuning');\r\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 4) msg.label('XG Master Volume');\r\n          else if (msg[4] == 0 && msg[5] == 0 && msg[6] == 6) msg.label('XG Master Transpose');\r\n          else if (msg[4] == 8 && msg[5] < 16 && msg[6] >= 0x41 && msg[6] <= 0x4c) msg.label('XG Scale Tuning');\r\n          else  msg.label('XG Parameter');\r\n        }\r\n      }\r\n      else if (msg[1] == 0x41) {\r\n        if (msg[3] == 0x42 && msg[4] == 0x12) {\r\n          if (msg[5] == 0x40) {\r\n            if (msg[6] == 0) {\r\n              if (msg[7] == 0x7f && msg[8] == 0 && msg[9] == 0x41) {\r\n                msg.label('GS Reset'); this._clear(); this._gm = 'R';\r\n              }\r\n              else if (msg[7] == 0) msg.label('GS Master Tuning');\r\n              else if (msg[7] == 4) msg.label('GS Master Volume');\r\n              else if (msg[7] == 5) msg.label('GS Master Transpose');\r\n              else msg.label('GS Parameter');\r\n            }\r\n            else if ((msg[6] & 0xf0) == 0x10 && msg[7] == 0x15) msg.label('GS Drum Part Change');\r\n            else if ((msg[6] & 0xf0) == 0x10 && msg[7] >= 0x40 && msg[7] <= 0x4b) msg.label('GS Scale Tuning');\r\n            else msg.label('GS Parameter');\r\n          }\r\n          if (msg[5] == 0x41) msg.label('GS Parameter');\r\n        }\r\n      }\r\n    }\r\n    return msg;\r\n  }\r\n  function Context() {\r\n    var self = new _M();\r\n    self._clear = _clear_ctxt;\r\n    self._read = _read_ctxt;\r\n    self._receive = function(msg) { this._emit(this._read(msg)); };\r\n    self._clear();\r\n    self._resume();\r\n    return self;\r\n  }\r\n  JZZ.Context = Context;\r\n  _J.prototype.Context = Context;\r\n\r\n  function MPE() {\r\n    var self = this instanceof MPE ? this : self = new MPE();\r\n    self.reset();\r\n    if (arguments.length) MPE.prototype.setup.apply(self, arguments);\r\n    return self;\r\n  }\r\n  MPE.validate = function(arg) {\r\n    var a = arg instanceof Array ? arg : arguments;\r\n    if (a[0] != parseInt(a[0]) || a[0] < 0 || a[0] > 14) throw RangeError('Bad master channel value: ' + a[0]);\r\n    if (a[1] != parseInt(a[1]) || a[1] < 0 || a[0] + a[1] > 15) throw RangeError('Bad zone size value: ' + a[1]);\r\n  };\r\n  MPE.prototype.reset = function() { for (var n = 0; n < 16; n++) this[n] = { band: 0, master: n }; };\r\n  MPE.prototype.setup = function(m, n) {\r\n    MPE.validate(m, n);\r\n    var k;\r\n    var last = m + n;\r\n    if (this[m].master == m && this[m].band == n) return;\r\n    if (!n && !this[m].band) return;\r\n    if (this[m].band) {\r\n      k = m + this[m].band;\r\n      if (last < k) last = k;\r\n    }\r\n    else if (this[m].master == m - 1) {\r\n      k = m - 1;\r\n      k = k + this[k].band;\r\n      if (last < k) last = k;\r\n      this[m - 1] = { band: 0, master: m - 1 };\r\n    }\r\n    else if (this[m].master != m) {\r\n      k = this[m].master;\r\n      k = k + this[k].band;\r\n      if (last < k) last = k;\r\n      this[this[m].master].band = m - this[m].master - 1;\r\n    }\r\n    this[m].master = m;\r\n    this[m].band = n;\r\n    for (k = m + 1; k <= m + n; k++) {\r\n      if (this[k].band && last < k + this[k].band) last = k + this[k].band;\r\n      this[k] = { band: 0, master: m };\r\n    }\r\n    for (; k <= last; k++) this[k] = { band: 0, master: k };\r\n  };\r\n  MPE.prototype.filter = function(msg) {\r\n    var c = msg.getChannel();\r\n    if (!this[c] || !this[this[c].master].band) return msg;\r\n    var m = this[c].master;\r\n    var n = this[m].band;\r\n    var i, j, k;\r\n    if (typeof msg._mpe != 'undefined') {\r\n      k = 256;\r\n      for (i = m + 1; i <= m + n; i++) {\r\n        if (!this[i].notes) {\r\n          if (k > 0) { c = i; k = 0; }\r\n        }\r\n        else {\r\n          if (k > this[i].notes.length) { c = i; k = this[i].notes.length; }\r\n          for (j = 0; j < this[i].notes.length; j++) {\r\n            if (this[i].notes[j] == msg._mpe) { c = i; k = -1; break; }\r\n          }\r\n        }\r\n      }\r\n      msg.setChannel(c);\r\n      msg._mpe = undefined;\r\n    }\r\n    if (c == m) return msg; // bad mpe\r\n    if (msg.isNoteOn()) {\r\n      if (!this[c].notes) this[c].notes = [];\r\n      _push(this[c].notes, msg.getNote());\r\n    }\r\n    else if (msg.isNoteOff()) {\r\n      if (this[c].notes) _pop(this[c].notes, msg.getNote());\r\n    }\r\n    return msg;\r\n  };\r\n  JZZ.MPE = MPE;\r\n\r\n  JZZ.lib = {};\r\n  JZZ.lib.now = _now;\r\n  JZZ.lib.schedule = _schedule;\r\n  JZZ.lib.openMidiOut = function(name, engine) {\r\n    var port = new _M();\r\n    engine._openOut(port);\r\n    port._info = engine._info(name);\r\n    return port;\r\n  };\r\n  JZZ.lib.openMidiIn = function(name, engine) {\r\n    var port = new _M();\r\n    engine._openIn(port);\r\n    port._info = engine._info(name);\r\n    return port;\r\n  };\r\n  JZZ.lib.registerMidiOut = function(name, engine) {\r\n    var x = engine._info(name);\r\n    for (var i = 0; i < _virtual._outs.length; i++) if (_virtual._outs[i].name == x.name) return false;\r\n    x.engine = engine;\r\n    _virtual._outs.push(x);\r\n    if (_jzz) {\r\n      _postRefresh();\r\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\r\n    }\r\n    return true;\r\n  };\r\n  JZZ.lib.registerMidiIn = function(name, engine) {\r\n    var x = engine._info(name);\r\n    for (var i = 0; i < _virtual._ins.length; i++) if (_virtual._ins[i].name == x.name) return false;\r\n    x.engine = engine;\r\n    _virtual._ins.push(x);\r\n    if (_jzz) {\r\n      _postRefresh();\r\n      if (_jzz._bad) { _jzz._repair(); _jzz._resume(); }\r\n    }\r\n    return true;\r\n  };\r\n  var _ac;\r\n  function _initAudioContext() {\r\n    if (!_ac && typeof window !== 'undefined') {\r\n      var AudioContext = window.AudioContext || window.webkitAudioContext;\r\n      if (AudioContext) {\r\n        _ac = new AudioContext();\r\n        if (_ac && !_ac.createGain) _ac.createGain = _ac.createGainNode;\r\n        var _activateAudioContext = function() {\r\n          if (_ac.state != 'running') {\r\n            _ac.resume();\r\n            var osc = _ac.createOscillator();\r\n            var gain = _ac.createGain();\r\n            try { gain.gain.value = 0; } catch (err) {}\r\n            gain.gain.setTargetAtTime(0, _ac.currentTime, 0.01);\r\n            osc.connect(gain);\r\n            gain.connect(_ac.destination);\r\n            if (!osc.start) osc.start = osc.noteOn;\r\n            if (!osc.stop) osc.stop = osc.noteOff;\r\n            osc.start(0.1); osc.stop(0.11);\r\n          }\r\n          else {\r\n            document.removeEventListener('touchstart', _activateAudioContext);\r\n            document.removeEventListener('touchend', _activateAudioContext);\r\n            document.removeEventListener('mousedown', _activateAudioContext);\r\n            document.removeEventListener('keydown', _activateAudioContext);\r\n          }\r\n        };\r\n        if (typeof document != 'undefined') {\r\n          document.addEventListener('touchstart', _activateAudioContext);\r\n          document.addEventListener('touchend', _activateAudioContext);\r\n          document.addEventListener('mousedown', _activateAudioContext);\r\n          document.addEventListener('keydown', _activateAudioContext);\r\n          _activateAudioContext();\r\n        }\r\n      }\r\n    }\r\n  }\r\n  JZZ.lib.copyMidiHelpers = _copyMidiHelpers;\r\n  JZZ.lib.getAudioContext = function() { _initAudioContext(); return _ac; };\r\n  var _b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\r\n  JZZ.lib.fromBase64 = function(input) {\r\n    var output = '';\r\n    var chr1, chr2, chr3;\r\n    var enc1, enc2, enc3, enc4;\r\n    var i = 0;\r\n    input = input.replace(/[^A-Za-z0-9+/=]/g, '');\r\n    while (i < input.length) {\r\n      enc1 = _b64.indexOf(input.charAt(i++));\r\n      enc2 = _b64.indexOf(input.charAt(i++));\r\n      enc3 = _b64.indexOf(input.charAt(i++));\r\n      enc4 = _b64.indexOf(input.charAt(i++));\r\n      chr1 = (enc1 << 2) | (enc2 >> 4);\r\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n      chr3 = ((enc3 & 3) << 6) | enc4;\r\n      output = output + String.fromCharCode(chr1);\r\n      if (enc3 != 64) {\r\n        output = output + String.fromCharCode(chr2);\r\n      }\r\n      if (enc4 != 64) {\r\n        output = output + String.fromCharCode(chr3);\r\n      }\r\n    }\r\n    return output;\r\n  };\r\n  JZZ.lib.toBase64 = function(data) {\r\n    var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc = '', arr = [];\r\n    if (!data) return data;\r\n    do {\r\n      o1 = data.charCodeAt(i++);\r\n      o2 = data.charCodeAt(i++);\r\n      o3 = data.charCodeAt(i++);\r\n      bits = o1 << 16 | o2 << 8 | o3;\r\n      h1 = bits >> 18 & 0x3f;\r\n      h2 = bits >> 12 & 0x3f;\r\n      h3 = bits >> 6 & 0x3f;\r\n      h4 = bits & 0x3f;\r\n      arr[ac++] = _b64.charAt(h1) + _b64.charAt(h2) + _b64.charAt(h3) + _b64.charAt(h4);\r\n    } while(i < data.length);\r\n    enc = arr.join('');\r\n    var r = data.length % 3;\r\n    return (r ? enc.slice(0, r - 3) + '==='.slice(r) : enc);\r\n  };\r\n  JZZ.lib.fromUTF8 = function(data) {\r\n    data = typeof data == 'undefined' ? '' : '' + data;\r\n    var out = '';\r\n    var i, n, m;\r\n    for (i = 0; i < data.length; i++) {\r\n      n = data.charCodeAt(i);\r\n      if (n > 0xff) return data;\r\n      if (n < 0x80) out += data[i];\r\n      else if ((n & 0xe0) == 0xc0) {\r\n        n = (n & 0x1f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        out += String.fromCharCode(n);\r\n      }\r\n      else if ((n & 0xf0) == 0xe0) {\r\n        n = (n & 0x0f) << 12;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        out += String.fromCharCode(n);\r\n      }\r\n      else if ((n & 0xf8) == 0xf0) {\r\n        n = (n & 0x07) << 18;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 12;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f) << 6;\r\n        i++; if (i >= data.length) return data;\r\n        m = data.charCodeAt(i);\r\n        if ((m & 0xc0) != 0x80) return data;\r\n        n += (m & 0x3f);\r\n        if (n > 0x10ffff) return data;\r\n        n -= 0x10000;\r\n        out += String.fromCharCode(0xd800 + (n >> 10));\r\n        out += String.fromCharCode(0xdc00 + (n & 0x3ff));\r\n      }\r\n    }\r\n    return out;\r\n  };\r\n  JZZ.lib.toUTF8 = function(data) {\r\n    data = typeof data == 'undefined' ? '' : '' + data;\r\n    var out = '';\r\n    var i, n;\r\n    for (i = 0; i < data.length; i++) {\r\n      n = data.charCodeAt(i);\r\n      if (n < 0x80) out += data[i];\r\n      else if (n < 0x800) {\r\n        out += String.fromCharCode(0xc0 + (n >> 6));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n      else if (n < 0x10000) {\r\n        out += String.fromCharCode(0xe0 + (n >> 12));\r\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n      /* istanbul ignore next */\r\n      else {\r\n        out += String.fromCharCode(0xf0 + (n >> 18));\r\n        out += String.fromCharCode(0x80 + ((n >> 12) & 0x3f));\r\n        out += String.fromCharCode(0x80 + ((n >> 6) & 0x3f));\r\n        out += String.fromCharCode(0x80 + (n & 0x3f));\r\n      }\r\n    }\r\n    return out;\r\n  };\r\n\r\n  // Web MIDI API\r\n  var _wma = [];\r\n  var _outputMap = {};\r\n  var _inputMap = {};\r\n\r\n  var Promise = _scope.Promise;\r\n  /* istanbul ignore next */\r\n  if (typeof Promise !== 'function') {\r\n    Promise = function(executor) {\r\n      this.executor = executor;\r\n    };\r\n    Promise.prototype.then = function(resolve, reject) {\r\n      if (typeof resolve !== 'function') {\r\n        resolve = _nop;\r\n      }\r\n      if (typeof reject !== 'function') {\r\n        reject = _nop;\r\n      }\r\n      this.executor(resolve, reject);\r\n    };\r\n  }\r\n  function DOMException(name, message, code) {\r\n    this.name = name;\r\n    this.message = message;\r\n    this.code = code;\r\n  }\r\n\r\n  function MIDIConnectionEvent(port, target) {\r\n    this.bubbles = false;\r\n    this.cancelBubble = false;\r\n    this.cancelable = false;\r\n    this.currentTarget = target;\r\n    this.defaultPrevented = false;\r\n    this.eventPhase = 0;\r\n    this.path = [];\r\n    this.port = port;\r\n    this.returnValue = true;\r\n    this.srcElement = target;\r\n    this.target = target;\r\n    this.timeStamp = _now();\r\n    this.type = 'statechange';\r\n  }\r\n\r\n  function MIDIMessageEvent(port, data) {\r\n    this.bubbles = false;\r\n    this.cancelBubble = false;\r\n    this.cancelable = false;\r\n    this.currentTarget = port;\r\n    this.data = data;\r\n    this.defaultPrevented = false;\r\n    this.eventPhase = 0;\r\n    this.path = [];\r\n    this.receivedTime = _now();\r\n    this.returnValue = true;\r\n    this.srcElement = port;\r\n    this.target = port;\r\n    this.timeStamp = this.receivedTime;\r\n    this.type = 'midimessage';\r\n  }\r\n\r\n  function _statechange(p, a) {\r\n    if (p) {\r\n      if (p.onstatechange) p.onstatechange(new MIDIConnectionEvent(p, p));\r\n      if (a.onstatechange) a.onstatechange(new MIDIConnectionEvent(p, a));\r\n    }\r\n  }\r\n\r\n  function MIDIInput(a, p) {\r\n    var self = this;\r\n    var _open = false;\r\n    var _ochng = null;\r\n    var _onmsg = null;\r\n    this.type = 'input';\r\n    this.id = p.id;\r\n    this.name = p.name;\r\n    this.manufacturer = p.man;\r\n    this.version = p.ver;\r\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\r\n    Object.defineProperty(this, 'connection', { get: function() {\r\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\r\n    }, enumerable: true });\r\n    Object.defineProperty(this, 'onmidimessage', {\r\n      get: function() { return _onmsg; },\r\n      set: function(value) {\r\n        if (_func(value)) {\r\n          _onmsg = value;\r\n          if (!_open) self.open().then(_nop, _nop);\r\n        }\r\n        else _onmsg = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _ochng; },\r\n      set: function(value) {\r\n        if (_func(value)) _ochng = value;\r\n        else _ochng = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    this.open = function() {\r\n      return new Promise(function(resolve, reject) {\r\n        if (_open) resolve(self);\r\n        else {\r\n          p.open().then(function() {\r\n            if (!_open) {\r\n              _open = true;\r\n              _statechange(self, a);\r\n            }\r\n            resolve(self);\r\n          }, function() {\r\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\r\n          });\r\n        }\r\n      });\r\n    };\r\n    this.close = function() {\r\n      return new Promise(function(resolve/*, reject*/) {\r\n        if (_open) {\r\n          _open = false;\r\n          p.close();\r\n          _statechange(self, a);\r\n        }\r\n        resolve(self);\r\n      });\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n\r\n  function _split(q) {\r\n    var i, k;\r\n    while (q.length) {\r\n      for (i = 0; i < q.length; i++) if (q[i] == parseInt(q[i]) && q[i] >= 0x80 && q[i] <= 0xff && q[i] != 0xf7) break;\r\n      q.splice(0, i);\r\n      if (!q.length) return;\r\n      if (q[0] == 0xf0) {\r\n        for (i = 1; i < q.length; i++) if (q[i] == 0xf7) break;\r\n        if (i == q.length) return;\r\n        return q.splice(0, i + 1);\r\n      }\r\n      else {\r\n        k = _datalen(q[0]) + 1;\r\n        if (k > q.length) return;\r\n        for (i = 1; i < k; i++) if (q[i] != parseInt(q[i]) || q[i] < 0 || q[i] >= 0x80) break;\r\n        if (i == k) return q.splice(0, i);\r\n        else q.splice(0, i);\r\n      }\r\n    }\r\n  }\r\n\r\n  function _InputProxy(id, name, man, ver) {\r\n    var self = this;\r\n    this.id = id;\r\n    this.name = name;\r\n    this.man = man;\r\n    this.ver = ver;\r\n    this.connected = true;\r\n    this.ports = [];\r\n    this.pending = [];\r\n    this.proxy = undefined;\r\n    this.queue = [];\r\n    this.onmidi = function(msg) {\r\n      var m;\r\n      self.queue = self.queue.concat(msg.slice());\r\n      for (m = _split(self.queue); m; m = _split(self.queue)) {\r\n        for (i = 0; i < self.ports.length; i++) {\r\n          if (self.ports[i][0].onmidimessage && (m[0] != 0xf0 || self.ports[i][1])) {\r\n            self.ports[i][0].onmidimessage(new MIDIMessageEvent(self, new Uint8Array(m)));\r\n          }\r\n        }\r\n      }\r\n    };\r\n  }\r\n  _InputProxy.prototype.open = function() {\r\n    var self = this;\r\n    return new Promise(function(resolve, reject) {\r\n      var i;\r\n      if (self.proxy || !self.connected) resolve();\r\n      else {\r\n        self.pending.push([resolve, reject]);\r\n        if (self.pending.length == 1) {\r\n          JZZ().openMidiIn(self.name).or(function() {\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\r\n            self.pending = [];\r\n          }).and(function() {\r\n            self.proxy = this;\r\n            self.proxy.connect(self.onmidi);\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\r\n            self.pending = [];\r\n          });\r\n        }\r\n      }\r\n    });\r\n  };\r\n  _InputProxy.prototype.close = function() {\r\n    var i;\r\n    if (this.proxy) {\r\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _InputProxy.prototype.disconnect = function() {\r\n    this.connected = false;\r\n    if (this.proxy) {\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _InputProxy.prototype.reconnect = function() {\r\n    var self = this;\r\n    var i, p;\r\n    var a = [];\r\n    this.connected = true;\r\n    for (i = 0; i < _wma.length; i++) {\r\n      p = _wma[i].inputs.get(this.id);\r\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\r\n      else a.push([p, _wma[i]]);\r\n    }\r\n    if (a.length) {\r\n      JZZ()._openMidiInNR(self.name).or(function() {\r\n        for (i = 0; i < a.length; i++) a[i][0].close();\r\n      }).and(function() {\r\n        self.proxy = this;\r\n        self.proxy.connect(self.onmidi);\r\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\r\n      });\r\n    }\r\n  };\r\n\r\n  function _datalen(x) {\r\n    if (x >= 0x80 && x <= 0xbf || x >= 0xe0 && x <= 0xef || x == 0xf2) return 2;\r\n    if (x >= 0xc0 && x <= 0xdf || x == 0xf1 || x == 0xf3) return 1;\r\n    return 0;\r\n  }\r\n\r\n  var _epr = \"Failed to execute 'send' on 'MIDIOutput': \";\r\n\r\n  function _validate(arr, sysex) {\r\n    var i, k;\r\n    var msg;\r\n    var data = [];\r\n    for (i = 0; i < arr.length; i++) {\r\n      if (arr[i] != parseInt(arr[i]) || arr[i] < 0 || arr[i] > 255) throw TypeError(_epr + arr[i] + ' is not a UInt8 value.');\r\n    }\r\n    k = 0;\r\n    for (i = 0; i < arr.length; i++) {\r\n      if (!k) {\r\n        if (arr[i] < 0x80) throw TypeError(_epr + 'Running status is not allowed at index ' + i + ' (' + arr[i] + ').');\r\n        if (arr[i] == 0xf7) throw TypeError(_epr + 'Unexpected end of system exclusive message at index ' + i + ' (' + arr[i] + ').');\r\n        msg = [arr[i]];\r\n        data.push(msg);\r\n        if (arr[i] == 0xf0) {\r\n          if (!sysex) throw new DOMException('InvalidAccessError', _epr + 'System exclusive messag is not allowed at index ' + i + ' (' + arr[i] + ').', 15);\r\n          k = -1;\r\n          for (; i < arr.length; i++) {\r\n            msg.push(arr[i]);\r\n            if (arr[i] == 0xf7) {\r\n              k = 0;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          k = _datalen(arr[i]);\r\n        }\r\n      }\r\n      else {\r\n        if (arr[i] > 0x7f) throw TypeError(_epr + 'Unexpected status byte at index ' + i + ' (' + arr[i] + ').');\r\n        msg.push(arr[i]);\r\n        k--;\r\n      }\r\n    }\r\n    if (k) throw TypeError(_epr + 'Message is incomplete');\r\n    return [data];\r\n  }\r\n\r\n  function MIDIOutput(a, p) {\r\n    var self = this;\r\n    var _open = false;\r\n    var _ochng = null;\r\n    this.type = 'output';\r\n    this.id = p.id;\r\n    this.name = p.name;\r\n    this.manufacturer = p.man;\r\n    this.version = p.ver;\r\n    Object.defineProperty(this, 'state', { get: function() { return p.connected ? 'connected' : 'disconnected'; }, enumerable: true });\r\n    Object.defineProperty(this, 'connection', { get: function() {\r\n      return _open ? p.proxy ? 'open' : 'pending' : 'closed';\r\n    }, enumerable: true });\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _ochng; },\r\n      set: function(value) {\r\n        if (_func(value)) _ochng = value;\r\n        else _ochng = null;\r\n      },\r\n      enumerable: true\r\n    });\r\n    this.open = function() {\r\n      return new Promise(function(resolve, reject) {\r\n        if (_open) resolve(self);\r\n        else {\r\n          p.open().then(function() {\r\n            if (!_open) {\r\n              _open = true;\r\n              _statechange(self, a);\r\n            }\r\n            resolve(self);\r\n          }, function() {\r\n            reject(new DOMException('InvalidAccessError', 'Port is not available', 15));\r\n          });\r\n        }\r\n      });\r\n    };\r\n    this.close = function() {\r\n      return new Promise(function(resolve/*, reject*/) {\r\n        if (_open) {\r\n          _open = false;\r\n          self.clear();\r\n          p.close();\r\n          _statechange(self, a);\r\n        }\r\n        resolve(self);\r\n      });\r\n    };\r\n    this.clear = function() {\r\n    };\r\n    this.send = function(data, timestamp) {\r\n      _validate(data, a.sysexEnabled);\r\n      if (!p.connected) throw new DOMException('InvalidStateError', 'Port is not connected', 11);\r\n      if (_open) {\r\n        var now = _now();\r\n        if (timestamp > now) setTimeout(function() { p.proxy.send(data); }, timestamp - now);\r\n        else p.proxy.send(data);\r\n      }\r\n      else this.open().then(function() { self.send(data, timestamp); }, _nop);\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n\r\n  function _OutputProxy(id, name, man, ver) {\r\n    this.id = id;\r\n    this.name = name;\r\n    this.man = man;\r\n    this.ver = ver;\r\n    this.connected = true;\r\n    this.ports = [];\r\n    this.pending = [];\r\n    this.proxy = undefined;\r\n  }\r\n  _OutputProxy.prototype.open = function() {\r\n    var self = this;\r\n    return new Promise(function(resolve, reject) {\r\n      var i;\r\n      if (self.proxy || !self.connected) resolve();\r\n      else {\r\n        self.pending.push([resolve, reject]);\r\n        if (self.pending.length == 1) {\r\n          JZZ().openMidiOut(self.name).or(function() {\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][1]();\r\n            self.pending = [];\r\n          }).and(function() {\r\n            self.proxy = this;\r\n            for (i = 0; i < self.pending.length; i++) self.pending[i][0]();\r\n            self.pending = [];\r\n          });\r\n        }\r\n      }\r\n    });\r\n  };\r\n  _OutputProxy.prototype.close = function() {\r\n    var i;\r\n    if (this.proxy) {\r\n      for (i = 0; i < this.ports.length; i++) if (this.ports[i].connection == 'open') return;\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _OutputProxy.prototype.disconnect = function() {\r\n    this.connected = false;\r\n    if (this.proxy) {\r\n      this.proxy.close();\r\n      this.proxy = undefined;\r\n    }\r\n  };\r\n  _OutputProxy.prototype.reconnect = function() {\r\n    var self = this;\r\n    var i, p;\r\n    var a = [];\r\n    this.connected = true;\r\n    for (i = 0; i < _wma.length; i++) {\r\n      p = _wma[i].outputs.get(this.id);\r\n      if (p.connection == 'closed') _statechange(p, _wma[i]);\r\n      else a.push([p, _wma[i]]);\r\n    }\r\n    if (a.length) {\r\n      JZZ()._openMidiOutNR(self.name).or(function() {\r\n        for (i = 0; i < a.length; i++) a[i][0].close();\r\n      }).and(function() {\r\n        self.proxy = this;\r\n        for (i = 0; i < a.length; i++) _statechange(a[i][0], a[i][1]);\r\n      });\r\n    }\r\n  };\r\n\r\n  function _Maplike(data) {\r\n    this.has = function(id) {\r\n      return data.hasOwnProperty(id) && data[id].connected;\r\n    };\r\n    this.keys = function() {\r\n      try { // some old browsers may have no Map object\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.keys();\r\n      } catch (e) {}\r\n    };\r\n    this.values = function() {\r\n      try {\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.values();\r\n      } catch (e) {}\r\n    };\r\n    this.entries = function() {\r\n      try {\r\n        var m = new Map();\r\n        for (var id in data) if (this.has(id)) m.set(id, this.get(id));\r\n        return m.entries();\r\n      } catch (e) {}\r\n    };\r\n    this.forEach = function(fun, self) {\r\n      if (typeof self == 'undefined') self = this;\r\n      for (var id in data) if (this.has(id)) fun.call(self, this.get(id), id, this);\r\n    };\r\n    Object.defineProperty(this, 'size', {\r\n      get: function() {\r\n        var len = 0;\r\n        for (var id in data) if (this.has(id)) len++;\r\n        return len;\r\n      },\r\n      enumerable: true\r\n    });\r\n  }\r\n\r\n  function MIDIInputMap(_access, _inputs) {\r\n    this.get = function(id) {\r\n      if (_inputMap.hasOwnProperty(id) && _inputMap[id].connected) {\r\n        if (!_inputs[id]) {\r\n          _inputs[id] = new MIDIInput(_access, _inputMap[id]);\r\n          _inputMap[id].ports.push([_inputs[id], _access.sysexEnabled]);\r\n        }\r\n        return _inputs[id];\r\n      }\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n  MIDIInputMap.prototype = new _Maplike(_inputMap);\r\n  MIDIInputMap.prototype.constructor = MIDIInputMap;\r\n\r\n  function MIDIOutputMap(_access, _outputs) {\r\n    this.get = function(id) {\r\n      if (_outputMap.hasOwnProperty(id) && _outputMap[id].connected) {\r\n        if (!_outputs[id]) {\r\n          _outputs[id] = new MIDIOutput(_access, _outputMap[id]);\r\n          _outputMap[id].ports.push([_outputs[id], _access.sysexEnabled]);\r\n        }\r\n        return _outputs[id];\r\n      }\r\n    };\r\n    Object.freeze(this);\r\n  }\r\n  MIDIOutputMap.prototype = new _Maplike(_outputMap);\r\n  MIDIOutputMap.prototype.constructor = MIDIOutputMap;\r\n\r\n  function _wm_watch(x) {\r\n    var i, k, p, a;\r\n    for (i = 0; i < x.inputs.added.length; i++) {\r\n      p = x.inputs.added[i];\r\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\r\n      _inputMap[p.id].reconnect();\r\n    }\r\n    for (i = 0; i < x.outputs.added.length; i++) {\r\n      p = x.outputs.added[i];\r\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\r\n      _outputMap[p.id].reconnect();\r\n    }\r\n    for (i = 0; i < x.inputs.removed.length; i++) {\r\n      p = x.inputs.removed[i];\r\n      if (_inputMap.hasOwnProperty(p.id)) {\r\n        a = [];\r\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].inputs.get(p.id), _wma[k]]);\r\n        _inputMap[p.id].disconnect();\r\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\r\n      }\r\n    }\r\n    for (i = 0; i < x.outputs.removed.length; i++) {\r\n      p = x.outputs.removed[i];\r\n      if (_outputMap.hasOwnProperty(p.id)) {\r\n        a = [];\r\n        for (k = 0; k < _wma.length; k++) a.push([_wma[k].outputs.get(p.id), _wma[k]]);\r\n        _outputMap[p.id].disconnect();\r\n        for (k = 0; k < a.length; k++) _statechange(a[k][0], a[k][1]);\r\n      }\r\n    }\r\n  }\r\n\r\n  function MIDIAccess(sysex) {\r\n    var _inputs = {};\r\n    var _outputs = {};\r\n    var _onstatechange = null;\r\n    var self = this;\r\n    this.sysexEnabled = sysex;\r\n    this.inputs = new MIDIInputMap(self, _inputs);\r\n    this.outputs = new MIDIOutputMap(self, _outputs);\r\n    Object.defineProperty(this, 'onstatechange', {\r\n      get: function() { return _onstatechange; },\r\n      set: function(f) { _onstatechange = _func(f) ? f : null; },\r\n      enumerable: true\r\n    });\r\n    Object.freeze(this);\r\n    var i;\r\n    var p;\r\n    var info = _jzz._info;\r\n    for (i = 0; i < info.inputs.length; i++) {\r\n      p = info.inputs[i];\r\n      if (!_inputMap.hasOwnProperty(p.id)) _inputMap[p.id] = new _InputProxy(p.id, p.name, p.manufacturer, p.version);\r\n    }\r\n    for (i = 0; i < info.outputs.length; i++) {\r\n      p = info.outputs[i];\r\n      if (!_outputMap.hasOwnProperty(p.id)) _outputMap[p.id] = new _OutputProxy(p.id, p.name, p.manufacturer, p.version);\r\n    }\r\n    if (!_wma.length) JZZ().onChange(_wm_watch);\r\n    _wma.push(this);\r\n  }\r\n\r\n  JZZ.requestMIDIAccess = function(opt) {\r\n    return new Promise(function(resolve, reject) {\r\n      JZZ.JZZ(opt).or(function() {\r\n      }).and(function() {\r\n        var sysex = !!(opt && opt.sysex);\r\n        if (sysex && !this.info().sysex) reject(new DOMException('SecurityError', 'Sysex is not allowed', 18));\r\n        else {\r\n          var wma = new MIDIAccess(sysex);\r\n          resolve(wma);\r\n        }\r\n      });\r\n    });\r\n  };\r\n  if (typeof navigator !== 'undefined' && !navigator.requestMIDIAccess) navigator.requestMIDIAccess = JZZ.requestMIDIAccess;\r\n  JZZ.close = function() { if (_engine._close) _engine._close(); };\r\n\r\n  return JZZ;\r\n});\r\n"]},"metadata":{},"sourceType":"script"}